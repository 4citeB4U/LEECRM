<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Agent Lee CRM System - The mobile-first, all-in-one outreach system for real-world artists and organizers">
  <title>ðŸ§  Agent Lee CRM System</title>
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
  <!-- TailwindCSS via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Poppins', 'sans-serif'],
            display: ['Space Grotesk', 'sans-serif'],
          },
          colors: {
            primary: {
              DEFAULT: '#6366f1',
              50: '#f5f5ff',
              100: '#ecedfe',
              200: '#d9d9fd',
              300: '#b5b7fc',
              400: '#8c8ff9',
              500: '#6366f1',
              600: '#514ae9',
              700: '#3730d6',
              800: '#3029af',
              900: '#2c2689',
            },
            secondary: {
              DEFAULT: '#14b8a6',
              50: '#f0fdfa',
              100: '#ccfbf1',
              200: '#99f6e4',
              300: '#5eead4',
              400: '#2dd4bf',
              500: '#14b8a6',
              600: '#0d9488',
              700: '#0f766e',
              800: '#115e59',
              900: '#134e4a',
            },
            dark: {
              DEFAULT: '#0f172a',
              50: '#f8fafc',
              100: '#f1f5f9',
              200: '#e2e8f0',
              300: '#cbd5e1',
              400: '#94a3b8',
              500: '#64748b',
              600: '#475569',
              700: '#334155',
              800: '#1e293b',
              900: '#0f172a',
            },
          },
          animation: {
            'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
          }
        }
      }
    }
  </script>
  <!-- Custom CSS -->
  <link rel="stylesheet" href="styles.css">
  <!-- Load config.js first to access environment variables -->
  <script src="config.js"></script>
  <!-- Music Store Data -->
  <script src="complete_music_store_list.js"></script>
  <script src="gh.js"></script>
  <!-- Store Data Initialization -->
  <script>
    // Combine all store data and ensure coordinates are handled
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize allStores array with musicStores
      window.allStores = window.musicStores ? [...window.musicStores] : [];
      
      // Process ghStores if available and add to allStores
      if (window.ghStores && Array.isArray(window.ghStores)) {
        // Set default coordinates for stores without lat/lng
        const defaultCoords = window.env && window.env.DEFAULT_LOCATION ? window.env.DEFAULT_LOCATION : { lat: 43.0389, lng: -87.9065 };
        
        // Process each ghStore
        window.ghStores.forEach(store => {
          // If coordinates are null, use estimated coordinates based on city/state
          if (store.lat === null || store.lng === null) {
            // Use approximated coordinates based on city and state
            // You could implement geocoding here, but for now we'll use random offsets from default
            const randomLat = defaultCoords.lat + (Math.random() * 0.3 - 0.15);
            const randomLng = defaultCoords.lng + (Math.random() * 0.3 - 0.15);
            
            store.lat = randomLat;
            store.lng = randomLng;
            store.estimatedCoordinates = true; // Mark as estimated
          }
          
          // Add to the combined store list
          window.allStores.push(store);
        });
      }
      
      console.log(`Combined ${window.allStores.length} stores from all sources`);
    });
  </script>
  <!-- Recorder.js via CDN -->
  <script src="https://cdn.jsdelivr.net/npm/recordrtc@5.6.2/RecordRTC.min.js"></script>
  <!-- IndexedDB library -->
  <script src="https://cdn.jsdelivr.net/npm/idb-keyval@6/dist/umd.js"></script>
  <style>
    /* Base styles with smooth transitions */
    body {
      background-color: #f8fafc;
      transition: background-color 0.3s ease;
    }
    
    body.dark-mode {
      background-color: #0f172a;
      color: #f1f5f9;
    }
    
    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }
    
    ::-webkit-scrollbar-track {
      background: rgba(203, 213, 225, 0.2);
      border-radius: 10px;
    }
    
    ::-webkit-scrollbar-thumb {
      background: rgba(99, 102, 241, 0.5);
      border-radius: 10px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: rgba(99, 102, 241, 0.8);
    }
    
    /* Animation for pulse effect */
    @keyframes pulse-ring {
      0% {
        transform: scale(0.8);
        opacity: 0.8;
      }
      50% {
        transform: scale(1);
        opacity: 0.4;
      }
      100% {
        transform: scale(0.8);
        opacity: 0.8;
      }
    }

    /* Glass morphism effects */
    .glass {
      background: rgba(255, 255, 255, 0.25);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.18);
    }

    .glass-dark {
      background: rgba(15, 23, 42, 0.75);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid rgba(30, 41, 59, 0.5);
    }

    /* 3D card hover effect */
    .card-3d {
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .card-3d:hover {
      transform: translateY(-5px) scale(1.01);
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }

    /* Loading animation */
    .loading-animation {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      background: linear-gradient(135deg, #6366f1, #14b8a6);
      z-index: 9999;
      transition: opacity 0.5s ease-out, visibility 0.5s ease-out;
    }

    .loader {
      width: 80px;
      height: 80px;
      position: relative;
    }

    .loader:before, .loader:after {
      content: '';
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: white;
      opacity: 0.6;
      animation: pulse-ring 2s linear infinite;
    }

    .loader:after {
      animation-delay: 1s;
    }

    .loader-logo {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 2rem;
      color: white;
      z-index: 1;
    }

    .loading-hide {
      opacity: 0;
      visibility: hidden;
    }

    /* Map styling */
    #map {
      height: 100%;
      min-height: 500px;
      width: 100%;
      border-radius: 1rem;
      overflow: hidden;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    }

    /* Gradient animations for buttons and elements */
    .gradient-btn {
      background-size: 200% 200%;
      background-image: linear-gradient(45deg, #6366f1, #14b8a6, #6366f1);
      animation: gradientShift 3s ease infinite;
    }

    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* Gradient text */
    .gradient-text {
      background-image: linear-gradient(45deg, #6366f1, #14b8a6);
      background-clip: text;
      -webkit-background-clip: text;
      color: transparent;
    }

    /* Analytics chart styling */
    .chart-container {
      height: 200px;
      position: relative;
    }

    /* Grid for dashboard layout */
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.5rem;
    }
  </style>
  <!-- Google Maps API with key from config.js -->
  <script>
    // Load Google Maps API key from config.js
    function loadGoogleMapsAPI() {
      // Use the API key from config.js or directly from config.google.apiKey
      let googleMapsAPIKey = null;

      if (window.env && window.env.GOOGLE_MAPS_API_KEY) {
        googleMapsAPIKey = window.env.GOOGLE_MAPS_API_KEY;
      } else if (window.config && window.config.google && window.config.google.apiKey) {
        googleMapsAPIKey = window.config.google.apiKey;
      } else {
        // Hardcoded fallback key - using the key from config.js that has billing enabled
        googleMapsAPIKey = "AIzaSyAgMwqNZinl-6rezvp62jj8eFZrJ0n3SBQ";
      }

      if (!googleMapsAPIKey) {
        console.error("Missing Google Maps API key in config.js");
        alert("Google Maps API key is missing. Please check your config.js file.");

        // Create a fallback map display
        createFallbackMapDisplay();
        return;
      }

      console.log("Loading Google Maps with API key from config.js");

      // Check if the script is already loaded
      if (document.querySelector('script[src*="maps.googleapis.com/maps/api/js"]')) {
        console.log("Google Maps API script already exists, not adding again");
        // If the API is already loaded but map isn't initialized, try to initialize it
        if (typeof google !== 'undefined' && google.maps) {
          console.log("Google Maps API already loaded, initializing map directly");
          initializeMap();
        } else {
          // If Google object exists but maps is not defined, there might be an error
          console.error("Google object exists but maps API is not properly loaded");
          createFallbackMapDisplay();
        }
        return;
      }

      // Create script element for Google Maps API
      const script = document.createElement('script');
      script.src = `https://maps.googleapis.com/maps/api/js?key=${googleMapsAPIKey}&libraries=places&callback=initMap&loading=async`;
      script.async = true;
      script.defer = true;
      script.onerror = function() {
        console.error("Failed to load Google Maps API. Check your API key.");
        alert("Google Maps failed to load. Please check your internet connection and API key.");
        createFallbackMapDisplay();
      };

      // Add a timeout to detect if the API takes too long to load
      const timeoutId = setTimeout(function() {
        if (typeof google === 'undefined' || !google.maps) {
          console.error("Google Maps API load timeout");
          createFallbackMapDisplay();
        }
      }, 10000); // 10 second timeout

      // Add script to document
      document.head.appendChild(script);

      console.log("Google Maps API script added to document head");
    }

    // Create a fallback display when Google Maps fails to load
    function createFallbackMapDisplay() {
      const mapContainer = document.getElementById('map');
      if (!mapContainer) return;

      mapContainer.innerHTML = `
        <div class="flex flex-col items-center justify-center h-full bg-dark-100/30 p-4 text-center rounded-xl">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-dark-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7" />
          </svg>
          <h2 class="text-xl font-bold text-dark-700 mb-2">Map Unavailable</h2>
          <p class="text-dark-600 mb-4">Google Maps could not be loaded at this time.</p>
          <p class="text-dark-500 text-sm mb-4">This may be due to network connectivity issues or API key configuration.</p>
          <button id="retry-map-load" class="gradient-btn px-4 py-2 text-white rounded-full hover:shadow-lg transition duration-300 ease-in-out shadow-md">
            Retry Loading Map
          </button>
        </div>
      `;

      // Add event listener to retry button
      document.getElementById('retry-map-load').addEventListener('click', function() {
        mapContainer.innerHTML = '<div class="w-full h-full flex items-center justify-center"><div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"></div></div>';
        setTimeout(loadGoogleMapsAPI, 500);
      });

      // Also populate the nearby list with a message
      const nearbyList = document.getElementById('nearby-list');
      if (nearbyList) {
        nearbyList.innerHTML = `
          <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded-lg shadow">
            <div class="flex">
              <div class="flex-shrink-0">
                <svg class="h-5 w-5 text-yellow-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                </svg>
              </div>
              <div class="ml-3">
                <p class="text-sm text-yellow-700">
                  Map functionality is currently unavailable. Nearby leads cannot be displayed.
                </p>
              </div>
            </div>
          </div>
        `;
      }
    }

    // Define initMap function in global scope so Google Maps API can find it
    window.initMap = function() {
      console.log("Google Maps API callback received");
      if (typeof initializeMap === 'function') {
        initializeMap(); // Call our single map initialization function
      } else {
        console.error("initializeMap function not found");
        // Try to define a fallback initialization function
        window.initializeMap = function() {
          console.log("Using fallback map initialization");
          const mapContainer = document.getElementById('map');
          if (!mapContainer) {
            console.error("Map container not found");
            return;
          }

          // Make sure the map container has proper dimensions
          mapContainer.style.height = '500px';
          mapContainer.style.width = '100%';

          // Get default location from config or fallback to Milwaukee
          const defaultLocation = window.env && window.env.DEFAULT_LOCATION 
            ? window.env.DEFAULT_LOCATION 
            : { lat: 43.0389, lng: -87.9065 };

          // Create the map centered on default location
          window.googleMap = new google.maps.Map(document.getElementById('map'), {
            center: defaultLocation,
            zoom: 10,
            mapTypeControl: true,
            streetViewControl: true,
            fullscreenControl: true,
            styles: [
              {
                "featureType": "administrative.land_parcel",
                "elementType": "labels",
                "stylers": [{"visibility": "off"}]
              },
              {
                "featureType": "poi",
                "elementType": "labels.text",
                "stylers": [{"visibility": "off"}]
              },
              {
                "featureType": "poi.business",
                "stylers": [{"visibility": "off"}]
              },
              {
                "featureType": "road",
                "elementType": "labels.icon",
                "stylers": [{"visibility": "off"}]
              },
              {
                "featureType": "road.local",
                "elementType": "labels",
                "stylers": [{"visibility": "off"}]
              },
              {
                "featureType": "transit",
                "stylers": [{"visibility": "off"}]
              }
            ]
          });

          // Assign to global map variable for compatibility
          window.map = window.googleMap;
          
          // Add markers for all stores
          addAllStoreMarkers();

          console.log("Google Maps initialized successfully with fallback");
        };

        // Call the fallback initialization
        window.initializeMap();
      }
    };

    // Call the function to load the API when document is ready
    document.addEventListener('DOMContentLoaded', function() {
      console.log("DOM Content Loaded - Loading Google Maps API");
      // Wait a bit longer to ensure config.js is fully loaded
      setTimeout(loadGoogleMapsAPI, 300);
    });
  </script>
</head>
<body class="font-sans text-dark-900">
  <!-- Loading Animation -->
  <div class="loading-animation">
    <div class="loader">
      <span class="loader-logo">ðŸ§ </span>
    </div>
  </div>

  <div class="min-h-screen flex flex-col relative overflow-hidden">
    <!-- Background Gradient Elements -->
    <div class="absolute top-0 left-0 w-full h-full overflow-hidden z-0 pointer-events-none">
      <div class="absolute top-0 left-0 w-72 h-72 -ml-20 -mt-20 bg-primary-300/20 rounded-full filter blur-3xl animate-pulse-slow"></div>
      <div class="absolute bottom-0 right-0 w-96 h-96 -mr-20 -mb-20 bg-secondary-300/20 rounded-full filter blur-3xl animate-pulse-slow"></div>
      <div class="absolute top-1/3 right-1/4 w-64 h-64 bg-purple-300/10 rounded-full filter blur-3xl animate-pulse-slow"></div>
    </div>
    
    <!-- Sidebar - Fixed on larger screens -->
    <div class="hidden md:flex fixed top-0 left-0 h-full w-64 bg-white/90 dark:bg-dark-800/90 backdrop-blur-lg z-40 flex-col shadow-lg transition-all duration-300 ease-in-out">
      <div class="p-6 flex items-center space-x-3 border-b border-dark-200/50 dark:border-dark-700/50">
        <div class="w-10 h-10 rounded-full bg-gradient-to-r from-primary to-secondary flex items-center justify-center text-white text-xl shadow-md">
          ðŸ§ 
        </div>
        <div>
          <h1 class="font-display font-bold text-lg text-dark-900 dark:text-white">Agent Lee</h1>
          <p class="text-xs text-dark-500 dark:text-dark-400">Intelligent CRM System</p>
        </div>
      </div>
      
      <!-- Sidebar Navigation -->
      <nav class="flex-1 py-6 px-4 overflow-y-auto">
        <ul class="space-y-2">
          <li>
            <a href="#map-tab" data-tab="map" class="sidebar-nav-active flex items-center space-x-3 p-3 rounded-xl text-primary font-medium bg-primary-50 dark:bg-primary-900/20">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7" />
              </svg>
              <span>Map View</span>
            </a>
          </li>
          <li>
            <a href="#records-tab" data-tab="records" class="flex items-center space-x-3 p-3 rounded-xl text-dark-700 dark:text-dark-300 hover:bg-dark-100 dark:hover:bg-dark-700/50 transition-all duration-200">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" />
              </svg>
              <span>Records</span>
            </a>
          </li>
          <li>
            <a href="#phone-tab" data-tab="phone" class="flex items-center space-x-3 p-3 rounded-xl text-dark-700 dark:text-dark-300 hover:bg-dark-100 dark:hover:bg-dark-700/50 transition-all duration-200">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
              </svg>
              <span>Phone</span>
            </a>
          </li>
          <li>
            <a href="#campaigns-tab" data-tab="campaigns" class="flex items-center space-x-3 p-3 rounded-xl text-dark-700 dark:text-dark-300 hover:bg-dark-100 dark:hover:bg-dark-700/50 transition-all duration-200">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
              </svg>
              <span>Campaigns</span>
            </a>
          </li>
          <li>
            <a href="#analytics-tab" data-tab="analytics" class="flex items-center space-x-3 p-3 rounded-xl text-dark-700 dark:text-dark-300 hover:bg-dark-100 dark:hover:bg-dark-700/50 transition-all duration-200">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
              </svg>
              <span>Analytics</span>
            </a>
          </li>
          <li>
            <a href="#visits-tab" data-tab="visits" class="flex items-center space-x-3 p-3 rounded-xl text-dark-700 dark:text-dark-300 hover:bg-dark-100 dark:hover:bg-dark-700/50 transition-all duration-200">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
              </svg>
              <span>Visits</span>
            </a>
          </li>
          <li>
            <a href="#todos-tab" data-tab="todos" class="flex items-center space-x-3 p-3 rounded-xl text-dark-700 dark:text-dark-300 hover:bg-dark-100 dark:hover:bg-dark-700/50 transition-all duration-200">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" />
              </svg>
              <span>To-Dos</span>
            </a>
          </li>
          <li>
            <a href="#timeline-tab" data-tab="timeline" class="flex items-center space-x-3 p-3 rounded-xl text-dark-700 dark:text-dark-300 hover:bg-dark-100 dark:hover:bg-dark-700/50 transition-all duration-200">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              <span>Timeline</span>
            </a>
          </li>
          <li class="border-t border-dark-200/30 dark:border-dark-700/30 mt-4 pt-4">
            <a href="#business-card-tab" data-tab="business-card" class="flex items-center space-x-3 p-3 rounded-xl text-dark-700 dark:text-dark-300 hover:bg-dark-100 dark:hover:bg-dark-700/50 transition-all duration-200">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V8a2 2 0 00-2-2h-5m-4 0V5a2 2 0 114 0v1m-4 0a2 2 0 104 0m-5.75 3l-3 3m0 0l3 3m-3-3h20.5" />
              </svg>
              <span>Business Card</span>
            </a>
          </li>
          <li>
            <a href="#email-signature-tab" data-tab="email-signature" class="flex items-center space-x-3 p-3 rounded-xl text-dark-700 dark:text-dark-300 hover:bg-dark-100 dark:hover:bg-dark-700/50 transition-all duration-200">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
              </svg>
              <span>Email Signature</span>
            </a>
          </li>
          <li>
            <a href="#file-browser-tab" data-tab="file-browser" class="flex items-center space-x-3 p-3 rounded-xl text-dark-700 dark:text-dark-300 hover:bg-dark-100 dark:hover:bg-dark-700/50 transition-all duration-200">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
              </svg>
              <span>File Browser</span>
            </a>
          </li>
        </ul>
      </nav>
      
      <!-- User Profile -->
      <div class="p-4 border-t border-dark-200/30 dark:border-dark-700/30">
        <div class="flex items-center space-x-3">
          <div class="relative">
            <div class="w-10 h-10 rounded-full bg-dark-200 dark:bg-dark-700 overflow-hidden shadow">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-full w-full text-dark-400 dark:text-dark-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
              </svg>
            </div>
            <div class="absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-green-400 rounded-full border-2 border-white dark:border-dark-800"></div>
          </div>
          <div class="flex-1 min-w-0">
            <p class="text-sm font-medium text-dark-900 dark:text-white truncate">Leonard Lee</p>
            <p class="text-xs text-dark-500 dark:text-dark-400 truncate">Agent</p>
          </div>
          <button id="theme-toggle" class="p-2 rounded-lg text-dark-500 hover:bg-dark-100 dark:hover:bg-dark-700/50 dark:text-dark-400">
            <!-- Sun icon for dark mode -->
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 hidden dark:block" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
            </svg>
            <!-- Moon icon for light mode -->
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 block dark:hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
            </svg>
          </button>
        </div>
      </div>
    </div>

    <!-- Mobile Header -->
    <header class="md:hidden bg-white/90 dark:bg-dark-900/90 backdrop-blur-lg shadow-sm z-40 sticky top-0">
      <div class="flex items-center justify-between p-4">
        <button id="mobile-menu-btn" class="p-2 rounded-lg text-dark-700 dark:text-dark-300 hover:bg-dark-100 dark:hover:bg-dark-700">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>
        <div class="flex items-center">
          <div class="w-8 h-8 rounded-full bg-gradient-to-r from-primary to-secondary flex items-center justify-center text-white shadow-sm mr-2">
            ðŸ§ 
          </div>
          <span class="text-lg font-display font-bold text-dark-900 dark:text-white">Agent Lee CRM</span>
        </div>
        <button id="mobile-user-btn" class="relative p-2 rounded-lg text-dark-700 dark:text-dark-300 hover:bg-dark-100 dark:hover:bg-dark-700">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
          </svg>
          <div class="absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-green-400 rounded-full border-2 border-white dark:border-dark-900"></div>
        </button>
      </div>

      <!-- Voice command bar for mobile -->
      <div class="bg-gradient-to-r from-primary-400 to-primary-600 p-3 shadow-md flex items-center justify-between">
        <div class="flex items-center">
          <button type="button" id="global-record-btn" class="p-3 rounded-full bg-white text-primary-600 hover:bg-dark-50 flex items-center shadow-md transition-all duration-200 mr-3" aria-label="Start recording">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />
            </svg>
          </button>
          <span class="text-sm font-medium text-white">Voice Command</span>
        </div>
        <div id="dictation-status" class="text-sm text-white flex-grow mx-4 hidden">
          <span class="font-medium">Listening:</span> <span id="dictation-result">Speak now...</span>
        </div>
        <div class="text-xs text-white/80">Press to start</div>
      </div>
      
      <!-- Mobile Navigation Tabs -->
      <div class="flex overflow-x-auto hide-scrollbar border-b border-dark-200/30 dark:border-dark-700/50 bg-white/90 dark:bg-dark-900/90 backdrop-blur-lg text-sm">
        <button type="button" data-tab="map" class="tab-active flex-shrink-0 px-4 py-3 font-medium focus:outline-none">
          Map View
        </button>
        <button type="button" data-tab="records" class="flex-shrink-0 px-4 py-3 text-dark-500 dark:text-dark-400 font-medium focus:outline-none">
          Records
        </button>
        <button type="button" data-tab="phone" class="flex-shrink-0 px-4 py-3 text-dark-500 dark:text-dark-400 font-medium focus:outline-none">
          Phone
        </button>
        <button type="button" data-tab="campaigns" class="flex-shrink-0 px-4 py-3 text-dark-500 dark:text-dark-400 font-medium focus:outline-none">
          Campaigns
        </button>
        <button type="button" data-tab="analytics" class="flex-shrink-0 px-4 py-3 text-dark-500 dark:text-dark-400 font-medium focus:outline-none">
          Analytics
        </button>
        <button type="button" data-tab="more" class="flex-shrink-0 px-4 py-3 text-dark-500 dark:text-dark-400 font-medium focus:outline-none flex items-center">
          More
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
          </svg>
        </button>
      </div>
      
      <!-- Mobile Navigation More Menu (hidden by default) -->
      <div id="mobile-more-menu" class="hidden absolute z-50 bg-white dark:bg-dark-800 shadow-lg rounded-b-lg w-48 right-4 mt-1 py-2 text-sm">
        <a href="#visits-tab" data-tab="visits" class="block px-4 py-2 text-dark-700 dark:text-dark-300 hover:bg-dark-100 dark:hover:bg-dark-700">Visits</a>
        <a href="#todos-tab" data-tab="todos" class="block px-4 py-2 text-dark-700 dark:text-dark-300 hover:bg-dark-100 dark:hover:bg-dark-700">To-Dos</a>
        <a href="#timeline-tab" data-tab="timeline" class="block px-4 py-2 text-dark-700 dark:text-dark-300 hover:bg-dark-100 dark:hover:bg-dark-700">Timeline</a>
        <div class="border-t border-dark-200 dark:border-dark-700 my-1"></div>
        <a href="#business-card-tab" data-tab="business-card" class="block px-4 py-2 text-dark-700 dark:text-dark-300 hover:bg-dark-100 dark:hover:bg-dark-700">Business Card</a>
        <a href="#email-signature-tab" data-tab="email-signature" class="block px-4 py-2 text-dark-700 dark:text-dark-300 hover:bg-dark-100 dark:hover:bg-dark-700">Email Signature</a>
        <a href="#file-browser-tab" data-tab="file-browser" class="block px-4 py-2 text-dark-700 dark:text-dark-300 hover:bg-dark-100 dark:hover:bg-dark-700">File Browser</a>
      </div>
    </header>
    
    <!-- Mobile Sidebar (offscreen by default) -->
    <div id="mobile-sidebar" class="fixed inset-0 z-50 lg:hidden transform -translate-x-full transition-transform duration-300 ease-in-out">
      <!-- Backdrop -->
      <div class="absolute inset-0 bg-dark-900/50 backdrop-blur-sm" id="sidebar-backdrop"></div>
      
      <!-- Sidebar Content -->
      <div class="absolute top-0 left-0 w-72 h-full bg-white dark:bg-dark-800 shadow-xl flex flex-col">
        <div class="p-6 flex items-center justify-between border-b border-dark-200/50 dark:border-dark-700/50">
          <div class="flex items-center space-x-3">
            <div class="w-10 h-10 rounded-full bg-gradient-to-r from-primary to-secondary flex items-center justify-center text-white text-xl shadow-md">
              ðŸ§ 
            </div>
            <h2 class="font-display font-bold text-lg text-dark-900 dark:text-white">Agent Lee</h2>
          </div>
          <button id="close-sidebar" class="p-1 rounded-md text-dark-500 hover:bg-dark-100 dark:hover:bg-dark-700">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
        
        <!-- Mobile Sidebar Navigation (same as desktop) -->
        <nav class="flex-1 py-6 px-4 overflow-y-auto">
          <ul class="space-y-2">
            <li>
              <a href="#map-tab" data-tab="map" class="mobile-nav-item flex items-center space-x-3 p-3 rounded-xl text-primary font-medium bg-primary-50 dark:bg-primary-900/20">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7" />
                </svg>
                <span>Map View</span>
              </a>
            </li>
            <li>
              <a href="#records-tab" data-tab="records" class="mobile-nav-item flex items-center space-x-3 p-3 rounded-xl text-dark-700 dark:text-dark-300 hover:bg-dark-100 dark:hover:bg-dark-700/50 transition-all duration-200">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" />
                </svg>
                <span>Records</span>
              </a>
            </li>
            <!-- Additional nav items (same structure as desktop sidebar) -->
          </ul>
        </nav>
        
        <!-- User Profile for Mobile -->
        <div class="p-4 border-t border-dark-200/30 dark:border-dark-700/30">
          <div class="flex items-center space-x-3">
            <div class="relative">
              <div class="w-10 h-10 rounded-full bg-dark-200 dark:bg-dark-700 overflow-hidden shadow">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-full w-full text-dark-400 dark:text-dark-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                </svg>
              </div>
              <div class="absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-green-400 rounded-full border-2 border-white dark:border-dark-800"></div>
            </div>
            <div class="flex-1 min-w-0">
              <p class="text-sm font-medium text-dark-900 dark:text-white truncate">Leonard Lee</p>
              <p class="text-xs text-dark-500 dark:text-dark-400 truncate">Agent</p>
            </div>
            <button id="mobile-theme-toggle" class="p-2 rounded-lg text-dark-500 hover:bg-dark-100 dark:hover:bg-dark-700/50 dark:text-dark-400">
              <!-- Sun icon for dark mode -->
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 hidden dark:block" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
              </svg>
              <!-- Moon icon for light mode -->
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 block dark:hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <main class="flex-grow md:ml-64 relative z-10 mt-0 md:mt-6">
      <div class="container mx-auto px-4 pb-16 max-w-screen-2xl">
        <!-- Map Tab Content -->
        <section id="map-tab" class="space-y-6">
          <!-- Welcome Banner -->
          <div class="relative overflow-hidden bg-gradient-to-r from-primary-500 to-secondary-500 rounded-2xl shadow-lg p-6 text-white mb-8">
            <div class="absolute top-0 right-0 w-64 h-64 -mt-20 -mr-20 bg-white/10 rounded-full filter blur-3xl"></div>
            <div class="relative z-10 flex flex-col md:flex-row items-center justify-between gap-4">
              <div>
                <h1 class="text-2xl md:text-3xl font-display font-bold mb-2">Welcome back, Leonard</h1>
                <p class="text-white/80 max-w-lg">Your CRM is ready to help you connect with artists and music stores. Here's your current activity overview.</p>
              </div>
              <div class="flex gap-3 flex-wrap justify-end">
                <button type="button" class="px-4 py-2 bg-white/20 hover:bg-white/30 rounded-xl transition-all duration-200 backdrop-blur-sm flex items-center space-x-2 text-sm font-medium">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                  </svg>
                  <span>New Lead</span>
                </button>
                <button type="button" class="px-4 py-2 bg-white text-primary-600 hover:bg-white/90 rounded-xl transition-all duration-200 shadow-sm flex items-center space-x-2 text-sm font-medium">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                  </svg>
                  <span>New Campaign</span>
                </button>
              </div>
            </div>
          </div>
          
          <!-- Key Metrics -->
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="bg-white dark:bg-dark-800 rounded-2xl shadow-md p-6 card-3d border border-dark-100/50 dark:border-dark-700/50">
              <div class="flex items-start justify-between">
                <div>
                  <p class="text-dark-500 dark:text-dark-400 text-sm">Total Leads</p>
                  <h3 class="text-3xl font-display font-bold mt-2 text-dark-900 dark:text-white">247</h3>
                </div>
                <div class="w-12 h-12 rounded-xl bg-primary-100 dark:bg-primary-900/30 flex items-center justify-center text-primary-500">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                  </svg>
                </div>
              </div>
              <div class="mt-4 flex items-center">
                <span class="text-green-500 flex items-center text-sm font-medium">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
                  </svg>
                  42% growth
                </span>
                <span class="text-dark-400 dark:text-dark-500 text-xs ml-2">vs last month</span>
              </div>
            </div>
            
            <div class="bg-white dark:bg-dark-800 rounded-2xl shadow-md p-6 card-3d border border-dark-100/50 dark:border-dark-700/50">
              <div class="flex items-start justify-between">
                <div>
                  <p class="text-dark-500 dark:text-dark-400 text-sm">Open Rate</p>
                  <h3 class="text-3xl font-display font-bold mt-2 text-dark-900 dark:text-white">68.5%</h3>
                </div>
                <div class="w-12 h-12 rounded-xl bg-secondary-100 dark:bg-secondary-900/30 flex items-center justify-center text-secondary-500">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 19v-8.93a2 2 0 01.89-1.664l7-4.666a2 2 0 012.22 0l7 4.666A2 2 0 0121 10.07V19M3 19a2 2 0 002 2h14a2 2 0 002-2M3 19l6.75-4.5M21 19l-6.75-4.5M3 10l6.75 4.5M21 10l-6.75 4.5m0 0l-1.14.76a2 2 0 01-2.22 0l-1.14-.76" />
                  </svg>
                </div>
              </div>
              <div class="mt-4 flex items-center">
                <span class="text-green-500 flex items-center text-sm font-medium">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
                  </svg>
                  3.2%
                </span>
                <span class="text-dark-400 dark:text-dark-500 text-xs ml-2">vs last month</span>
              </div>
            </div>
            
            <div class="bg-white dark:bg-dark-800 rounded-2xl shadow-md p-6 card-3d border border-dark-100/50 dark:border-dark-700/50">
              <div class="flex items-start justify-between">
                <div>
                  <p class="text-dark-500 dark:text-dark-400 text-sm">Response Rate</p>
                  <h3 class="text-3xl font-display font-bold mt-2 text-dark-900 dark:text-white">12.3%</h3>
                </div>
                <div class="w-12 h-12 rounded-xl bg-purple-100 dark:bg-purple-900/30 flex items-center justify-center text-purple-500">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
                  </svg>
                </div>
              </div>
              <div class="mt-4 flex items-center">
                <span class="text-green-500 flex items-center text-sm font-medium">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
                  </svg>
                  1.5%
                </span>
                <span class="text-dark-400 dark:text-dark-500 text-xs ml-2">vs last month</span>
              </div>
            </div>
            
            <div class="bg-white dark:bg-dark-800 rounded-2xl shadow-md p-6 card-3d border border-dark-100/50 dark:border-dark-700/50">
              <div class="flex items-start justify-between">
                <div>
                  <p class="text-dark-500 dark:text-dark-400 text-sm">Next Follow-ups</p>
                  <h3 class="text-3xl font-display font-bold mt-2 text-dark-900 dark:text-white">27</h3>
                </div>
                <div class="w-12 h-12 rounded-xl bg-amber-100 dark:bg-amber-900/30 flex items-center justify-center text-amber-500">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                </div>
              </div>
              <div class="mt-4 flex items-center">
                <span class="text-amber-500 flex items-center text-sm font-medium">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                  </svg>
                  5 due today
                </span>
                <span class="text-dark-400 dark:text-dark-500 text-xs ml-2">+2 overdue</span>
              </div>
            </div>
          </div>

          <!-- Map and Nearby Section with improved layout -->
          <div class="flex flex-col lg:flex-row gap-6 relative">
            <!-- Map Area -->
            <div class="w-full lg:w-3/4 h-[70vh] lg:h-[80vh] rounded-2xl shadow-lg overflow-hidden relative">
              <div id="map" class="w-full h-full rounded-xl"></div>
            </div>
            
            <!-- Nearby Leads Panel - Semi-translucent modern styling -->
            <div class="w-full lg:w-1/4 bg-white/90 dark:bg-dark-800/90 backdrop-blur-lg p-6 rounded-2xl shadow-lg border border-dark-100/50 dark:border-dark-700/50 overflow-y-auto lg:max-h-[80vh]">
              <div class="mb-6">
                <h2 class="text-lg font-display font-bold mb-4 text-dark-900 dark:text-white flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                  </svg>
                  Nearby Leads
                </h2>
                
                <!-- Distance Filter Pills - Modern styling with gradients -->
                <div class="flex space-x-2 mb-4 overflow-x-auto hide-scrollbar pb-2">
                  <button type="button" class="distance-filter flex-shrink-0 px-4 py-1.5 bg-primary text-white rounded-full text-sm shadow-sm hover:shadow-md transition-all duration-200" data-distance="5">5 mi</button>
                  <button type="button" class="distance-filter flex-shrink-0 px-4 py-1.5 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-full text-sm shadow-sm hover:shadow-md transition-all duration-200" data-distance="10">10 mi</button>
                  <button type="button" class="distance-filter flex-shrink-0 px-4 py-1.5 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-full text-sm shadow-sm hover:shadow-md transition-all duration-200" data-distance="25">25 mi</button>
                  <button type="button" class="distance-filter flex-shrink-0 px-4 py-1.5 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-full text-sm shadow-sm hover:shadow-md transition-all duration-200" data-distance="50">50 mi</button>
                </div>
                
                <!-- Search input - Modern styling -->
                <div class="mb-4">
                  <div class="relative">
                    <input type="text" id="map-search" placeholder="Search nearby leads..." class="w-full p-3 pl-10 border-0 bg-dark-100/50 dark:bg-dark-700/50 rounded-xl focus:ring-2 focus:ring-primary" aria-label="Search nearby leads">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 absolute left-3 top-3.5 text-dark-400 dark:text-dark-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                  </div>
                </div>
                
                <!-- State Filters - Modern chips -->
                <div class="flex flex-wrap mt-2 gap-2">
                  <button type="button" class="state-filter px-3 py-1 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-md text-xs shadow-sm border border-dark-200/50 dark:border-dark-600/50 hover:bg-dark-100 dark:hover:bg-dark-600 transition-colors" data-state="WI">WI</button>
                  <button type="button" class="state-filter px-3 py-1 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-md text-xs shadow-sm border border-dark-200/50 dark:border-dark-600/50 hover:bg-dark-100 dark:hover:bg-dark-600 transition-colors" data-state="IL">IL</button>
                  <button type="button" class="state-filter px-3 py-1 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-md text-xs shadow-sm border border-dark-200/50 dark:border-dark-600/50 hover:bg-dark-100 dark:hover:bg-dark-600 transition-colors" data-state="MN">MN</button>
                  <button type="button" class="state-filter px-3 py-1 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-md text-xs shadow-sm border border-dark-200/50 dark:border-dark-600/50 hover:bg-dark-100 dark:hover:bg-dark-600 transition-colors" data-state="FL">FL</button>
                  <button type="button" class="state-filter px-3 py-1 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-md text-xs shadow-sm border border-dark-200/50 dark:border-dark-600/50 hover:bg-dark-100 dark:hover:bg-dark-600 transition-colors" data-state="IN">IN</button>
                  <button type="button" class="state-filter px-3 py-1 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-md text-xs shadow-sm border border-dark-200/50 dark:border-dark-600/50 hover:bg-dark-100 dark:hover:bg-dark-600 transition-colors" data-state="MI">MI</button>
                  <button type="button" class="state-filter px-3 py-1 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-md text-xs shadow-sm border border-dark-200/50 dark:border-dark-600/50 hover:bg-dark-100 dark:hover:bg-dark-600 transition-colors" data-state="TN">TN</button>
                  <button type="button" class="state-filter px-3 py-1 bg-primary text-white rounded-md text-xs shadow-sm" data-state="ALL">ALL</button>
                </div>
              </div>
              
              <!-- Nearby Leads List - Improved card design -->
              <div id="nearby-list" class="space-y-4">
                <!-- Animated placeholder cards -->
                <div class="animate-pulse space-y-4">
                  <div class="bg-white dark:bg-dark-700/50 rounded-xl p-4 shadow-sm hover:shadow-md transition-shadow duration-200">
                    <div class="rounded bg-dark-200 dark:bg-dark-600 h-5 w-2/3 mb-2"></div>
                    <div class="rounded bg-dark-200 dark:bg-dark-600 h-4 w-1/2 mb-2"></div>
                    <div class="flex items-center justify-between mt-2">
                      <div class="rounded bg-dark-200 dark:bg-dark-600 h-4 w-1/4"></div>
                      <div class="rounded bg-dark-200 dark:bg-dark-600 h-4 w-1/4"></div>
                    </div>
                  </div>
                  <div class="bg-white dark:bg-dark-700/50 rounded-xl p-4 shadow-sm hover:shadow-md transition-shadow duration-200">
                    <div class="rounded bg-dark-200 dark:bg-dark-600 h-5 w-1/2 mb-2"></div>
                    <div class="rounded bg-dark-200 dark:bg-dark-600 h-4 w-3/4 mb-2"></div>
                    <div class="flex items-center justify-between mt-2">
                      <div class="rounded bg-dark-200 dark:bg-dark-600 h-4 w-1/4"></div>
                      <div class="rounded bg-dark-200 dark:bg-dark-600 h-4 w-1/4"></div>
                    </div>
                  </div>
                  <div class="bg-white dark:bg-dark-700/50 rounded-xl p-4 shadow-sm hover:shadow-md transition-shadow duration-200">
                    <div class="rounded bg-dark-200 dark:bg-dark-600 h-5 w-3/5 mb-2"></div>
                    <div class="rounded bg-dark-200 dark:bg-dark-600 h-4 w-2/3 mb-2"></div>
                    <div class="flex items-center justify-between mt-2">
                      <div class="rounded bg-dark-200 dark:bg-dark-600 h-4 w-1/4"></div>
                      <div class="rounded bg-dark-200 dark:bg-dark-600 h-4 w-1/4"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Records Tab Content (Hidden by Default) -->
        <section id="records-tab" class="hidden space-y-6">
          <div class="bg-white/90 dark:bg-dark-800/90 backdrop-blur-lg rounded-2xl shadow-lg p-6 border border-dark-100/50 dark:border-dark-700/50">
            <h2 class="text-xl font-display font-bold mb-4 text-dark-900 dark:text-white">CRM Records</h2>
            <div class="flex flex-wrap gap-3 mb-4">
              <div class="relative flex-grow">
                <input type="text" id="records-search" placeholder="Search records..." class="w-full p-3 pl-10 bg-dark-100/50 dark:bg-dark-700/50 border-0 rounded-xl focus:ring-2 focus:ring-primary" aria-label="Search records">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 absolute left-3 top-3.5 text-dark-400 dark:text-dark-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                </svg>
              </div>

              <select id="records-filter" class="p-3 bg-dark-100/50 dark:bg-dark-700/50 border-0 rounded-xl focus:ring-2 focus:ring-primary text-dark-700 dark:text-dark-300" aria-label="Filter records">
                <option value="all">All Records</option>
                <option value="visited">Visited</option>
                <option value="unvisited">Unvisited</option>
                <option value="contacted">Contacted</option>
              </select>

              <button type="button" id="add-record-btn" class="gradient-btn px-5 py-3 text-white rounded-xl hover:shadow-lg focus:outline-none flex items-center space-x-2 transition-all duration-200">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                </svg>
                <span>Add Record</span>
              </button>
            </div>

            <!-- State Filter Pills -->
            <!-- State filter pills -->
            <div class="flex flex-wrap gap-2 mb-3">
              <button type="button" class="records-state-filter px-3 py-1.5 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-md text-xs shadow-sm border border-dark-200/50 dark:border-dark-600/50 hover:bg-dark-100 dark:hover:bg-dark-600 transition-colors" data-state="WI">WI</button>
              <button type="button" class="records-state-filter px-3 py-1.5 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-md text-xs shadow-sm border border-dark-200/50 dark:border-dark-600/50 hover:bg-dark-100 dark:hover:bg-dark-600 transition-colors" data-state="IL">IL</button>
              <button type="button" class="records-state-filter px-3 py-1.5 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-md text-xs shadow-sm border border-dark-200/50 dark:border-dark-600/50 hover:bg-dark-100 dark:hover:bg-dark-600 transition-colors" data-state="MN">MN</button>
              <button type="button" class="records-state-filter px-3 py-1.5 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-md text-xs shadow-sm border border-dark-200/50 dark:border-dark-600/50 hover:bg-dark-100 dark:hover:bg-dark-600 transition-colors" data-state="FL">FL</button>
              <button type="button" class="records-state-filter px-3 py-1.5 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-md text-xs shadow-sm border border-dark-200/50 dark:border-dark-600/50 hover:bg-dark-100 dark:hover:bg-dark-600 transition-colors" data-state="IN">IN</button>
              <button type="button" class="records-state-filter px-3 py-1.5 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-md text-xs shadow-sm border border-dark-200/50 dark:border-dark-600/50 hover:bg-dark-100 dark:hover:bg-dark-600 transition-colors" data-state="MI">MI</button>
              <button type="button" class="records-state-filter px-3 py-1.5 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-md text-xs shadow-sm border border-dark-200/50 dark:border-dark-600/50 hover:bg-dark-100 dark:hover:bg-dark-600 transition-colors" data-state="TN">TN</button>
              <button type="button" class="records-state-filter px-3 py-1.5 bg-primary text-white rounded-md text-xs shadow-sm" data-state="ALL">ALL</button>
            </div>
            
            <!-- City filters for Wisconsin (with Milwaukee highlighted) -->
            <div id="wi-cities-filter" class="flex flex-wrap gap-2 mb-5 city-filters hidden">
              <button type="button" class="city-filter px-3 py-1.5 bg-secondary text-white rounded-md text-xs shadow-sm font-medium" data-city="Milwaukee" data-state="WI">Milwaukee</button>
              <button type="button" class="city-filter px-3 py-1.5 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-md text-xs shadow-sm border border-dark-200/50 dark:border-dark-600/50 hover:bg-dark-100 dark:hover:bg-dark-600 transition-colors" data-city="Greenfield" data-state="WI">Greenfield</button>
              <button type="button" class="city-filter px-3 py-1.5 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-md text-xs shadow-sm border border-dark-200/50 dark:border-dark-600/50 hover:bg-dark-100 dark:hover:bg-dark-600 transition-colors" data-city="Baraboo" data-state="WI">Baraboo</button>
              <button type="button" class="city-filter px-3 py-1.5 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-md text-xs shadow-sm border border-dark-200/50 dark:border-dark-600/50 hover:bg-dark-100 dark:hover:bg-dark-600 transition-colors" data-city="Neenah" data-state="WI">Neenah</button>
              <button type="button" class="city-filter px-3 py-1.5 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-md text-xs shadow-sm border border-dark-200/50 dark:border-dark-600/50 hover:bg-dark-100 dark:hover:bg-dark-600 transition-colors" data-city="Sheboygan" data-state="WI">Sheboygan</button>
              <button type="button" class="city-filter px-3 py-1.5 bg-primary text-white rounded-md text-xs shadow-sm" data-city="ALL" data-state="WI">All WI Cities</button>
            </div>
            
            <!-- City filters for Minnesota -->
            <div id="mn-cities-filter" class="flex flex-wrap gap-2 mb-5 city-filters hidden">
              <button type="button" class="city-filter px-3 py-1.5 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-md text-xs shadow-sm border border-dark-200/50 dark:border-dark-600/50 hover:bg-dark-100 dark:hover:bg-dark-600 transition-colors" data-city="Minneapolis" data-state="MN">Minneapolis</button>
              <button type="button" class="city-filter px-3 py-1.5 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-md text-xs shadow-sm border border-dark-200/50 dark:border-dark-600/50 hover:bg-dark-100 dark:hover:bg-dark-600 transition-colors" data-city="St. Paul" data-state="MN">St. Paul</button>
              <button type="button" class="city-filter px-3 py-1.5 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-md text-xs shadow-sm border border-dark-200/50 dark:border-dark-600/50 hover:bg-dark-100 dark:hover:bg-dark-600 transition-colors" data-city="Bloomington" data-state="MN">Bloomington</button>
              <button type="button" class="city-filter px-3 py-1.5 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-md text-xs shadow-sm border border-dark-200/50 dark:border-dark-600/50 hover:bg-dark-100 dark:hover:bg-dark-600 transition-colors" data-city="Brooklyn Center" data-state="MN">Brooklyn Center</button>
              <button type="button" class="city-filter px-3 py-1.5 bg-primary text-white rounded-md text-xs shadow-sm" data-city="ALL" data-state="MN">All MN Cities</button>
            </div>
            
            <!-- More city filters will dynamically appear for other states -->
            
          </div>

          <!-- Records List -->
          <div id="records-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Records will be populated here via JavaScript -->
          </div>
          
          <script>
            // Function to initialize records list with store data
            function initializeStoreRecords(filterState = null, filterCity = null) {
              const recordsList = document.getElementById('records-list');
              if (!recordsList) return;
              
              // Clear any existing content
              recordsList.innerHTML = '';
              
              // Get the stores to display - use combined stores if available
              let storeData = window.allStores || window.musicStores || [];
              
              if (storeData.length === 0) {
                recordsList.innerHTML = `
                  <div class="col-span-full">
                    <div class="bg-yellow-50 dark:bg-dark-800 border-l-4 border-yellow-400 p-4 rounded-lg">
                      <p class="text-yellow-700 dark:text-yellow-400">No store records found. Please check your data source.</p>
                    </div>
                  </div>
                `;
                return;
              }
              
              // Group stores by state and city
              const storesByLocation = {};
              storeData.forEach(store => {
                if (!storesByLocation[store.state]) {
                  storesByLocation[store.state] = {};
                }
                
                if (!storesByLocation[store.state][store.city]) {
                  storesByLocation[store.state][store.city] = [];
                }
                
                storesByLocation[store.state][store.city].push(store);
              });
              
              // Apply filters if specified
              let storesToDisplay = [];
              
              if (filterState && filterState !== 'ALL') {
                if (filterCity && filterCity !== 'ALL') {
                  // Specific city in a specific state
                  storesToDisplay = storesByLocation[filterState]?.[filterCity] || [];
                } else {
                  // All cities in a specific state
                  const cities = storesByLocation[filterState] || {};
                  Object.values(cities).forEach(cityStores => {
                    storesToDisplay = storesToDisplay.concat(cityStores);
                  });
                }
              } else {
                // All states or no filter
                for (const state in storesByLocation) {
                  for (const city in storesByLocation[state]) {
                    storesToDisplay = storesToDisplay.concat(storesByLocation[state][city]);
                  }
                }
              }
              
              // If no specific filter, prioritize Milwaukee, WI
              if (!filterState || filterState === 'ALL') {
                // Extract Milwaukee stores
                const milwaukeeStores = storesByLocation?.['WI']?.['Milwaukee'] || [];
                
                // Remove Milwaukee stores from the main array to avoid duplicates
                storesToDisplay = storesToDisplay.filter(store => 
                  !(store.state === 'WI' && store.city === 'Milwaukee')
                );
                
                // Add Milwaukee stores at the beginning
                storesToDisplay = [...milwaukeeStores, ...storesToDisplay];
              }
              
              // Handle Milwaukee Area special case
              if (filterState === 'WI' && filterCity === 'Milwaukee Area') {
                applyMilwaukeeAreaFilter();
                return;
              }
              
              // If no records after filtering
              if (storesToDisplay.length === 0) {
                recordsList.innerHTML = `
                  <div class="col-span-full">
                    <div class="bg-yellow-50 dark:bg-dark-800 border-l-4 border-yellow-400 p-4 rounded-lg">
                      <p class="text-yellow-700 dark:text-yellow-400">No stores found with the current filters.</p>
                    </div>
                  </div>
                `;
                return;
              }
              
              // Add location headers
              let currentState = null;
              let currentCity = null;
              let stateHeader = null;
              
              // Render each store as a record card
              storesToDisplay.forEach((store) => {
                const recordCard = document.createElement('div');
                recordCard.className = 'bg-white dark:bg-dark-800 rounded-2xl shadow-md p-6 border border-dark-100/50 dark:border-dark-700/50 card-3d';
                
                // Use verified/estimated badge for location status
                const locationBadge = store.estimatedCoordinates ? 
                  '<span class="px-2 py-1 text-xs bg-amber-100 dark:bg-amber-900/30 text-amber-800 dark:text-amber-200 rounded-full">Estimated location</span>' : 
                  '<span class="px-2 py-1 text-xs bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-200 rounded-full">Verified location</span>';
                
                recordCard.innerHTML = `
                  <div class="flex justify-between items-start mb-2">
                    <h3 class="text-lg font-display font-bold text-dark-900 dark:text-white">${store.name}</h3>
                    ${locationBadge}
                  </div>
                  <p class="text-dark-600 dark:text-dark-400 text-sm mb-3">
                    ${store.address}, ${store.city}, ${store.state} ${store.zip}
                  </p>
                  <div class="flex flex-col gap-2 mb-3 text-sm">
                    <div class="flex items-center">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-dark-400 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                      </svg>
                      <span class="text-dark-700 dark:text-dark-300">${store.phone}</span>
                    </div>
                    ${store.website ? `
                      <div class="flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-dark-400 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9" />
                        </svg>
                        <a href="https://${store.website}" target="_blank" class="text-primary hover:underline">${store.website}</a>
                      </div>
                    ` : ''}
                    ${store.email ? `
                      <div class="flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-dark-400 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                        </svg>
                        <a href="mailto:${store.email}" class="text-primary hover:underline">${store.email}</a>
                      </div>
                    ` : ''}
                  </div>
                  <div class="flex flex-wrap gap-2 mt-2">
                    ${store.tags.map(tag => `<span class="px-2 py-1 bg-primary-100 dark:bg-primary-900/30 text-primary-800 dark:text-primary-200 rounded text-xs">${tag}</span>`).join('')}
                  </div>
                  <div class="mt-4 flex justify-between items-center">
                    <button type="button" class="text-sm px-3 py-1.5 bg-dark-100 dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-lg hover:bg-dark-200 dark:hover:bg-dark-600 transition-colors" onclick="addContact('${store.name}', '${store.email}', '${store.phone}')">
                      Add Contact
                    </button>
                    <button type="button" class="text-sm px-3 py-1.5 gradient-btn text-white rounded-lg hover:shadow-md transition-all" onclick="viewOnMap('${store.lat}', '${store.lng}', '${store.name}')">
                      View on Map
                    </button>
                  </div>
                `;
                
                // Create or update state/city headers
                if (store.state !== currentState || store.city !== currentCity) {
                  // Create state header if needed
                  if (store.state !== currentState) {
                    currentState = store.state;
                    stateHeader = document.createElement('div');
                    stateHeader.className = 'col-span-full bg-gradient-to-r from-primary-50/70 to-transparent dark:from-primary-900/30 dark:to-transparent p-3 my-3 rounded-xl';
                    stateHeader.innerHTML = `
                      <h2 class="text-xl font-display font-bold text-primary-700 dark:text-primary-300">${currentState}</h2>
                    `;
                    recordsList.appendChild(stateHeader);
                  }
                  
                  // Create city header
                  currentCity = store.city;
                  const cityHeader = document.createElement('div');
                  cityHeader.className = 'col-span-full flex items-center gap-2 py-2 px-3 my-2';
                  
                  // Special styling for Milwaukee
                  const isMilwaukee = store.state === 'WI' && store.city === 'Milwaukee';
                  const cityIconColor = isMilwaukee ? 'text-secondary' : 'text-primary-400 dark:text-primary-500';
                  const cityTextColor = isMilwaukee ? 'text-secondary-700 dark:text-secondary-300 font-semibold' : 'text-dark-700 dark:text-dark-300';
                  
                  cityHeader.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ${cityIconColor}" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                    <h3 class="text-lg ${cityTextColor}">${currentCity}</h3>
                  `;
                  recordsList.appendChild(cityHeader);
                }
                
                recordsList.appendChild(recordCard);
              });
              
              // Update city filter visibility based on selected state
              updateCityFilters(filterState);
            }
            
            // Update visible city filters based on selected state
            function updateCityFilters(state) {
              // Hide all city filters first
              document.querySelectorAll('.city-filters').forEach(el => {
                el.classList.add('hidden');
              });
              
              // Show specific city filters if a state is selected
              if (state && state !== 'ALL') {
                const cityFilters = document.getElementById(`${state.toLowerCase()}-cities-filter`);
                if (cityFilters) {
                  cityFilters.classList.remove('hidden');
                }
              }
            }
            
            // Setup event handlers for state and city filters
            document.addEventListener('DOMContentLoaded', function() {
              // State filter buttons
              document.querySelectorAll('.records-state-filter').forEach(btn => {
                btn.addEventListener('click', function() {
                  // Update button styles
                  document.querySelectorAll('.records-state-filter').forEach(b => {
                    b.classList.remove('bg-primary', 'text-white');
                    b.classList.add('bg-white', 'dark:bg-dark-700', 'text-dark-700', 'dark:text-dark-300');
                  });
                  this.classList.remove('bg-white', 'dark:bg-dark-700', 'text-dark-700', 'dark:text-dark-300');
                  this.classList.add('bg-primary', 'text-white');
                  
                  // Get selected state
                  const state = this.dataset.state;
                  
                  // Initialize records with state filter
                  initializeStoreRecords(state);
                });
              });
              
              // City filter buttons
              document.querySelectorAll('.city-filter').forEach(btn => {
                btn.addEventListener('click', function() {
                  // Update button styles within the current city filter group
                  const parent = this.closest('.city-filters');
                  if (parent) {
                    parent.querySelectorAll('.city-filter').forEach(b => {
                      b.classList.remove('bg-secondary', 'bg-primary', 'text-white');
                      b.classList.add('bg-white', 'dark:bg-dark-700', 'text-dark-700', 'dark:text-dark-300');
                    });
                  }
                  
                  this.classList.remove('bg-white', 'dark:bg-dark-700', 'text-dark-700', 'dark:text-dark-300');
                  
                  // Special styling for Milwaukee
                  if (this.dataset.city === 'Milwaukee' && this.dataset.state === 'WI') {
                    this.classList.add('bg-secondary', 'text-white');
                  } else {
                    this.classList.add('bg-primary', 'text-white');
                  }
                  
                  // Get selected state and city
                  const state = this.dataset.state;
                  const city = this.dataset.city;
                  
                  // Initialize records with state and city filters
                  initializeStoreRecords(state, city);
                });
              });
              
              // Add missing Milwaukee area suburbs to our city filters
              document.addEventListener('DOMContentLoaded', function() {
                // Create Milwaukee Metro Area filter with suburbs
                const wiCitiesFilter = document.getElementById('wi-cities-filter');
                if (wiCitiesFilter) {
                  // Add Milwaukee Area button after Milwaukee
                  const milwaukeeButton = wiCitiesFilter.querySelector('[data-city="Milwaukee"]');
                  if (milwaukeeButton && milwaukeeButton.parentNode) {
                    const metroButton = document.createElement('button');
                    metroButton.type = 'button';
                    metroButton.className = 'city-filter px-3 py-1.5 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-md text-xs shadow-sm border border-dark-200/50 dark:border-dark-600/50 hover:bg-dark-100 dark:hover:bg-dark-600 transition-colors';
                    metroButton.dataset.city = 'Milwaukee Area';
                    metroButton.dataset.state = 'WI';
                    metroButton.textContent = 'Milwaukee Area';
                    milwaukeeButton.parentNode.insertBefore(metroButton, milwaukeeButton.nextSibling);
                    
                    // Add event listener to the metro button
                    metroButton.addEventListener('click', function() {
                      applyMilwaukeeAreaFilter();
                    });
                  }
                }
                
                // Auto-select Milwaukee, WI on first load
                // Click the WI state filter
                const wiButton = document.querySelector('.records-state-filter[data-state="WI"]');
                if (wiButton) {
                  wiButton.click();
                  
                  // After a brief delay, click the Milwaukee city filter
                  setTimeout(() => {
                    const milwaukeeButton = document.querySelector('.city-filter[data-city="Milwaukee"][data-state="WI"]');
                    if (milwaukeeButton) {
                      milwaukeeButton.click();
                    }
                  }, 300);
                }
              });
            });
            
            // Function to apply Milwaukee Area filter - includes Milwaukee and nearby suburbs
            function applyMilwaukeeAreaFilter() {
              const recordsList = document.getElementById('records-list');
              if (!recordsList) return;
              
              // Clear existing content
              recordsList.innerHTML = '';
              
              // Get all stores
              let storeData = window.allStores || window.musicStores || [];
              
              // Create a header for Milwaukee Area
              const areaHeader = document.createElement('div');
              areaHeader.className = 'col-span-full bg-gradient-to-r from-secondary-50/70 to-transparent dark:from-secondary-900/30 dark:to-transparent p-3 my-3 rounded-xl';
              areaHeader.innerHTML = `
                <h2 class="text-xl font-display font-bold text-secondary-700 dark:text-secondary-300">Milwaukee Metro Area</h2>
                <p class="text-sm text-dark-500 dark:text-dark-400">Stores in Milwaukee and surrounding communities</p>
              `;
              recordsList.appendChild(areaHeader);
              
              // Milwaukee proper
              const milwaukeeStores = storeData.filter(store => 
                store.state === 'WI' && store.city === 'Milwaukee'
              );
              
              // Greenfield (Milwaukee suburb)
              const greenfieldStores = storeData.filter(store => 
                store.state === 'WI' && store.city === 'Greenfield'
              );
              
              // Other nearby communities that could be considered Milwaukee area
              const milwaukeeAreaStores = storeData.filter(store => {
                if (store.state !== 'WI') return false;
                
                // Common Milwaukee suburbs and nearby communities
                const milwaukeeAreaCities = [
                  'Wauwatosa', 'West Allis', 'Shorewood', 'Whitefish Bay', 
                  'Glendale', 'Brown Deer', 'River Hills', 'Bayside',
                  'Fox Point', 'Cudahy', 'St. Francis', 'South Milwaukee',
                  'Oak Creek', 'Franklin', 'Hales Corners', 'Greendale',
                  'West Milwaukee', 'Butler', 'Elm Grove', 'Brookfield'
                ];
                
                return milwaukeeAreaCities.includes(store.city) ||
                  // Also include any store with a Milwaukee area zip code (starts with 53)
                  (store.zip && store.zip.startsWith('53'));
              });
              
              // Create city headers and add stores
              if (milwaukeeStores.length > 0) {
                addCityStores('Milwaukee', milwaukeeStores, recordsList, true);
              }
              
              if (greenfieldStores.length > 0) {
                addCityStores('Greenfield', greenfieldStores, recordsList);
              }
              
              // Group other area stores by city
              const otherAreaStoresByCity = {};
              milwaukeeAreaStores.forEach(store => {
                if (!otherAreaStoresByCity[store.city]) {
                  otherAreaStoresByCity[store.city] = [];
                }
                otherAreaStoresByCity[store.city].push(store);
              });
              
              // Add each city's stores
              Object.entries(otherAreaStoresByCity).forEach(([city, stores]) => {
                addCityStores(city, stores, recordsList);
              });
              
              // Update active button styling
              document.querySelectorAll('.city-filter').forEach(btn => {
                btn.classList.remove('bg-secondary', 'bg-primary', 'text-white');
                btn.classList.add('bg-white', 'dark:bg-dark-700', 'text-dark-700', 'dark:text-dark-300');
              });
              
              const metroButton = document.querySelector('.city-filter[data-city="Milwaukee Area"]');
              if (metroButton) {
                metroButton.classList.remove('bg-white', 'dark:bg-dark-700', 'text-dark-700', 'dark:text-dark-300');
                metroButton.classList.add('bg-secondary', 'text-white');
              }
            }
            
            // Helper function to add city stores with appropriate headers
            function addCityStores(city, stores, container, isPrimary = false) {
              if (!stores || !stores.length) return;
              
              // Create city header
              const cityHeader = document.createElement('div');
              cityHeader.className = 'col-span-full flex items-center gap-2 py-2 px-3 my-2';
              
              // Special styling for primary city (Milwaukee)
              const cityIconColor = isPrimary ? 'text-secondary' : 'text-primary-400 dark:text-primary-500';
              const cityTextColor = isPrimary ? 'text-secondary-700 dark:text-secondary-300 font-semibold' : 'text-dark-700 dark:text-dark-300';
              
              cityHeader.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ${cityIconColor}" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
                <h3 class="text-lg ${cityTextColor}">${city}</h3>
              `;
              container.appendChild(cityHeader);
              
              // Add individual store cards
              stores.forEach(store => {
                const recordCard = document.createElement('div');
                recordCard.className = 'bg-white dark:bg-dark-800 rounded-2xl shadow-md p-6 border border-dark-100/50 dark:border-dark-700/50 card-3d';
                
                // Use verified/estimated badge for location status
                const locationBadge = store.estimatedCoordinates ? 
                  '<span class="px-2 py-1 text-xs bg-amber-100 dark:bg-amber-900/30 text-amber-800 dark:text-amber-200 rounded-full">Estimated location</span>' : 
                  '<span class="px-2 py-1 text-xs bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-200 rounded-full">Verified location</span>';
                
                recordCard.innerHTML = `
                  <div class="flex justify-between items-start mb-2">
                    <h3 class="text-lg font-display font-bold text-dark-900 dark:text-white">${store.name}</h3>
                    ${locationBadge}
                  </div>
                  <p class="text-dark-600 dark:text-dark-400 text-sm mb-3">
                    ${store.address}, ${store.city}, ${store.state} ${store.zip}
                  </p>
                  <div class="flex flex-col gap-2 mb-3 text-sm">
                    <div class="flex items-center">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-dark-400 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                      </svg>
                      <span class="text-dark-700 dark:text-dark-300">${store.phone}</span>
                    </div>
                    ${store.website ? `
                      <div class="flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-dark-400 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9" />
                        </svg>
                        <a href="https://${store.website}" target="_blank" class="text-primary hover:underline">${store.website}</a>
                      </div>
                    ` : ''}
                    ${store.email ? `
                      <div class="flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-dark-400 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                        </svg>
                        <a href="mailto:${store.email}" class="text-primary hover:underline">${store.email}</a>
                      </div>
                    ` : ''}
                  </div>
                  <div class="flex flex-wrap gap-2 mt-2">
                    ${store.tags.map(tag => `<span class="px-2 py-1 bg-primary-100 dark:bg-primary-900/30 text-primary-800 dark:text-primary-200 rounded text-xs">${tag}</span>`).join('')}
                  </div>
                  <div class="mt-4 flex justify-between items-center">
                    <button type="button" class="text-sm px-3 py-1.5 bg-dark-100 dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-lg hover:bg-dark-200 dark:hover:bg-dark-600 transition-colors" onclick="addContact('${store.name}', '${store.email}', '${store.phone}')">
                      Add Contact
                    </button>
                    <button type="button" class="text-sm px-3 py-1.5 gradient-btn text-white rounded-lg hover:shadow-md transition-all" onclick="viewOnMap('${store.lat}', '${store.lng}', '${store.name}')">
                      View on Map
                    </button>
                  </div>
                `;
                
                container.appendChild(recordCard);
              });
            }
            
            // Function to view store on map
            function viewOnMap(lat, lng, name) {
              if (!window.map) {
                console.error("Map not initialized");
                return;
              }
              
              // Activate map tab
              document.querySelectorAll('[data-tab="map"]').forEach(tab => {
                tab.click();
              });
              
              // Pan to location
              window.map.panTo({lat: parseFloat(lat), lng: parseFloat(lng)});
              window.map.setZoom(14);
              
              // Find and click the marker
              if (window.storeMarkers) {
                const marker = window.storeMarkers.find(m => 
                  m.getPosition().lat() === parseFloat(lat) && 
                  m.getPosition().lng() === parseFloat(lng));
                
                if (marker) {
                  google.maps.event.trigger(marker, 'click');
                }
              }
            }
            
            // Function to add contact (placeholder functionality)
            function addContact(name, email, phone) {
              alert(`Contact added: ${name}\nEmail: ${email}\nPhone: ${phone}`);
              // In a real implementation, this would add to a contacts database
            }
            
            // Initialize records when the records tab is shown
            document.querySelectorAll('[data-tab="records"]').forEach(tab => {
              tab.addEventListener('click', function() {
                initializeStoreRecords();
              });
            });
          </script>
        </section>

        <!-- File Browser Tab -->
        <section id="file-browser-tab" class="hidden space-y-6">
          <div class="bg-white/90 dark:bg-dark-800/90 backdrop-blur-lg rounded-2xl shadow-lg p-6 border border-dark-100/50 dark:border-dark-700/50">
            <h2 class="text-xl font-display font-bold mb-4 text-dark-900 dark:text-white">File Browser</h2>
            
            <!-- Search and Filter Bar -->
            <div class="flex flex-wrap gap-3 mb-6">
              <div class="relative flex-grow">
                <input type="text" id="file-search" placeholder="Search files..." class="w-full p-3 pl-10 bg-dark-100/50 dark:bg-dark-700/50 border-0 rounded-xl focus:ring-2 focus:ring-primary" aria-label="Search files">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 absolute left-3 top-3.5 text-dark-400 dark:text-dark-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                </svg>
              </div>

              <select id="file-filter" class="p-3 bg-dark-100/50 dark:bg-dark-700/50 border-0 rounded-xl focus:ring-2 focus:ring-primary text-dark-700 dark:text-dark-300" aria-label="Filter files">
                <option value="all">All Files</option>
                <option value="html">HTML</option>
                <option value="js">JavaScript</option>
                <option value="css">CSS</option>
                <option value="images">Images</option>
                <option value="other">Other</option>
              </select>
            </div>

            <!-- File Categories Toggle -->
            <div class="flex flex-wrap gap-2 mb-6">
              <button type="button" class="file-category-btn px-3 py-1.5 bg-primary text-white rounded-full text-sm shadow-sm hover:shadow-md transition-all duration-200" data-category="all">All Files</button>
              <button type="button" class="file-category-btn px-3 py-1.5 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-full text-sm shadow-sm hover:shadow-md transition-all duration-200" data-category="html">HTML</button>
              <button type="button" class="file-category-btn px-3 py-1.5 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-full text-sm shadow-sm hover:shadow-md transition-all duration-200" data-category="js">JavaScript</button>
              <button type="button" class="file-category-btn px-3 py-1.5 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-full text-sm shadow-sm hover:shadow-md transition-all duration-200" data-category="css">CSS</button>
              <button type="button" class="file-category-btn px-3 py-1.5 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-full text-sm shadow-sm hover:shadow-md transition-all duration-200" data-category="images">Images</button>
              <button type="button" class="file-category-btn px-3 py-1.5 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-full text-sm shadow-sm hover:shadow-md transition-all duration-200" data-category="other">Other</button>
            </div>
            
            <!-- Current Path and Navigation -->
            <div class="flex items-center mb-4 py-2 px-3 bg-dark-50/50 dark:bg-dark-800/50 rounded-lg text-sm">
              <span class="text-primary-600 dark:text-primary-400 font-medium">Current Location:</span>
              <div class="ml-2 flex items-center gap-1 text-dark-600 dark:text-dark-400">
                <span class="cursor-pointer hover:text-primary transition-colors" onclick="navigateFileBrowser('/')">/</span>
                <span class="text-dark-400">/</span>
                <span class="cursor-pointer hover:text-primary transition-colors">user_site</span>
                <span class="text-dark-400">/</span>
                <span class="cursor-pointer hover:text-primary transition-colors">src</span>
              </div>
            </div>
          </div>
          
          <!-- File Listing Section -->
          <div class="bg-white/90 dark:bg-dark-800/90 backdrop-blur-lg rounded-2xl shadow-lg border border-dark-100/50 dark:border-dark-700/50 overflow-hidden">
            <!-- File List Header -->
            <div class="grid grid-cols-12 bg-dark-50 dark:bg-dark-700/70 p-3 text-sm font-medium text-dark-700 dark:text-dark-300 border-b border-dark-100/50 dark:border-dark-700/50">
              <div class="col-span-6">Name</div>
              <div class="col-span-2">Type</div>
              <div class="col-span-2">Size</div>
              <div class="col-span-2">Actions</div>
            </div>
            
            <!-- File List (will be populated by JavaScript) -->
            <div id="file-list" class="max-h-[60vh] overflow-y-auto">
              <!-- Loading placeholder -->
              <div class="animate-pulse p-4 space-y-3">
                <div class="h-10 bg-dark-200/50 dark:bg-dark-600/50 rounded"></div>
                <div class="h-10 bg-dark-200/50 dark:bg-dark-600/50 rounded"></div>
                <div class="h-10 bg-dark-200/50 dark:bg-dark-600/50 rounded"></div>
                <div class="h-10 bg-dark-200/50 dark:bg-dark-600/50 rounded"></div>
                <div class="h-10 bg-dark-200/50 dark:bg-dark-600/50 rounded"></div>
              </div>
            </div>
          </div>
          
          <!-- File Preview Modal (hidden by default) -->
          <div id="file-preview-modal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center">
            <div class="bg-white dark:bg-dark-800 rounded-2xl shadow-xl max-w-4xl w-full max-h-[90vh] flex flex-col">
              <div class="flex justify-between items-center p-4 border-b border-dark-100/50 dark:border-dark-700/50">
                <h3 class="text-lg font-display font-bold text-dark-900 dark:text-white" id="preview-file-name">File Preview</h3>
                <button type="button" id="close-preview" class="p-2 text-dark-500 hover:bg-dark-100 dark:hover:bg-dark-700/50 rounded-lg">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                  </svg>
                </button>
              </div>
              <div class="p-4 flex-1 overflow-auto" id="preview-content">
                <!-- Preview content will be inserted here -->
              </div>
              <div class="p-4 flex justify-end gap-3 border-t border-dark-100/50 dark:border-dark-700/50">
                <button type="button" id="close-preview-btn" class="px-4 py-2 text-dark-700 dark:text-dark-300 bg-dark-100 dark:bg-dark-700 hover:bg-dark-200 dark:hover:bg-dark-600 rounded-lg transition-colors">
                  Close
                </button>
              </div>
            </div>
          </div>
        </section>

        <!-- Other Tab Contents will follow the same visual pattern (hidden) -->
        <!-- We're only including one tab fully to keep the code compact -->

        <!-- AI Assistant Panel - Fixed in bottom right -->
        <div class="agent-panel bg-white/90 dark:bg-dark-800/90 backdrop-blur-lg rounded-2xl shadow-lg border border-dark-100/50 dark:border-dark-700/50 overflow-hidden">
          <div class="p-4 border-b border-dark-200/30 dark:border-dark-700/30 flex items-center justify-between">
            <div class="flex items-center">
              <div class="w-10 h-10 rounded-full bg-gradient-to-r from-primary to-secondary flex items-center justify-center text-white shadow-md mr-3">
                ðŸ§ 
              </div>
              <div>
                <h3 class="font-display font-bold text-dark-900 dark:text-white">Agent Lee</h3>
                <p class="text-xs text-dark-500 dark:text-dark-400">Virtual Assistant</p>
              </div>
            </div>
            <div class="flex items-center space-x-2">
              <button type="button" id="minimize-agent" class="p-2 text-dark-500 dark:text-dark-400 hover:bg-dark-100 dark:hover:bg-dark-700/50 rounded-lg">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
              </button>
              <button type="button" id="close-agent" class="p-2 text-dark-500 dark:text-dark-400 hover:bg-dark-100 dark:hover:bg-dark-700/50 rounded-lg">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
              </button>
            </div>
          </div>
          
          <div class="p-4 h-80 overflow-y-auto" id="agent-chat">
            <div class="flex items-start mb-4">
              <div class="w-8 h-8 rounded-full bg-gradient-to-r from-primary to-secondary flex-shrink-0 flex items-center justify-center text-white shadow-sm mr-2">
                ðŸ§ 
              </div>
              <div class="bg-dark-100/70 dark:bg-dark-700/70 rounded-2xl rounded-tl-none p-3 max-w-[85%]">
                <p class="text-dark-900 dark:text-white text-sm">Hello! I'm Agent Lee, your AI assistant. How can I help you today? You can ask me to find leads, create campaigns, or help with any other tasks.</p>
              </div>
            </div>
          </div>
          
          <div class="p-4 border-t border-dark-200/30 dark:border-dark-700/30">
            <div class="relative">
              <input type="text" id="agent-input" placeholder="Type a message..." class="w-full p-3 pr-12 bg-dark-100/50 dark:bg-dark-700/50 border-0 rounded-xl focus:ring-2 focus:ring-primary" aria-label="Message Agent Lee">
              <button type="button" id="send-message" class="absolute right-2 top-2 p-2 text-primary rounded-lg hover:bg-dark-100 dark:hover:bg-dark-700/50">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5l7 7-7 7M5 5l7 7-7 7" />
                </svg>
              </button>
            </div>
            <div class="flex justify-between mt-3">
              <div class="flex items-center space-x-2 text-xs text-dark-500 dark:text-dark-400">
                <button type="button" class="p-1.5 hover:bg-dark-100 dark:hover:bg-dark-700/50 rounded-lg flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />
                  </svg>
                  Voice
                </button>
                <button type="button" class="p-1.5 hover:bg-dark-100 dark:hover:bg-dark-700/50 rounded-lg flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                  </svg>
                  Commands
                </button>
              </div>
              <span class="text-xs text-dark-500 dark:text-dark-400">Powered by AI</span>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- File Browser Script -->
  <script>
    // File data for the file browser
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize file browser when that tab is clicked
      document.querySelectorAll('[data-tab="file-browser"]').forEach(tab => {
        tab.addEventListener('click', initializeFileBrowser);
      });
      
      // Close preview modal handlers
      document.getElementById('close-preview').addEventListener('click', closePreviewModal);
      document.getElementById('close-preview-btn').addEventListener('click', closePreviewModal);
      
      // Search functionality for file browser
      document.getElementById('file-search').addEventListener('input', function(e) {
        filterFiles(e.target.value);
      });
      
      // Filter by file type
      document.getElementById('file-filter').addEventListener('change', function(e) {
        filterFilesByType(e.target.value);
      });
      
      // Category buttons
      document.querySelectorAll('.file-category-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          document.querySelectorAll('.file-category-btn').forEach(b => {
            b.classList.remove('bg-primary', 'text-white');
            b.classList.add('bg-white', 'dark:bg-dark-700', 'text-dark-700', 'dark:text-dark-300');
          });
          this.classList.remove('bg-white', 'dark:bg-dark-700', 'text-dark-700', 'dark:text-dark-300');
          this.classList.add('bg-primary', 'text-white');
          filterFilesByCategory(this.dataset.category);
        });
      });
    });
    
    // Initialize the file browser
    function initializeFileBrowser() {
      const fileList = document.getElementById('file-list');
      if (!fileList) return;
      
      // Clear any existing content
      fileList.innerHTML = '';
      
      // Define file data from the project
      const files = [
        // HTML files
        { name: "index.html", type: "html", category: "html", size: "92 KB" },
        { name: "AgentLeeCard.html", type: "html", category: "html", size: "11 KB" },
        { name: "3vbc1ug9ib.html", type: "html", category: "html", size: "1 KB" },
        { name: "4njqof8sac.html", type: "html", category: "html", size: "7 KB" },
        { name: "du5a0x225p.html", type: "html", category: "html", size: "1 KB" },
        { name: "ka0635f7b8.html", type: "html", category: "html", size: "2 KB" },
        { name: "q7vpglh4fe.html", type: "html", category: "html", size: "1 KB" },
        { name: "v6khtqiym8.html", type: "html", category: "html", size: "1 KB" },
        { name: "lzjlad8ft6.html", type: "html", category: "html", size: "1 KB" },
        { name: "dot90ev7wr.html", type: "html", category: "html", size: "7 KB" },
        { name: "s0561yfcjv.html", type: "html", category: "html", size: "2 KB" },
        { name: "7g7z2fsdp3.html", type: "html", category: "html", size: "1 KB" },
        { name: "0cgjiz0xi1.html", type: "html", category: "html", size: "1 KB" },
        { name: "2ewv42c2t8.html", type: "html", category: "html", size: "1 KB" },
        
        // JavaScript files
        { name: "complete_music_store_list.js", type: "js", category: "js", size: "5 KB" },
        { name: "config.js", type: "js", category: "js", size: "7 KB" },
        { name: "configExample.js", type: "js", category: "js", size: "1 KB" },
        { name: "configLoader.js", type: "js", category: "js", size: "2 KB" },
        { name: "gh.js", type: "js", category: "js", size: "61 KB" },
        { name: "service-worker.js", type: "js", category: "js", size: "2 KB" },
        { name: "l1ttpambe2.js", type: "js", category: "js", size: "7 KB" },
        { name: "qlgm73cyjz.js", type: "js", category: "js", size: "1 KB" },
        { name: "kxtf77li8h.js", type: "js", category: "js", size: "2 KB" },
        { name: "pzgx9k17y2.js", type: "js", category: "js", size: "2 KB" },
        { name: "x8tbppozh8.js", type: "js", category: "js", size: "61 KB" },
        
        // CSS files
        { name: "styles.css", type: "css", category: "css", size: "6 KB" },
        { name: "nwwuny6v6u.css", type: "css", category: "css", size: "2 KB" },
        
        // Images
        { name: "4uu4f0ws4a.png", type: "png", category: "images", size: "379 KB" },
        { name: "cfm7v8uerr.png", type: "png", category: "images", size: "2.3 MB" },
        { name: "digitalcard.png", type: "png", category: "images", size: "249 B" },
        { name: "glvem36f3u.png", type: "png", category: "images", size: "249 B" },
        { name: "qr_rapidwebdevelopbusinesscard.png", type: "png", category: "images", size: "851 B" },
        { name: "rapidwebdevelop_qr.png", type: "png", category: "images", size: "2.2 MB" },
        { name: "screenshot_c6ad.png", type: "png", category: "images", size: "190 KB" },
        { name: "bp0pz53y07.png", type: "png", category: "images", size: "851 B" },
        
        // Other files
        { name: "add1.mp4", type: "mp4", category: "other", size: "3.3 MB" },
        { name: "add2.mp4", type: "mp4", category: "other", size: "1.7 MB" },
        { name: "complete_music_store_list.txt", type: "txt", category: "other", size: "55 KB" },
        { name: "favicon.ico", type: "ico", category: "other", size: "2 KB" },
        { name: "index.html.backup", type: "backup", category: "other", size: "330 KB" }
      ];
      
      // Sort files by name
      files.sort((a, b) => a.name.localeCompare(b.name));
      
      // Build file list
      files.forEach(file => {
        const fileRow = document.createElement('div');
        fileRow.className = 'grid grid-cols-12 p-3 border-b border-dark-100/30 dark:border-dark-700/30 hover:bg-dark-50/70 dark:hover:bg-dark-700/50 text-sm file-item';
        fileRow.dataset.filename = file.name;
        fileRow.dataset.filetype = file.type;
        fileRow.dataset.category = file.category;
        
        // Choose icon based on file type
        let fileIcon = '';
        switch(file.type) {
          case 'html':
            fileIcon = '<svg class="h-5 w-5 text-orange-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M12.316 3.051a1 1 0 01.633 1.265l-4 12a1 1 0 11-1.898-.632l4-12a1 1 0 011.265-.633zM5.707 6.293a1 1 0 010 1.414L3.414 10l2.293 2.293a1 1 0 11-1.414 1.414l-3-3a1 1 0 010-1.414l3-3a1 1 0 011.414 0zm8.586 0a1 1 0 011.414 0l3 3a1 1 0 010 1.414l-3 3a1 1 0 11-1.414-1.414L16.586 10l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>';
            break;
          case 'js':
            fileIcon = '<svg class="h-5 w-5 text-yellow-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 2a8 8 0 100 16 8 8 0 000-16zm0 2a6 6 0 00-4.393 10.072c.117-.171.3-.273.5-.273h1.393v-.639c0-.33.27-.6.6-.6h.904c.33 0 .6.27.6.6V15h5c.292 0 .521-.21.572-.498A6 6 0 0010 4z" clip-rule="evenodd"></path></svg>';
            break;
          case 'css':
            fileIcon = '<svg class="h-5 w-5 text-blue-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M12.316 3.051a1 1 0 01.633 1.265l-4 12a1 1 0 11-1.898-.632l4-12a1 1 0 011.265-.633zM6.707 6.293a1 1 0 010 1.414L3.414 10l3.293 3.293a1 1 0 11-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0zm6.586 0a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 11-1.414-1.414L16.586 10l-3.293-3.293a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>';
            break;
          case 'png':
          case 'jpg':
          case 'jpeg':
          case 'gif':
            fileIcon = '<svg class="h-5 w-5 text-green-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd"></path></svg>';
            break;
          default:
            fileIcon = '<svg class="h-5 w-5 text-gray-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z" clip-rule="evenodd"></path></svg>';
        }
        
        fileRow.innerHTML = `
          <div class="col-span-6 flex items-center gap-2">
            ${fileIcon}
            <span class="truncate">${file.name}</span>
          </div>
          <div class="col-span-2 text-dark-500 dark:text-dark-400">${file.type}</div>
          <div class="col-span-2 text-dark-500 dark:text-dark-400">${file.size}</div>
          <div class="col-span-2 flex gap-2 justify-end">
            <button class="p-1.5 hover:bg-dark-100 dark:hover:bg-dark-600 rounded-lg text-primary transition-colors" onclick="previewFile('${file.name}', '${file.type}')">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
              </svg>
            </button>
          </div>
        `;
        
        fileList.appendChild(fileRow);
      });
    }
    
    // Filter files by search term
    function filterFiles(searchTerm) {
      searchTerm = searchTerm.toLowerCase();
      document.querySelectorAll('.file-item').forEach(item => {
        const fileName = item.dataset.filename.toLowerCase();
        if (fileName.includes(searchTerm)) {
          item.classList.remove('hidden');
        } else {
          item.classList.add('hidden');
        }
      });
    }
    
    // Filter files by type
    function filterFilesByType(fileType) {
      document.querySelectorAll('.file-item').forEach(item => {
        if (fileType === 'all' || item.dataset.filetype === fileType) {
          item.classList.remove('hidden');
        } else {
          item.classList.add('hidden');
        }
      });
    }
    
    // Filter files by category
    function filterFilesByCategory(category) {
      document.querySelectorAll('.file-item').forEach(item => {
        if (category === 'all' || item.dataset.category === category) {
          item.classList.remove('hidden');
        } else {
          item.classList.add('hidden');
        }
      });
    }
    
    // Preview file
    function previewFile(fileName, fileType) {
      const previewModal = document.getElementById('file-preview-modal');
      const previewContent = document.getElementById('preview-content');
      const previewFileName = document.getElementById('preview-file-name');
      
      previewFileName.textContent = fileName;
      
      // Display different preview based on file type
      if (['jpg', 'jpeg', 'png', 'gif'].includes(fileType)) {
        // Image preview
        previewContent.innerHTML = `<img src="${fileName}" alt="${fileName}" class="max-w-full max-h-[60vh] mx-auto">`;
      } else if (fileType === 'mp4') {
        // Video preview
        previewContent.innerHTML = `
          <video controls class="max-w-full max-h-[60vh] mx-auto">
            <source src="${fileName}" type="video/mp4">
            Your browser does not support the video tag.
          </video>
        `;
      } else {
        // Text file preview - for simplicity, just show a message
        previewContent.innerHTML = `
          <div class="bg-dark-50/50 dark:bg-dark-700/50 p-4 rounded-lg">
            <p class="text-center text-dark-600 dark:text-dark-400">
              Preview for ${fileName} would be displayed here.
              <br><br>
              In a full implementation, the content would be fetched and displayed appropriately.
            </p>
          </div>
        `;
      }
      
      // Show the modal
      previewModal.classList.remove('hidden');
    }
    
    // Close preview modal
    function closePreviewModal() {
      document.getElementById('file-preview-modal').classList.add('hidden');
    }
  </script>
  
  <!-- Store markers and analytics handling -->
  <script>
    // Function to add markers for all stores
    function addAllStoreMarkers() {
      if (!window.map || !window.google) {
        console.error("Map not initialized, cannot add store markers");
        return;
      }
      
      // Clear any existing markers
      if (window.storeMarkers) {
        window.storeMarkers.forEach(marker => marker.setMap(null));
      }
      window.storeMarkers = [];
      
      // Get the stores to display - use combined stores if available, otherwise fallback
      const storesToDisplay = window.allStores || window.musicStores || [];
      
      if (storesToDisplay.length === 0) {
        console.warn("No store data available to display markers");
        return;
      }
      
      console.log(`Adding ${storesToDisplay.length} store markers to the map`);
      
      // Create info window for marker details
      const infoWindow = new google.maps.InfoWindow();
      
      // Add markers for each store
      storesToDisplay.forEach((store, index) => {
        // Skip if lat/lng is missing
        if (!store.lat || !store.lng) {
          console.warn(`Store ${store.name} missing coordinates, skipping marker`);
          return;
        }
        
        // Create marker for this store
        const marker = new google.maps.Marker({
          position: { lat: store.lat, lng: store.lng },
          map: window.map,
          title: store.name,
          icon: store.estimatedCoordinates ? 
            { url: 'http://maps.google.com/mapfiles/ms/icons/blue-dot.png' } : 
            { url: 'http://maps.google.com/mapfiles/ms/icons/red-dot.png' },
          animation: google.maps.Animation.DROP,
          storeId: index
        });
        
        // Store content for info window
        const contentString = `
          <div class="p-4 max-w-xs">
            <h2 class="text-lg font-semibold mb-1">${store.name}</h2>
            <p class="text-sm text-gray-600 mb-2">${store.address}, ${store.city}, ${store.state} ${store.zip}</p>
            <p class="text-sm mb-2"><strong>Phone:</strong> ${store.phone}</p>
            ${store.website ? `<p class="text-sm mb-2"><strong>Website:</strong> <a href="https://${store.website}" target="_blank" class="text-blue-600 hover:underline">${store.website}</a></p>` : ''}
            ${store.email ? `<p class="text-sm mb-2"><strong>Email:</strong> <a href="mailto:${store.email}" class="text-blue-600 hover:underline">${store.email}</a></p>` : ''}
            <p class="text-sm"><strong>Type:</strong> ${store.tags.join(', ')}</p>
            ${store.estimatedCoordinates ? '<p class="text-xs text-orange-500 mt-2">* Location is approximate</p>' : ''}
          </div>
        `;
        
        // Add click event to show info window
        marker.addListener("click", () => {
          infoWindow.setContent(contentString);
          infoWindow.open(map, marker);
          
          // Update nearby list with active store
          updateNearbyListWithActiveStore(index);
        });
        
        // Save reference to marker
        window.storeMarkers.push(marker);
      });
      
      // Update the nearby list with all stores
      updateNearbyList(storesToDisplay);
    }
    
    // Function to update nearby list display
    function updateNearbyList(stores) {
      const nearbyList = document.getElementById('nearby-list');
      if (!nearbyList) {
        console.warn("Nearby list element not found");
        return;
      }
      
      // Clear loading animation
      nearbyList.innerHTML = '';
      
      // Sort stores by distance or name
      const sortedStores = [...stores];
      
      // Display up to 20 stores in the list
      const storesToShow = sortedStores.slice(0, 20);
      
      if (storesToShow.length === 0) {
        nearbyList.innerHTML = `
          <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded-lg shadow">
            <div class="flex">
              <div class="flex-shrink-0">
                <svg class="h-5 w-5 text-yellow-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                </svg>
              </div>
              <div class="ml-3">
                <p class="text-sm text-yellow-700">
                  No stores found in the current view.
                </p>
              </div>
            </div>
          </div>
        `;
        return;
      }
      
      // Add each store to the list
      storesToShow.forEach((store, index) => {
        const storeElement = document.createElement('div');
        storeElement.className = 'bg-white dark:bg-dark-800/70 rounded-xl p-4 shadow-sm hover:shadow-md transition-all duration-200 cursor-pointer';
        storeElement.dataset.storeId = index;
        
        storeElement.innerHTML = `
          <div class="flex justify-between items-start">
            <div>
              <h3 class="font-medium text-dark-900 dark:text-white">${store.name}</h3>
              <p class="text-sm text-dark-500 dark:text-dark-400">${store.city}, ${store.state}</p>
            </div>
            <span class="px-2 py-1 rounded text-xs ${store.estimatedCoordinates ? 'bg-amber-100 dark:bg-amber-900/30 text-amber-800 dark:text-amber-200' : 'bg-primary-100 dark:bg-primary-900/30 text-primary-800 dark:text-primary-200'}">
              ${store.tags[0]}
            </span>
          </div>
          <div class="mt-2 flex justify-between text-xs text-dark-500 dark:text-dark-400">
            <span>${store.phone}</span>
            <span class="flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
              </svg>
              ${store.estimatedCoordinates ? 'Location approximate' : 'Verified location'}
            </span>
          </div>
        `;
        
        // Add click event to pan to marker on map
        storeElement.addEventListener('click', () => {
          const marker = window.storeMarkers[index];
          if (marker) {
            window.map.panTo(marker.getPosition());
            window.map.setZoom(14);
            google.maps.event.trigger(marker, 'click');
          }
        });
        
        nearbyList.appendChild(storeElement);
      });
    }
    
    // Function to highlight active store in nearby list
    function updateNearbyListWithActiveStore(storeId) {
      const listItems = document.querySelectorAll('#nearby-list > div');
      
      // Remove active class from all items
      listItems.forEach(item => {
        item.classList.remove('ring-2', 'ring-primary', 'dark:ring-primary-400');
      });
      
      // Add active class to selected item
      const activeItem = document.querySelector(`#nearby-list > div[data-store-id="${storeId}"]`);
      if (activeItem) {
        activeItem.classList.add('ring-2', 'ring-primary', 'dark:ring-primary-400');
        activeItem.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      }
    }
    
    // Initialize loading animation
    document.addEventListener('DOMContentLoaded', function() {
      setTimeout(function() {
        const loadingAnimation = document.querySelector('.loading-animation');
        loadingAnimation.classList.add('loading-hide');
      }, 1500);
      
      // Initialize dark mode toggle
      const themeToggleButtons = [document.getElementById('theme-toggle'), document.getElementById('mobile-theme-toggle')];
      
      themeToggleButtons.forEach(button => {
        if (button) {
          button.addEventListener('click', function() {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('darkMode', document.body.classList.contains('dark-mode') ? 'enabled' : 'disabled');
          });
        }
      });
      
      // Check for saved dark mode preference
      if (localStorage.getItem('darkMode') === 'enabled') {
        document.body.classList.add('dark-mode');
      }
      
      // Mobile menu toggle
      const mobileMenuBtn = document.getElementById('mobile-menu-btn');
      const mobileSidebar = document.getElementById('mobile-sidebar');
      const closeSidebar = document.getElementById('close-sidebar');
      const sidebarBackdrop = document.getElementById('sidebar-backdrop');
      
      if (mobileMenuBtn && mobileSidebar) {
        mobileMenuBtn.addEventListener('click', function() {
          mobileSidebar.classList.remove('-translate-x-full');
        });
      }
      
      if (closeSidebar && mobileSidebar) {
        closeSidebar.addEventListener('click', function() {
          mobileSidebar.classList.add('-translate-x-full');
        });
      }
      
      if (sidebarBackdrop && mobileSidebar) {
        sidebarBackdrop.addEventListener('click', function() {
          mobileSidebar.classList.add('-translate-x-full');
        });
      }
      
      // Tab switching
      const tabButtons = document.querySelectorAll('[data-tab]');
      const tabContents = document.querySelectorAll('section[id$="-tab"]');
      
      function activateTab(tabName) {
        // Hide all tab contents
        tabContents.forEach(content => {
          content.classList.add('hidden');
        });
        
        // Show the selected tab content
        const selectedTab = document.getElementById(tabName + '-tab');
        if (selectedTab) {
          selectedTab.classList.remove('hidden');
        }
        
        // Update active state of tab buttons
        tabButtons.forEach(btn => {
          if (btn.dataset.tab === tabName) {
            // Desktop sidebar
            if (btn.classList.contains('sidebar-nav-active') || btn.classList.contains('mobile-nav-item')) {
              document.querySelectorAll('.sidebar-nav-active, .mobile-nav-item').forEach(item => {
                item.classList.remove('bg-primary-50', 'dark:bg-primary-900/20', 'text-primary');
                item.classList.add('text-dark-700', 'dark:text-dark-300', 'hover:bg-dark-100', 'dark:hover:bg-dark-700/50');
              });
              
              btn.classList.remove('text-dark-700', 'dark:text-dark-300', 'hover:bg-dark-100', 'dark:hover:bg-dark-700/50');
              btn.classList.add('bg-primary-50', 'dark:bg-primary-900/20', 'text-primary');
            }
            // Mobile tabs
            else {
              document.querySelectorAll('button[data-tab].tab-active').forEach(item => {
                item.classList.remove('tab-active');
                item.classList.add('text-dark-500', 'dark:text-dark-400');
              });
              
              btn.classList.remove('text-dark-500', 'dark:text-dark-400');
              btn.classList.add('tab-active');
            }
          }
        });
        
        // Close mobile sidebar when selecting a tab
        if (mobileSidebar) {
          mobileSidebar.classList.add('-translate-x-full');
        }
      }
      
      tabButtons.forEach(button => {
        button.addEventListener('click', function() {
          activateTab(this.dataset.tab);
        });
      });
      
      // Agent Panel toggle
      const minimizeAgentBtn = document.getElementById('minimize-agent');
      const agentPanel = document.querySelector('.agent-panel');
      
      if (minimizeAgentBtn && agentPanel) {
        minimizeAgentBtn.addEventListener('click', function() {
          agentPanel.classList.toggle('minimized');
        });
      }
      
      // Mobile more menu toggle
      const moreMenuBtn = document.querySelector('[data-tab="more"]');
      const moreMenu = document.getElementById('mobile-more-menu');
      
      if (moreMenuBtn && moreMenu) {
        moreMenuBtn.addEventListener('click', function(e) {
          e.stopPropagation();
          moreMenu.classList.toggle('hidden');
        });
        
        document.addEventListener('click', function(e) {
          if (!moreMenu.contains(e.target) && !moreMenuBtn.contains(e.target)) {
            moreMenu.classList.add('hidden');
          }
        });
      }
    });
  </script>
</body>
</html>