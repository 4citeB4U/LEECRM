<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Agent Lee CRM System - The mobile-first, all-in-one outreach system for real-world artists and organizers">
  <title>ðŸ§  Agent Lee CRM System</title>
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
  <!-- TailwindCSS via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Poppins', 'sans-serif'],
            display: ['Space Grotesk', 'sans-serif'],
          },
          colors: {
            primary: {
              DEFAULT: '#6366f1',
              50: '#f5f5ff',
              100: '#ecedfe',
              200: '#d9d9fd',
              300: '#b5b7fc',
              400: '#8c8ff9',
              500: '#6366f1',
              600: '#514ae9',
              700: '#3730d6',
              800: '#3029af',
              900: '#2c2689',
            },
            secondary: {
              DEFAULT: '#14b8a6',
              50: '#f0fdfa',
              100: '#ccfbf1',
              200: '#99f6e4',
              300: '#5eead4',
              400: '#2dd4bf',
              500: '#14b8a6',
              600: '#0d9488',
              700: '#0f766e',
              800: '#115e59',
              900: '#134e4a',
            },
            dark: {
              DEFAULT: '#0f172a',
              50: '#f8fafc',
              100: '#f1f5f9',
              200: '#e2e8f0',
              300: '#cbd5e1',
              400: '#94a3b8',
              500: '#64748b',
              600: '#475569',
              700: '#334155',
              800: '#1e293b',
              900: '#0f172a',
            },
          },
          animation: {
            'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
          }
        }
      }
    }
  </script>
  <!-- Custom CSS -->
  <link rel="stylesheet" href="styles.css">
  <!-- Load config.js first to access environment variables -->
  <script src="config.js"></script>
  <!-- Music Store Data -->
  <script src="complete_music_store_list.js"></script>
  <script src="gh.js"></script>
  <!-- Store Data Initialization -->
  <script>
    // Combine all store data and ensure coordinates are handled
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize allStores array with musicStores
      window.allStores = window.musicStores ? [...window.musicStores] : [];

      // Process ghStores if available and add to allStores
      if (window.ghStores && Array.isArray(window.ghStores)) {
        // Set default coordinates for stores without lat/lng
        const defaultCoords = window.env && window.env.DEFAULT_LOCATION ? window.env.DEFAULT_LOCATION : { lat: 43.0389, lng: -87.9065 };

        // Process each ghStore
        window.ghStores.forEach(store => {
          // If coordinates are null, use estimated coordinates based on city/state
          if (store.lat === null || store.lng === null) {
            // Use approximated coordinates based on city and state
            // You could implement geocoding here, but for now we'll use random offsets from default
            const randomLat = defaultCoords.lat + (Math.random() * 0.3 - 0.15);
            const randomLng = defaultCoords.lng + (Math.random() * 0.3 - 0.15);

            store.lat = randomLat;
            store.lng = randomLng;
            store.estimatedCoordinates = true; // Mark as estimated
          }

          // Add to the combined store list
          window.allStores.push(store);
        });
      }

      console.log(`Combined ${window.allStores.length} stores from all sources`);
    });
  </script>
  <!-- Recorder.js via CDN -->
  <script src="https://cdn.jsdelivr.net/npm/recordrtc@5.6.2/RecordRTC.min.js"></script>
  <!-- IndexedDB library -->
  <script src="https://cdn.jsdelivr.net/npm/idb-keyval@6/dist/umd.js"></script>
  <!-- Chart.js for analytics -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
  <!-- Google Maps API for visit tracking -->
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBNLrJhOMz6idD05pzwk17mcLxJxO_Rq0w&libraries=places"></script>
  <style>
    /* Base styles with smooth transitions */
    body {
      background-color: #f8fafc;
      transition: background-color 0.3s ease;
    }

    body.dark-mode {
      background-color: #0f172a;
      color: #f1f5f9;
    }

    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(203, 213, 225, 0.2);
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb {
      background: rgba(99, 102, 241, 0.5);
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: rgba(99, 102, 241, 0.8);
    }

    /* Animation for pulse effect */
    @keyframes pulse-ring {
      0% {
        transform: scale(0.8);
        opacity: 0.8;
      }
      50% {
        transform: scale(1);
        opacity: 0.4;
      }
      100% {
        transform: scale(0.8);
        opacity: 0.8;
      }
    }

    /* Recording wave animation */
    .recording-wave {
      position: relative;
    }
    .recording-wave::before,
    .recording-wave::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.8);
      z-index: -1;
    }
    .recording-wave::before {
      animation: wave 1.5s infinite ease-out;
    }
    .recording-wave::after {
      animation: wave 1.5s infinite ease-out 0.5s;
    }
    @keyframes wave {
      0% {
        transform: scale(1);
        opacity: 0.8;
      }
      100% {
        transform: scale(3);
        opacity: 0;
      }
    }

    /* Glass morphism effects */
    .glass {
      background: rgba(255, 255, 255, 0.25);
      -webkit-backdrop-filter: blur(10px);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.18);
    }

    .glass-dark {
      background: rgba(15, 23, 42, 0.75);
      -webkit-backdrop-filter: blur(10px);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(30, 41, 59, 0.5);
    }

    /* 3D card hover effect */
    .card-3d {
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .card-3d:hover {
      transform: translateY(-5px) scale(1.01);
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }

    /* Loading animation */
    .loading-animation {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      background: linear-gradient(135deg, #6366f1, #14b8a6);
      z-index: 9999;
      transition: opacity 0.5s ease-out, visibility 0.5s ease-out;
    }

    .loader {
      width: 80px;
      height: 80px;
      position: relative;
    }

    .loader:before, .loader:after {
      content: '';
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: white;
      opacity: 0.6;
      animation: pulse-ring 2s linear infinite;
    }

    .loader:after {
      animation-delay: 1s;
    }

    .loader-logo {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 2rem;
      color: white;
      z-index: 1;
    }

    .loading-hide {
      opacity: 0;
      visibility: hidden;
    }

    /* Map styling */
    #map {
      height: 100%;
      min-height: 500px;
      width: 100%;
      border-radius: 1rem;
      overflow: hidden;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    }

    /* Gradient animations for buttons and elements */
    .gradient-btn {
      background-size: 200% 200%;
      background-image: linear-gradient(45deg, #6366f1, #14b8a6, #6366f1);
      animation: gradientShift 3s ease infinite;
    }

    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* Gradient text */
    .gradient-text {
      background-image: linear-gradient(45deg, #6366f1, #14b8a6);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }

    /* Analytics chart styling */
    .chart-container {
      height: 200px;
      position: relative;
    }

    /* Grid for dashboard layout */
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.5rem;
    }
  </style>
  <!-- Google Maps API with key from config.js -->
  <script>
    // Load Google Maps API key from config.js
    function loadGoogleMapsAPI() {
      // Use the API key from config.js or directly from config.google.apiKey
      let googleMapsAPIKey = null;

      if (window.env && window.env.GOOGLE_MAPS_API_KEY) {
        googleMapsAPIKey = window.env.GOOGLE_MAPS_API_KEY;
      } else if (window.config && window.config.google && window.config.google.apiKey) {
        googleMapsAPIKey = window.config.google.apiKey;
      } else {
        // Hardcoded fallback key - using the key from config.js that has billing enabled
        googleMapsAPIKey = "AIzaSyAgMwqNZinl-6rezvp62jj8eFZrJ0n3SBQ";
      }

      if (!googleMapsAPIKey) {
        console.error("Missing Google Maps API key in config.js");
        alert("Google Maps API key is missing. Please check your config.js file.");

        // Create a fallback map display
        createFallbackMapDisplay();
        return;
      }

      console.log("Loading Google Maps with API key from config.js");

      // Check if the script is already loaded
      if (document.querySelector('script[src*="maps.googleapis.com/maps/api/js"]')) {
        console.log("Google Maps API script already exists, not adding again");
        // If the API is already loaded but map isn't initialized, try to initialize it
        if (typeof google !== 'undefined' && google.maps) {
          console.log("Google Maps API already loaded, initializing map directly");
          initializeMap();
        } else {
          // If Google object exists but maps is not defined, there might be an error
          console.error("Google object exists but maps API is not properly loaded");
          createFallbackMapDisplay();
        }
        return;
      }

      // Create script element for Google Maps API
      const script = document.createElement('script');
      script.src = `https://maps.googleapis.com/maps/api/js?key=${googleMapsAPIKey}&libraries=places&callback=initMap&loading=async`;
      script.async = true;
      script.defer = true;
      script.onerror = function() {
        console.error("Failed to load Google Maps API. Check your API key.");
        alert("Google Maps failed to load. Please check your internet connection and API key.");
        createFallbackMapDisplay();
      };

      // Add a timeout to detect if the API takes too long to load
      const timeoutId = setTimeout(function() {
        if (typeof google === 'undefined' || !google.maps) {
          console.error("Google Maps API load timeout");
          createFallbackMapDisplay();
        }
      }, 10000); // 10 second timeout

      // Add script to document
      document.head.appendChild(script);

      console.log("Google Maps API script added to document head");
    }

    // Create a fallback display when Google Maps fails to load
    function createFallbackMapDisplay() {
      const mapContainer = document.getElementById('map');
      if (!mapContainer) return;

      mapContainer.innerHTML = `
        <div class="flex flex-col items-center justify-center h-full bg-dark-100/30 p-4 text-center rounded-xl">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-dark-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7" />
          </svg>
          <h2 class="text-xl font-bold text-dark-700 mb-2">Map Unavailable</h2>
          <p class="text-dark-600 mb-4">Google Maps could not be loaded at this time.</p>
          <p class="text-dark-500 text-sm mb-4">This may be due to network connectivity issues or API key configuration.</p>
          <button id="retry-map-load" class="gradient-btn px-4 py-2 text-white rounded-full hover:shadow-lg transition duration-300 ease-in-out shadow-md">
            Retry Loading Map
          </button>
        </div>
      `;

      // Add event listener to retry button
      document.getElementById('retry-map-load').addEventListener('click', function() {
        mapContainer.innerHTML = '<div class="w-full h-full flex items-center justify-center"><div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"></div></div>';
        setTimeout(loadGoogleMapsAPI, 500);
      });

      // Also populate the nearby list with a message
      const nearbyList = document.getElementById('nearby-list');
      if (nearbyList) {
        nearbyList.innerHTML = `
          <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded-lg shadow">
            <div class="flex">
              <div class="flex-shrink-0">
                <svg class="h-5 w-5 text-yellow-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                </svg>
              </div>
              <div class="ml-3">
                <p class="text-sm text-yellow-700">
                  Map functionality is currently unavailable. Nearby leads cannot be displayed.
                </p>
              </div>
            </div>
          </div>
        `;
      }
    }

    // Define initMap function in global scope so Google Maps API can find it
    window.initMap = function() {
      console.log("Google Maps API callback received");
      if (typeof initializeMap === 'function') {
        initializeMap(); // Call our single map initialization function
      } else {
        console.error("initializeMap function not found");
        // Try to define a fallback initialization function
        window.initializeMap = function() {
          console.log("Using fallback map initialization");
          const mapContainer = document.getElementById('map');
          if (!mapContainer) {
            console.error("Map container not found");
            return;
          }

          // Make sure the map container has proper dimensions
          mapContainer.style.height = '500px';
          mapContainer.style.width = '100%';

          // Get default location from config or fallback to Milwaukee
          const defaultLocation = window.env && window.env.DEFAULT_LOCATION
            ? window.env.DEFAULT_LOCATION
            : { lat: 43.0389, lng: -87.9065 };

          // Create the map centered on default location
          window.googleMap = new google.maps.Map(document.getElementById('map'), {
            center: defaultLocation,
            zoom: 10,
            mapTypeControl: true,
            streetViewControl: true,
            fullscreenControl: true,
            styles: [
              {
                "featureType": "administrative.land_parcel",
                "elementType": "labels",
                "stylers": [{"visibility": "off"}]
              },
              {
                "featureType": "poi",
                "elementType": "labels.text",
                "stylers": [{"visibility": "off"}]
              },
              {
                "featureType": "poi.business",
                "stylers": [{"visibility": "off"}]
              },
              {
                "featureType": "road",
                "elementType": "labels.icon",
                "stylers": [{"visibility": "off"}]
              },
              {
                "featureType": "road.local",
                "elementType": "labels",
                "stylers": [{"visibility": "off"}]
              },
              {
                "featureType": "transit",
                "stylers": [{"visibility": "off"}]
              }
            ]
          });

          // Assign to global map variable for compatibility
          window.map = window.googleMap;

          // Add markers for all stores
          addAllStoreMarkers();

          console.log("Google Maps initialized successfully with fallback");
        };

        // Call the fallback initialization
        window.initializeMap();
      }
    };

    // Call the function to load the API when document is ready
    document.addEventListener('DOMContentLoaded', function() {
      console.log("DOM Content Loaded - Loading Google Maps API");
      // Wait a bit longer to ensure config.js is fully loaded
      setTimeout(loadGoogleMapsAPI, 300);
    });
  </script>
</head>
<body class="font-sans text-dark-900">
  <!-- Loading Animation -->
  <div class="loading-animation">
    <div class="loader">
      <span class="loader-logo">ðŸ§ </span>
    </div>
  </div>

  <div class="min-h-screen flex flex-col relative overflow-hidden">
    <!-- Background Gradient Elements -->
    <div class="absolute top-0 left-0 w-full h-full overflow-hidden z-0 pointer-events-none">
      <div class="absolute top-0 left-0 w-72 h-72 -ml-20 -mt-20 bg-primary-300/20 rounded-full filter blur-3xl animate-pulse-slow"></div>
      <div class="absolute bottom-0 right-0 w-96 h-96 -mr-20 -mb-20 bg-secondary-300/20 rounded-full filter blur-3xl animate-pulse-slow"></div>
      <div class="absolute top-1/3 right-1/4 w-64 h-64 bg-purple-300/10 rounded-full filter blur-3xl animate-pulse-slow"></div>
    </div>

    <!-- Sidebar - Fixed on larger screens -->
    <div class="hidden md:flex fixed top-0 left-0 h-full w-64 bg-white/90 dark:bg-dark-800/90 backdrop-blur-lg z-40 flex-col shadow-lg transition-all duration-300 ease-in-out">
      <div class="p-6 flex items-center space-x-3 border-b border-dark-200/50 dark:border-dark-700/50">
        <div class="w-10 h-10 rounded-full bg-gradient-to-r from-primary to-secondary flex items-center justify-center text-white text-xl shadow-md">
          ðŸ§ 
        </div>
        <div>
          <h1 class="font-display font-bold text-lg text-dark-900 dark:text-white">Agent Lee</h1>
          <p class="text-xs text-dark-500 dark:text-dark-400">Intelligent CRM System</p>
        </div>
      </div>

      <!-- Sidebar Navigation -->
      <nav class="flex-1 py-6 px-4 overflow-y-auto">
        <ul class="space-y-2">
          <li>
            <a href="#dashboard-tab" data-tab="dashboard" class="sidebar-nav-active flex items-center space-x-3 p-3 rounded-xl text-primary font-medium bg-primary-50 dark:bg-primary-900/20">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z" />
              </svg>
              <span>Dashboard</span>
            </a>
          </li>
          <li>
            <a href="#map-tab" data-tab="map" class="flex items-center space-x-3 p-3 rounded-xl text-dark-700 dark:text-dark-300 hover:bg-dark-100 dark:hover:bg-dark-700/50 transition-all duration-200">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7" />
              </svg>
              <span>Map View</span>
            </a>
          </li>
          <li>
            <a href="#records-tab" data-tab="records" class="flex items-center space-x-3 p-3 rounded-xl text-dark-700 dark:text-dark-300 hover:bg-dark-100 dark:hover:bg-dark-700/50 transition-all duration-200">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" />
              </svg>
              <span>Records</span>
            </a>
          </li>
          <li>
            <a href="#phone-tab" data-tab="phone" class="flex items-center space-x-3 p-3 rounded-xl text-dark-700 dark:text-dark-300 hover:bg-dark-100 dark:hover:bg-dark-700/50 transition-all duration-200">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
              </svg>
              <span>Phone</span>
            </a>
          </li>
          <li>
            <a href="#campaigns-tab" data-tab="campaigns" class="flex items-center space-x-3 p-3 rounded-xl text-dark-700 dark:text-dark-300 hover:bg-dark-100 dark:hover:bg-dark-700/50 transition-all duration-200">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
              </svg>
              <span>Campaigns</span>
            </a>
          </li>
          <li>
            <a href="#analytics-tab" data-tab="analytics" class="flex items-center space-x-3 p-3 rounded-xl text-dark-700 dark:text-dark-300 hover:bg-dark-100 dark:hover:bg-dark-700/50 transition-all duration-200">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
              </svg>
              <span>Analytics</span>
            </a>
          </li>
          <li>
            <a href="#visits-tab" data-tab="visits" class="flex items-center space-x-3 p-3 rounded-xl text-dark-700 dark:text-dark-300 hover:bg-dark-100 dark:hover:bg-dark-700/50 transition-all duration-200">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
              </svg>
              <span>Visits</span>
            </a>
          </li>
          <li>
            <a href="#todos-tab" data-tab="todos" class="flex items-center space-x-3 p-3 rounded-xl text-dark-700 dark:text-dark-300 hover:bg-dark-100 dark:hover:bg-dark-700/50 transition-all duration-200">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" />
              </svg>
              <span>To-Dos</span>
            </a>
          </li>
          <li>
            <a href="#timeline-tab" data-tab="timeline" class="flex items-center space-x-3 p-3 rounded-xl text-dark-700 dark:text-dark-300 hover:bg-dark-100 dark:hover:bg-dark-700/50 transition-all duration-200">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              <span>Timeline</span>
            </a>
          </li>
          <li class="border-t border-dark-200/30 dark:border-dark-700/30 mt-4 pt-4">
            <a href="#business-card-tab" data-tab="business-card" class="flex items-center space-x-3 p-3 rounded-xl text-dark-700 dark:text-dark-300 hover:bg-dark-100 dark:hover:bg-dark-700/50 transition-all duration-200">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V8a2 2 0 00-2-2h-5m-4 0V5a2 2 0 114 0v1m-4 0a2 2 0 104 0m-5.75 3l-3 3m0 0l3 3m-3-3h20.5" />
              </svg>
              <span>Business Card</span>
            </a>
          </li>
          <li>
            <a href="#email-signature-tab" data-tab="email-signature" class="flex items-center space-x-3 p-3 rounded-xl text-dark-700 dark:text-dark-300 hover:bg-dark-100 dark:hover:bg-dark-700/50 transition-all duration-200">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
              </svg>
              <span>Email Signature</span>
            </a>
          </li>
          <li>
            <a href="#file-browser-tab" data-tab="file-browser" class="flex items-center space-x-3 p-3 rounded-xl text-dark-700 dark:text-dark-300 hover:bg-dark-100 dark:hover:bg-dark-700/50 transition-all duration-200">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
              </svg>
              <span>File Browser</span>
            </a>
          </li>
        </ul>
      </nav>

      <!-- User Profile -->
      <div class="p-4 border-t border-dark-200/30 dark:border-dark-700/30">
        <div class="flex items-center space-x-3">
          <div class="relative">
            <div class="w-10 h-10 rounded-full bg-dark-200 dark:bg-dark-700 overflow-hidden shadow">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-full w-full text-dark-400 dark:text-dark-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
              </svg>
            </div>
            <div class="absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-green-400 rounded-full border-2 border-white dark:border-dark-800"></div>
          </div>
          <div class="flex-1 min-w-0">
            <p class="text-sm font-medium text-dark-900 dark:text-white truncate">Leonard Lee</p>
            <p class="text-xs text-dark-500 dark:text-dark-400 truncate">Agent</p>
          </div>
          <button id="theme-toggle" class="p-2 rounded-lg text-dark-500 hover:bg-dark-100 dark:hover:bg-dark-700/50 dark:text-dark-400">
            <!-- Sun icon for dark mode -->
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 hidden dark:block" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
            </svg>
            <!-- Moon icon for light mode -->
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 block dark:hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
            </svg>
          </button>
        </div>
      </div>
    </div>

    <!-- Mobile Header -->
    <header class="md:hidden bg-white/90 dark:bg-dark-900/90 backdrop-blur-lg shadow-sm z-40 sticky top-0">
      <div class="flex items-center justify-between p-4">
        <button id="mobile-menu-btn" class="p-2 rounded-lg text-dark-700 dark:text-dark-300 hover:bg-dark-100 dark:hover:bg-dark-700">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>
        <div class="flex items-center">
          <div class="w-8 h-8 rounded-full bg-gradient-to-r from-primary to-secondary flex items-center justify-center text-white shadow-sm mr-2">
            ðŸ§ 
          </div>
          <span class="text-lg font-display font-bold text-dark-900 dark:text-white">Agent Lee CRM</span>
        </div>
        <button id="mobile-user-btn" class="relative p-2 rounded-lg text-dark-700 dark:text-dark-300 hover:bg-dark-100 dark:hover:bg-dark-700">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
          </svg>
          <div class="absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-green-400 rounded-full border-2 border-white dark:border-dark-900"></div>
        </button>
      </div>

      <!-- Voice command bar for mobile -->
      <div class="bg-gradient-to-r from-primary-400 to-primary-600 p-3 shadow-md flex items-center justify-between">
        <div class="flex items-center">
          <button type="button" id="global-record-btn" class="p-3 rounded-full bg-white text-primary-600 hover:bg-dark-50 flex items-center shadow-md transition-all duration-200 mr-3" aria-label="Start recording">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />
            </svg>
          </button>
          <button type="button" id="global-stop-record" class="hidden p-3 rounded-full bg-white text-red-600 hover:bg-dark-50 flex items-center shadow-md transition-all duration-200 mr-3" aria-label="Stop recording">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 10a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1v-4z" />
            </svg>
          </button>
          <div id="recording-wave" class="hidden w-4 h-4 bg-white rounded-full recording-wave mr-2"></div>
          <span class="text-sm font-medium text-white">Voice Command</span>
        </div>
        <div id="dictation-status" class="text-sm text-white flex-grow mx-4 hidden">
          <span class="font-medium">Listening:</span> <span id="dictation-result">Speak now...</span>
        </div>
        <div id="dictation-controls" class="hidden flex items-center space-x-2">
          <button type="button" id="dictation-cancel" class="text-xs px-3 py-1 bg-white/20 hover:bg-white/30 rounded-md text-white font-medium">
            Cancel
          </button>
          <button type="button" id="dictation-process" class="text-xs px-3 py-1 bg-white text-primary-600 rounded-md hover:bg-white/90 font-medium">
            Process
          </button>
        </div>
        <div id="dictation-hint" class="text-xs text-white/80">Press to start</div>
      </div>

      <!-- Mobile Navigation Tabs -->
      <div class="flex overflow-x-auto hide-scrollbar border-b border-dark-200/30 dark:border-dark-700/50 bg-white/90 dark:bg-dark-900/90 backdrop-blur-lg text-sm">
        <button type="button" data-tab="dashboard" class="tab-active flex-shrink-0 px-4 py-3 font-medium focus:outline-none">
          Dashboard
        </button>
        <button type="button" data-tab="map" class="flex-shrink-0 px-4 py-3 text-dark-500 dark:text-dark-400 font-medium focus:outline-none">
          Map View
        </button>
        <button type="button" data-tab="records" class="flex-shrink-0 px-4 py-3 text-dark-500 dark:text-dark-400 font-medium focus:outline-none">
          Records
        </button>
        <button type="button" data-tab="phone" class="flex-shrink-0 px-4 py-3 text-dark-500 dark:text-dark-400 font-medium focus:outline-none">
          Phone
        </button>
        <button type="button" data-tab="campaigns" class="flex-shrink-0 px-4 py-3 text-dark-500 dark:text-dark-400 font-medium focus:outline-none">
          Campaigns
        </button>
        <button type="button" data-tab="analytics" class="flex-shrink-0 px-4 py-3 text-dark-500 dark:text-dark-400 font-medium focus:outline-none">
          Analytics
        </button>
        <button type="button" data-tab="more" class="flex-shrink-0 px-4 py-3 text-dark-500 dark:text-dark-400 font-medium focus:outline-none flex items-center">
          More
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
          </svg>
        </button>
      </div>

      <!-- Mobile Navigation More Menu (hidden by default) -->
      <div id="mobile-more-menu" class="hidden absolute z-50 bg-white dark:bg-dark-800 shadow-lg rounded-b-lg w-48 right-4 mt-1 py-2 text-sm">
        <a href="#visits-tab" data-tab="visits" class="block px-4 py-2 text-dark-700 dark:text-dark-300 hover:bg-dark-100 dark:hover:bg-dark-700">Visits</a>
        <a href="#todos-tab" data-tab="todos" class="block px-4 py-2 text-dark-700 dark:text-dark-300 hover:bg-dark-100 dark:hover:bg-dark-700">To-Dos</a>
        <a href="#timeline-tab" data-tab="timeline" class="block px-4 py-2 text-dark-700 dark:text-dark-300 hover:bg-dark-100 dark:hover:bg-dark-700">Timeline</a>
        <div class="border-t border-dark-200 dark:border-dark-700 my-1"></div>
        <a href="#business-card-tab" data-tab="business-card" class="block px-4 py-2 text-dark-700 dark:text-dark-300 hover:bg-dark-100 dark:hover:bg-dark-700">Business Card</a>
        <a href="#email-signature-tab" data-tab="email-signature" class="block px-4 py-2 text-dark-700 dark:text-dark-300 hover:bg-dark-100 dark:hover:bg-dark-700">Email Signature</a>
        <a href="#file-browser-tab" data-tab="file-browser" class="block px-4 py-2 text-dark-700 dark:text-dark-300 hover:bg-dark-100 dark:hover:bg-dark-700">File Browser</a>
      </div>
    </header>

    <!-- Mobile Sidebar (offscreen by default) -->
    <div id="mobile-sidebar" class="fixed inset-0 z-50 lg:hidden transform -translate-x-full transition-transform duration-300 ease-in-out">
      <!-- Backdrop -->
      <div class="absolute inset-0 bg-dark-900/50 backdrop-blur-sm" id="sidebar-backdrop"></div>

      <!-- Sidebar Content -->
      <div class="absolute top-0 left-0 w-72 h-full bg-white dark:bg-dark-800 shadow-xl flex flex-col">
        <div class="p-6 flex items-center justify-between border-b border-dark-200/50 dark:border-dark-700/50">
          <div class="flex items-center space-x-3">
            <div class="w-10 h-10 rounded-full bg-gradient-to-r from-primary to-secondary flex items-center justify-center text-white text-xl shadow-md">
              ðŸ§ 
            </div>
            <h2 class="font-display font-bold text-lg text-dark-900 dark:text-white">Agent Lee</h2>
          </div>
          <button id="close-sidebar" class="p-1 rounded-md text-dark-500 hover:bg-dark-100 dark:hover:bg-dark-700">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>

        <!-- Mobile Sidebar Navigation (same as desktop) -->
        <nav class="flex-1 py-6 px-4 overflow-y-auto">
          <ul class="space-y-2">
            <li>
              <a href="#dashboard-tab" data-tab="dashboard" class="mobile-nav-item flex items-center space-x-3 p-3 rounded-xl text-primary font-medium bg-primary-50 dark:bg-primary-900/20">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z" />
                </svg>
                <span>Dashboard</span>
              </a>
            </li>
            <li>
              <a href="#map-tab" data-tab="map" class="mobile-nav-item flex items-center space-x-3 p-3 rounded-xl text-dark-700 dark:text-dark-300 hover:bg-dark-100 dark:hover:bg-dark-700/50 transition-all duration-200">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7" />
                </svg>
                <span>Map View</span>
              </a>
            </li>
            <li>
              <a href="#records-tab" data-tab="records" class="mobile-nav-item flex items-center space-x-3 p-3 rounded-xl text-dark-700 dark:text-dark-300 hover:bg-dark-100 dark:hover:bg-dark-700/50 transition-all duration-200">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" />
                </svg>
                <span>Records</span>
              </a>
            </li>
            <!-- Additional nav items (same structure as desktop sidebar) -->
          </ul>
        </nav>

        <!-- User Profile for Mobile -->
        <div class="p-4 border-t border-dark-200/30 dark:border-dark-700/30">
          <div class="flex items-center space-x-3">
            <div class="relative">
              <div class="w-10 h-10 rounded-full bg-dark-200 dark:bg-dark-700 overflow-hidden shadow">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-full w-full text-dark-400 dark:text-dark-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                </svg>
              </div>
              <div class="absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-green-400 rounded-full border-2 border-white dark:border-dark-800"></div>
            </div>
            <div class="flex-1 min-w-0">
              <p class="text-sm font-medium text-dark-900 dark:text-white truncate">Leonard Lee</p>
              <p class="text-xs text-dark-500 dark:text-dark-400 truncate">Agent</p>
            </div>
            <button id="mobile-theme-toggle" class="p-2 rounded-lg text-dark-500 hover:bg-dark-100 dark:hover:bg-dark-700/50 dark:text-dark-400">
              <!-- Sun icon for dark mode -->
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 hidden dark:block" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
              </svg>
              <!-- Moon icon for light mode -->
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 block dark:hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <main class="flex-grow md:ml-64 relative z-10 mt-0 md:mt-6">
      <div class="container mx-auto px-4 pb-16 max-w-screen-2xl">
        <!-- Dashboard Tab Content -->
        <section id="dashboard-tab" class="space-y-6">
          <!-- Welcome Banner -->
          <div class="relative overflow-hidden bg-gradient-to-r from-primary-500 to-secondary-500 rounded-2xl shadow-lg p-6 text-white mb-8">
            <div class="absolute top-0 right-0 w-64 h-64 -mt-20 -mr-20 bg-white/10 rounded-full filter blur-3xl"></div>
            <div class="relative z-10 flex flex-col md:flex-row items-center justify-between gap-4">
              <div>
                <h1 class="text-2xl md:text-3xl font-display font-bold mb-2">Agent Lee CRM Dashboard</h1>
                <p class="text-white/80 max-w-lg">Your all-in-one view of activities, leads, and performance metrics.</p>
              </div>
              <div class="flex gap-3 flex-wrap justify-end">
                <button type="button" class="px-4 py-2 bg-white/20 hover:bg-white/30 rounded-xl transition-all duration-200 backdrop-blur-sm flex items-center space-x-2 text-sm font-medium">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                  </svg>
                  <span>New Task</span>
                </button>
                <button type="button" class="px-4 py-2 bg-white text-primary-600 hover:bg-white/90 rounded-xl transition-all duration-200 shadow-sm flex items-center space-x-2 text-sm font-medium">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                  </svg>
                  <span>New Campaign</span>
                </button>
              </div>
            </div>
          </div>

          <!-- Key Metrics -->
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="bg-white dark:bg-dark-800 rounded-2xl shadow-md p-6 card-3d border border-dark-100/50 dark:border-dark-700/50">
              <div class="flex items-start justify-between">
                <div>
                  <p class="text-dark-500 dark:text-dark-400 text-sm">Total Leads</p>
                  <h3 class="text-3xl font-display font-bold mt-2 text-dark-900 dark:text-white" id="dashboard-total-leads">247</h3>
                </div>
                <div class="w-12 h-12 rounded-xl bg-primary-100 dark:bg-primary-900/30 flex items-center justify-center text-primary-500">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                  </svg>
                </div>
              </div>
              <div class="mt-4 flex items-center">
                <span class="text-green-500 flex items-center text-sm font-medium">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
                  </svg>
                  42% growth
                </span>
                <span class="text-dark-400 dark:text-dark-500 text-xs ml-2">vs last month</span>
              </div>
            </div>

            <div class="bg-white dark:bg-dark-800 rounded-2xl shadow-md p-6 card-3d border border-dark-100/50 dark:border-dark-700/50">
              <div class="flex items-start justify-between">
                <div>
                  <p class="text-dark-500 dark:text-dark-400 text-sm">Open Rate</p>
                  <h3 class="text-3xl font-display font-bold mt-2 text-dark-900 dark:text-white" id="dashboard-open-rate">68.5%</h3>
                </div>
                <div class="w-12 h-12 rounded-xl bg-secondary-100 dark:bg-secondary-900/30 flex items-center justify-center text-secondary-500">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 19v-8.93a2 2 0 01.89-1.664l7-4.666a2 2 0 012.22 0l7 4.666A2 2 0 0121 10.07V19M3 19a2 2 0 002 2h14a2 2 0 002-2M3 19l6.75-4.5M21 19l-6.75-4.5M3 10l6.75 4.5M21 10l-6.75 4.5m0 0l-1.14.76a2 2 0 01-2.22 0l-1.14-.76" />
                  </svg>
                </div>
              </div>
              <div class="mt-4 flex items-center">
                <span class="text-green-500 flex items-center text-sm font-medium">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
                  </svg>
                  3.2%
                </span>
                <span class="text-dark-400 dark:text-dark-500 text-xs ml-2">vs last month</span>
              </div>
            </div>

            <div class="bg-white dark:bg-dark-800 rounded-2xl shadow-md p-6 card-3d border border-dark-100/50 dark:border-dark-700/50">
              <div class="flex items-start justify-between">
                <div>
                  <p class="text-dark-500 dark:text-dark-400 text-sm">Response Rate</p>
                  <h3 class="text-3xl font-display font-bold mt-2 text-dark-900 dark:text-white" id="dashboard-response-rate">12.3%</h3>
                </div>
                <div class="w-12 h-12 rounded-xl bg-purple-100 dark:bg-purple-900/30 flex items-center justify-center text-purple-500">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
                  </svg>
                </div>
              </div>
              <div class="mt-4 flex items-center">
                <span class="text-green-500 flex items-center text-sm font-medium">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
                  </svg>
                  1.5%
                </span>
                <span class="text-dark-400 dark:text-dark-500 text-xs ml-2">vs last month</span>
              </div>
            </div>

            <div class="bg-white dark:bg-dark-800 rounded-2xl shadow-md p-6 card-3d border border-dark-100/50 dark:border-dark-700/50">
              <div class="flex items-start justify-between">
                <div>
                  <p class="text-dark-500 dark:text-dark-400 text-sm">Next Follow-ups</p>
                  <h3 class="text-3xl font-display font-bold mt-2 text-dark-900 dark:text-white">27</h3>
                </div>
                <div class="w-12 h-12 rounded-xl bg-amber-100 dark:bg-amber-900/30 flex items-center justify-center text-amber-500">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                </div>
              </div>
              <div class="mt-4 flex items-center">
                <span class="text-amber-500 flex items-center text-sm font-medium">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                  </svg>
                  5 due today
                </span>
                <span class="text-dark-400 dark:text-dark-500 text-xs ml-2">+2 overdue</span>
              </div>
            </div>
          </div>

          <!-- Dashboard Content Grid -->
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Recent Visits -->
            <div class="bg-white dark:bg-dark-800 rounded-2xl shadow-md p-6 border border-dark-100/50 dark:border-dark-700/50">
              <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-display font-bold text-dark-900 dark:text-white flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                  </svg>
                  Recent Visits
                </h3>
                <a href="#visits-tab" data-tab="visits" class="text-xs text-primary hover:underline">View All</a>
              </div>
              <div id="dashboard-recent-visits" class="space-y-3 max-h-64 overflow-y-auto">
                <!-- Will be populated dynamically -->
                <div class="animate-pulse">
                  <div class="h-4 bg-dark-200 dark:bg-dark-700 rounded w-3/4 mb-2"></div>
                  <div class="h-3 bg-dark-200 dark:bg-dark-700 rounded w-1/2 mb-4"></div>
                  <div class="h-4 bg-dark-200 dark:bg-dark-700 rounded w-3/4 mb-2"></div>
                  <div class="h-3 bg-dark-200 dark:bg-dark-700 rounded w-1/2 mb-4"></div>
                  <div class="h-4 bg-dark-200 dark:bg-dark-700 rounded w-3/4 mb-2"></div>
                  <div class="h-3 bg-dark-200 dark:bg-dark-700 rounded w-1/2"></div>
                </div>
              </div>
            </div>

            <!-- Pending To-Dos -->
            <div class="bg-white dark:bg-dark-800 rounded-2xl shadow-md p-6 border border-dark-100/50 dark:border-dark-700/50">
              <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-display font-bold text-dark-900 dark:text-white flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-secondary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" />
                  </svg>
                  Pending To-Dos
                </h3>
                <a href="#todos-tab" data-tab="todos" class="text-xs text-secondary hover:underline">View All</a>
              </div>
              <div id="dashboard-pending-todos" class="space-y-3 max-h-64 overflow-y-auto">
                <!-- Will be populated dynamically -->
                <div class="animate-pulse">
                  <div class="h-4 bg-dark-200 dark:bg-dark-700 rounded w-3/4 mb-2"></div>
                  <div class="h-3 bg-dark-200 dark:bg-dark-700 rounded w-1/2 mb-4"></div>
                  <div class="h-4 bg-dark-200 dark:bg-dark-700 rounded w-3/4 mb-2"></div>
                  <div class="h-3 bg-dark-200 dark:bg-dark-700 rounded w-1/2 mb-4"></div>
                  <div class="h-4 bg-dark-200 dark:bg-dark-700 rounded w-3/4 mb-2"></div>
                  <div class="h-3 bg-dark-200 dark:bg-dark-700 rounded w-1/2"></div>
                </div>
              </div>
            </div>

            <!-- Upcoming Campaigns -->
            <div class="bg-white dark:bg-dark-800 rounded-2xl shadow-md p-6 border border-dark-100/50 dark:border-dark-700/50">
              <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-display font-bold text-dark-900 dark:text-white flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-purple-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                  </svg>
                  Upcoming Campaigns
                </h3>
                <a href="#campaigns-tab" data-tab="campaigns" class="text-xs text-purple-500 hover:underline">View All</a>
              </div>
              <div id="dashboard-upcoming-campaigns" class="space-y-3 max-h-64 overflow-y-auto">
                <!-- Will be populated dynamically -->
                <div class="animate-pulse">
                  <div class="h-4 bg-dark-200 dark:bg-dark-700 rounded w-3/4 mb-2"></div>
                  <div class="h-3 bg-dark-200 dark:bg-dark-700 rounded w-1/2 mb-4"></div>
                  <div class="h-4 bg-dark-200 dark:bg-dark-700 rounded w-3/4 mb-2"></div>
                  <div class="h-3 bg-dark-200 dark:bg-dark-700 rounded w-1/2 mb-4"></div>
                  <div class="h-4 bg-dark-200 dark:bg-dark-700 rounded w-3/4 mb-2"></div>
                  <div class="h-3 bg-dark-200 dark:bg-dark-700 rounded w-1/2"></div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Map Tab Content -->
        <section id="map-tab" class="hidden space-y-6">
          <!-- Welcome Banner -->
          <div class="relative overflow-hidden bg-gradient-to-r from-primary-500 to-secondary-500 rounded-2xl shadow-lg p-6 text-white mb-8">
            <div class="absolute top-0 right-0 w-64 h-64 -mt-20 -mr-20 bg-white/10 rounded-full filter blur-3xl"></div>
            <div class="relative z-10 flex flex-col md:flex-row items-center justify-between gap-4">
              <div>
                <h1 class="text-2xl md:text-3xl font-display font-bold mb-2">Welcome back, Leonard</h1>
                <p class="text-white/80 max-w-lg">Your CRM is ready to help you connect with artists and music stores. Here's your current activity overview.</p>
              </div>
              <div class="flex gap-3 flex-wrap justify-end">
                <button type="button" class="px-4 py-2 bg-white/20 hover:bg-white/30 rounded-xl transition-all duration-200 backdrop-blur-sm flex items-center space-x-2 text-sm font-medium">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                  </svg>
                  <span>New Lead</span>
                </button>
                <button type="button" class="px-4 py-2 bg-white text-primary-600 hover:bg-white/90 rounded-xl transition-all duration-200 shadow-sm flex items-center space-x-2 text-sm font-medium">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                  </svg>
                  <span>New Campaign</span>
                </button>
              </div>
            </div>
          </div>

          <!-- Key Metrics -->
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="bg-white dark:bg-dark-800 rounded-2xl shadow-md p-6 card-3d border border-dark-100/50 dark:border-dark-700/50">
              <div class="flex items-start justify-between">
                <div>
                  <p class="text-dark-500 dark:text-dark-400 text-sm">Total Leads</p>
                  <h3 class="text-3xl font-display font-bold mt-2 text-dark-900 dark:text-white">247</h3>
                </div>
                <div class="w-12 h-12 rounded-xl bg-primary-100 dark:bg-primary-900/30 flex items-center justify-center text-primary-500">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                  </svg>
                </div>
              </div>
              <div class="mt-4 flex items-center">
                <span class="text-green-500 flex items-center text-sm font-medium">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
                  </svg>
                  42% growth
                </span>
                <span class="text-dark-400 dark:text-dark-500 text-xs ml-2">vs last month</span>
              </div>
            </div>

            <div class="bg-white dark:bg-dark-800 rounded-2xl shadow-md p-6 card-3d border border-dark-100/50 dark:border-dark-700/50">
              <div class="flex items-start justify-between">
                <div>
                  <p class="text-dark-500 dark:text-dark-400 text-sm">Open Rate</p>
                  <h3 class="text-3xl font-display font-bold mt-2 text-dark-900 dark:text-white">68.5%</h3>
                </div>
                <div class="w-12 h-12 rounded-xl bg-secondary-100 dark:bg-secondary-900/30 flex items-center justify-center text-secondary-500">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 19v-8.93a2 2 0 01.89-1.664l7-4.666a2 2 0 012.22 0l7 4.666A2 2 0 0121 10.07V19M3 19a2 2 0 002 2h14a2 2 0 002-2M3 19l6.75-4.5M21 19l-6.75-4.5M3 10l6.75 4.5M21 10l-6.75 4.5m0 0l-1.14.76a2 2 0 01-2.22 0l-1.14-.76" />
                  </svg>
                </div>
              </div>
              <div class="mt-4 flex items-center">
                <span class="text-green-500 flex items-center text-sm font-medium">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
                  </svg>
                  3.2%
                </span>
                <span class="text-dark-400 dark:text-dark-500 text-xs ml-2">vs last month</span>
              </div>
            </div>

            <div class="bg-white dark:bg-dark-800 rounded-2xl shadow-md p-6 card-3d border border-dark-100/50 dark:border-dark-700/50">
              <div class="flex items-start justify-between">
                <div>
                  <p class="text-dark-500 dark:text-dark-400 text-sm">Response Rate</p>
                  <h3 class="text-3xl font-display font-bold mt-2 text-dark-900 dark:text-white">12.3%</h3>
                </div>
                <div class="w-12 h-12 rounded-xl bg-purple-100 dark:bg-purple-900/30 flex items-center justify-center text-purple-500">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
                  </svg>
                </div>
              </div>
              <div class="mt-4 flex items-center">
                <span class="text-green-500 flex items-center text-sm font-medium">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
                  </svg>
                  1.5%
                </span>
                <span class="text-dark-400 dark:text-dark-500 text-xs ml-2">vs last month</span>
              </div>
            </div>

            <div class="bg-white dark:bg-dark-800 rounded-2xl shadow-md p-6 card-3d border border-dark-100/50 dark:border-dark-700/50">
              <div class="flex items-start justify-between">
                <div>
                  <p class="text-dark-500 dark:text-dark-400 text-sm">Next Follow-ups</p>
                  <h3 class="text-3xl font-display font-bold mt-2 text-dark-900 dark:text-white">27</h3>
                </div>
                <div class="w-12 h-12 rounded-xl bg-amber-100 dark:bg-amber-900/30 flex items-center justify-center text-amber-500">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                </div>
              </div>
              <div class="mt-4 flex items-center">
                <span class="text-amber-500 flex items-center text-sm font-medium">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                  </svg>
                  5 due today
                </span>
                <span class="text-dark-400 dark:text-dark-500 text-xs ml-2">+2 overdue</span>
              </div>
            </div>
          </div>

          <!-- Map and Nearby Section with improved layout -->
          <div class="flex flex-col lg:flex-row gap-6 relative">
            <!-- Map Area -->
            <div class="w-full lg:w-3/4 h-[70vh] lg:h-[80vh] rounded-2xl shadow-lg overflow-hidden relative">
              <div id="map" class="w-full h-full rounded-xl"></div>
            </div>

            <!-- Nearby Leads Panel - Semi-translucent modern styling -->
            <div class="w-full lg:w-1/4 bg-white/90 dark:bg-dark-800/90 backdrop-blur-lg p-6 rounded-2xl shadow-lg border border-dark-100/50 dark:border-dark-700/50 overflow-y-auto lg:max-h-[80vh]">
              <div class="mb-6">
                <h2 class="text-lg font-display font-bold mb-4 text-dark-900 dark:text-white flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                  </svg>
                  Nearby Leads
                </h2>

                <!-- Distance Filter Pills - Modern styling with gradients -->
                <div class="flex space-x-2 mb-4 overflow-x-auto hide-scrollbar pb-2">
                  <button type="button" class="distance-filter flex-shrink-0 px-4 py-1.5 bg-primary text-white rounded-full text-sm shadow-sm hover:shadow-md transition-all duration-200" data-distance="5">5 mi</button>
                  <button type="button" class="distance-filter flex-shrink-0 px-4 py-1.5 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-full text-sm shadow-sm hover:shadow-md transition-all duration-200" data-distance="10">10 mi</button>
                  <button type="button" class="distance-filter flex-shrink-0 px-4 py-1.5 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-full text-sm shadow-sm hover:shadow-md transition-all duration-200" data-distance="25">25 mi</button>
                  <button type="button" class="distance-filter flex-shrink-0 px-4 py-1.5 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-full text-sm shadow-sm hover:shadow-md transition-all duration-200" data-distance="50">50 mi</button>
                </div>

                <!-- Search input - Modern styling -->
                <div class="mb-4">
                  <div class="relative">
                    <input type="text" id="map-search" placeholder="Search nearby leads..." class="w-full p-3 pl-10 border-0 bg-dark-100/50 dark:bg-dark-700/50 rounded-xl focus:ring-2 focus:ring-primary" aria-label="Search nearby leads">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 absolute left-3 top-3.5 text-dark-400 dark:text-dark-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                  </div>
                </div>

                <!-- State Filters - Modern chips -->
                <div class="flex flex-wrap mt-2 gap-2">
                  <button type="button" class="state-filter px-3 py-1 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-md text-xs shadow-sm border border-dark-200/50 dark:border-dark-600/50 hover:bg-dark-100 dark:hover:bg-dark-600 transition-colors" data-state="WI">WI</button>
                  <button type="button" class="state-filter px-3 py-1 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-md text-xs shadow-sm border border-dark-200/50 dark:border-dark-600/50 hover:bg-dark-100 dark:hover:bg-dark-600 transition-colors" data-state="IL">IL</button>
                  <button type="button" class="state-filter px-3 py-1 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-md text-xs shadow-sm border border-dark-200/50 dark:border-dark-600/50 hover:bg-dark-100 dark:hover:bg-dark-600 transition-colors" data-state="MN">MN</button>
                  <button type="button" class="state-filter px-3 py-1 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-md text-xs shadow-sm border border-dark-200/50 dark:border-dark-600/50 hover:bg-dark-100 dark:hover:bg-dark-600 transition-colors" data-state="FL">FL</button>
                  <button type="button" class="state-filter px-3 py-1 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-md text-xs shadow-sm border border-dark-200/50 dark:border-dark-600/50 hover:bg-dark-100 dark:hover:bg-dark-600 transition-colors" data-state="IN">IN</button>
                  <button type="button" class="state-filter px-3 py-1 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-md text-xs shadow-sm border border-dark-200/50 dark:border-dark-600/50 hover:bg-dark-100 dark:hover:bg-dark-600 transition-colors" data-state="MI">MI</button>
                  <button type="button" class="state-filter px-3 py-1 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-md text-xs shadow-sm border border-dark-200/50 dark:border-dark-600/50 hover:bg-dark-100 dark:hover:bg-dark-600 transition-colors" data-state="TN">TN</button>
                  <button type="button" class="state-filter px-3 py-1 bg-primary text-white rounded-md text-xs shadow-sm" data-state="ALL">ALL</button>
                </div>
              </div>

              <!-- Nearby Leads List - Improved card design -->
              <div id="nearby-list" class="space-y-4">
                <!-- Animated placeholder cards -->
                <div class="animate-pulse space-y-4">
                  <div class="bg-white dark:bg-dark-700/50 rounded-xl p-4 shadow-sm hover:shadow-md transition-shadow duration-200">
                    <div class="rounded bg-dark-200 dark:bg-dark-600 h-5 w-2/3 mb-2"></div>
                    <div class="rounded bg-dark-200 dark:bg-dark-600 h-4 w-1/2 mb-2"></div>
                    <div class="flex items-center justify-between mt-2">
                      <div class="rounded bg-dark-200 dark:bg-dark-600 h-4 w-1/4"></div>
                      <div class="rounded bg-dark-200 dark:bg-dark-600 h-4 w-1/4"></div>
                    </div>
                  </div>
                  <div class="bg-white dark:bg-dark-700/50 rounded-xl p-4 shadow-sm hover:shadow-md transition-shadow duration-200">
                    <div class="rounded bg-dark-200 dark:bg-dark-600 h-5 w-1/2 mb-2"></div>
                    <div class="rounded bg-dark-200 dark:bg-dark-600 h-4 w-3/4 mb-2"></div>
                    <div class="flex items-center justify-between mt-2">
                      <div class="rounded bg-dark-200 dark:bg-dark-600 h-4 w-1/4"></div>
                      <div class="rounded bg-dark-200 dark:bg-dark-600 h-4 w-1/4"></div>
                    </div>
                  </div>
                  <div class="bg-white dark:bg-dark-700/50 rounded-xl p-4 shadow-sm hover:shadow-md transition-shadow duration-200">
                    <div class="rounded bg-dark-200 dark:bg-dark-600 h-5 w-3/5 mb-2"></div>
                    <div class="rounded bg-dark-200 dark:bg-dark-600 h-4 w-2/3 mb-2"></div>
                    <div class="flex items-center justify-between mt-2">
                      <div class="rounded bg-dark-200 dark:bg-dark-600 h-4 w-1/4"></div>
                      <div class="rounded bg-dark-200 dark:bg-dark-600 h-4 w-1/4"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Records Tab Content (Hidden by Default) -->
        <section id="records-tab" class="hidden space-y-6">
          <div class="bg-white/90 dark:bg-dark-800/90 backdrop-blur-lg rounded-2xl shadow-lg p-6 border border-dark-100/50 dark:border-dark-700/50">
            <h2 class="text-xl font-display font-bold mb-4 text-dark-900 dark:text-white">CRM Records</h2>
            <div class="flex flex-wrap gap-3 mb-4">
              <div class="relative flex-grow">
                <input type="text" id="records-search" placeholder="Search records..." class="w-full p-3 pl-10 bg-dark-100/50 dark:bg-dark-700/50 border-0 rounded-xl focus:ring-2 focus:ring-primary" aria-label="Search records">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 absolute left-3 top-3.5 text-dark-400 dark:text-dark-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                </svg>
              </div>

              <select id="records-filter" class="p-3 bg-dark-100/50 dark:bg-dark-700/50 border-0 rounded-xl focus:ring-2 focus:ring-primary text-dark-700 dark:text-dark-300" aria-label="Filter records">
                <option value="all">All Records</option>
                <option value="visited">Visited</option>
                <option value="unvisited">Unvisited</option>
                <option value="contacted">Contacted</option>
              </select>

              <button type="button" id="add-record-btn" class="gradient-btn px-5 py-3 text-white rounded-xl hover:shadow-lg focus:outline-none flex items-center space-x-2 transition-all duration-200">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                </svg>
                <span>Add Record</span>
              </button>
            </div>

            <!-- State Filter Pills -->
            <!-- State filter pills -->
            <div class="flex flex-wrap gap-2 mb-3">
              <button type="button" class="records-state-filter px-3 py-1.5 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-md text-xs shadow-sm border border-dark-200/50 dark:border-dark-600/50 hover:bg-dark-100 dark:hover:bg-dark-600 transition-colors" data-state="WI">WI</button>
              <button type="button" class="records-state-filter px-3 py-1.5 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-md text-xs shadow-sm border border-dark-200/50 dark:border-dark-600/50 hover:bg-dark-100 dark:hover:bg-dark-600 transition-colors" data-state="IL">IL</button>
              <button type="button" class="records-state-filter px-3 py-1.5 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-md text-xs shadow-sm border border-dark-200/50 dark:border-dark-600/50 hover:bg-dark-100 dark:hover:bg-dark-600 transition-colors" data-state="MN">MN</button>
              <button type="button" class="records-state-filter px-3 py-1.5 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-md text-xs shadow-sm border border-dark-200/50 dark:border-dark-600/50 hover:bg-dark-100 dark:hover:bg-dark-600 transition-colors" data-state="FL">FL</button>
              <button type="button" class="records-state-filter px-3 py-1.5 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-md text-xs shadow-sm border border-dark-200/50 dark:border-dark-600/50 hover:bg-dark-100 dark:hover:bg-dark-600 transition-colors" data-state="IN">IN</button>
              <button type="button" class="records-state-filter px-3 py-1.5 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-md text-xs shadow-sm border border-dark-200/50 dark:border-dark-600/50 hover:bg-dark-100 dark:hover:bg-dark-600 transition-colors" data-state="MI">MI</button>
              <button type="button" class="records-state-filter px-3 py-1.5 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-md text-xs shadow-sm border border-dark-200/50 dark:border-dark-600/50 hover:bg-dark-100 dark:hover:bg-dark-600 transition-colors" data-state="TN">TN</button>
              <button type="button" class="records-state-filter px-3 py-1.5 bg-primary text-white rounded-md text-xs shadow-sm" data-state="ALL">ALL</button>
            </div>

            <!-- City filters for Wisconsin (with Milwaukee highlighted) -->
            <div id="wi-cities-filter" class="flex flex-wrap gap-2 mb-5 city-filters hidden">
              <button type="button" class="city-filter px-3 py-1.5 bg-secondary text-white rounded-md text-xs shadow-sm font-medium" data-city="Milwaukee" data-state="WI">Milwaukee</button>
              <button type="button" class="city-filter px-3 py-1.5 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-md text-xs shadow-sm border border-dark-200/50 dark:border-dark-600/50 hover:bg-dark-100 dark:hover:bg-dark-600 transition-colors" data-city="Greenfield" data-state="WI">Greenfield</button>
              <button type="button" class="city-filter px-3 py-1.5 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-md text-xs shadow-sm border border-dark-200/50 dark:border-dark-600/50 hover:bg-dark-100 dark:hover:bg-dark-600 transition-colors" data-city="Baraboo" data-state="WI">Baraboo</button>
              <button type="button" class="city-filter px-3 py-1.5 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-md text-xs shadow-sm border border-dark-200/50 dark:border-dark-600/50 hover:bg-dark-100 dark:hover:bg-dark-600 transition-colors" data-city="Neenah" data-state="WI">Neenah</button>
              <button type="button" class="city-filter px-3 py-1.5 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-md text-xs shadow-sm border border-dark-200/50 dark:border-dark-600/50 hover:bg-dark-100 dark:hover:bg-dark-600 transition-colors" data-city="Sheboygan" data-state="WI">Sheboygan</button>
              <button type="button" class="city-filter px-3 py-1.5 bg-primary text-white rounded-md text-xs shadow-sm" data-city="ALL" data-state="WI">All WI Cities</button>
            </div>

            <!-- City filters for Minnesota -->
            <div id="mn-cities-filter" class="flex flex-wrap gap-2 mb-5 city-filters hidden">
              <button type="button" class="city-filter px-3 py-1.5 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-md text-xs shadow-sm border border-dark-200/50 dark:border-dark-600/50 hover:bg-dark-100 dark:hover:bg-dark-600 transition-colors" data-city="Minneapolis" data-state="MN">Minneapolis</button>
              <button type="button" class="city-filter px-3 py-1.5 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-md text-xs shadow-sm border border-dark-200/50 dark:border-dark-600/50 hover:bg-dark-100 dark:hover:bg-dark-600 transition-colors" data-city="St. Paul" data-state="MN">St. Paul</button>
              <button type="button" class="city-filter px-3 py-1.5 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-md text-xs shadow-sm border border-dark-200/50 dark:border-dark-600/50 hover:bg-dark-100 dark:hover:bg-dark-600 transition-colors" data-city="Bloomington" data-state="MN">Bloomington</button>
              <button type="button" class="city-filter px-3 py-1.5 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-md text-xs shadow-sm border border-dark-200/50 dark:border-dark-600/50 hover:bg-dark-100 dark:hover:bg-dark-600 transition-colors" data-city="Brooklyn Center" data-state="MN">Brooklyn Center</button>
              <button type="button" class="city-filter px-3 py-1.5 bg-primary text-white rounded-md text-xs shadow-sm" data-city="ALL" data-state="MN">All MN Cities</button>
            </div>

            <!-- More city filters will dynamically appear for other states -->

          </div>

          <!-- Records List -->
          <div id="records-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Leonard Lee's Record Card -->
            <div class="bg-white dark:bg-dark-800 rounded-2xl shadow-md p-6 border border-primary-200 dark:border-primary-700 card-3d">
              <div class="flex justify-between items-start mb-2">
                <h3 class="text-lg font-display font-bold text-dark-900 dark:text-white">Leonard Lee</h3>
                <span class="px-2 py-1 text-xs bg-primary-100 dark:bg-primary-900/30 text-primary-800 dark:text-primary-200 rounded-full">Owner</span>
              </div>
              <p class="text-dark-600 dark:text-dark-400 text-sm mb-3">
                Lee Music Distribution<br>
                414 Main Street, Milwaukee, WI 53202
              </p>
              <div class="flex flex-col gap-2 mb-3 text-sm">
                <div class="flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-dark-400 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                  </svg>
                  <span class="text-dark-700 dark:text-dark-300">414-555-1234</span>
                </div>
                <div class="flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-dark-400 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9" />
                  </svg>
                  <a href="https://www.leemusicdistribution.com" target="_blank" rel="noopener noreferrer" class="text-primary hover:underline">leemusicdistribution.com</a>
                </div>
                <div class="flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-dark-400 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                  </svg>
                  <a href="mailto:leonard@leemusicdistribution.com" class="text-primary hover:underline">leonard@leemusicdistribution.com</a>
                </div>
              </div>
              <div class="flex flex-wrap gap-2 mt-2">
                <span class="px-2 py-1 bg-primary-100 dark:bg-primary-900/30 text-primary-800 dark:text-primary-200 rounded text-xs">Music Distribution</span>
                <span class="px-2 py-1 bg-primary-100 dark:bg-primary-900/30 text-primary-800 dark:text-primary-200 rounded text-xs">Instruments</span>
                <span class="px-2 py-1 bg-primary-100 dark:bg-primary-900/30 text-primary-800 dark:text-primary-200 rounded text-xs">Sheet Music</span>
              </div>
              <div class="mt-4 flex justify-between items-center">
                <button type="button" class="text-sm px-3 py-1.5 bg-dark-100 dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-lg hover:bg-dark-200 dark:hover:bg-dark-600 transition-colors">
                  Edit Profile
                </button>
                <button type="button" class="text-sm px-3 py-1.5 gradient-btn text-white rounded-lg hover:shadow-md transition-all">
                  View Details
                </button>
              </div>
            </div>

            <!-- Milwaukee Music Store Record Card -->
            <div class="bg-white dark:bg-dark-800 rounded-2xl shadow-md p-6 border border-dark-100/50 dark:border-dark-700/50 card-3d">
              <div class="flex justify-between items-start mb-2">
                <h3 class="text-lg font-display font-bold text-dark-900 dark:text-white">Milwaukee Music Store</h3>
                <span class="px-2 py-1 text-xs bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-200 rounded-full">Key Account</span>
              </div>
              <p class="text-dark-600 dark:text-dark-400 text-sm mb-3">
                123 Wisconsin Ave, Milwaukee, WI 53203
              </p>
              <div class="flex flex-col gap-2 mb-3 text-sm">
                <div class="flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-dark-400 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                  </svg>
                  <span class="text-dark-700 dark:text-dark-300">414-555-5678</span>
                </div>
                <div class="flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-dark-400 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9" />
                  </svg>
                  <a href="https://www.milwaukeemusic.com" target="_blank" rel="noopener noreferrer" class="text-primary hover:underline">milwaukeemusic.com</a>
                </div>
                <div class="flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-dark-400 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                  </svg>
                  <a href="mailto:info@milwaukeemusic.com" class="text-primary hover:underline">info@milwaukeemusic.com</a>
                </div>
              </div>
              <div class="flex flex-wrap gap-2 mt-2">
                <span class="px-2 py-1 bg-primary-100 dark:bg-primary-900/30 text-primary-800 dark:text-primary-200 rounded text-xs">Retail</span>
                <span class="px-2 py-1 bg-primary-100 dark:bg-primary-900/30 text-primary-800 dark:text-primary-200 rounded text-xs">Instruments</span>
                <span class="px-2 py-1 bg-primary-100 dark:bg-primary-900/30 text-primary-800 dark:text-primary-200 rounded text-xs">Lessons</span>
              </div>
              <div class="mt-4 flex justify-between items-center">
                <button type="button" class="text-sm px-3 py-1.5 bg-dark-100 dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-lg hover:bg-dark-200 dark:hover:bg-dark-600 transition-colors">
                  Add Contact
                </button>
                <button type="button" class="text-sm px-3 py-1.5 gradient-btn text-white rounded-lg hover:shadow-md transition-all">
                  View on Map
                </button>
              </div>
            </div>

            <!-- Guitar World Record Card -->
            <div class="bg-white dark:bg-dark-800 rounded-2xl shadow-md p-6 border border-dark-100/50 dark:border-dark-700/50 card-3d">
              <div class="flex justify-between items-start mb-2">
                <h3 class="text-lg font-display font-bold text-dark-900 dark:text-white">Guitar World</h3>
                <span class="px-2 py-1 text-xs bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-200 rounded-full">New Lead</span>
              </div>
              <p class="text-dark-600 dark:text-dark-400 text-sm mb-3">
                789 Lake Drive, Milwaukee, WI 53211
              </p>
              <div class="flex flex-col gap-2 mb-3 text-sm">
                <div class="flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-dark-400 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                  </svg>
                  <span class="text-dark-700 dark:text-dark-300">414-555-9012</span>
                </div>
                <div class="flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-dark-400 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9" />
                  </svg>
                  <a href="https://www.guitarworld.com" target="_blank" rel="noopener noreferrer" class="text-primary hover:underline">guitarworld.com</a>
                </div>
                <div class="flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-dark-400 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                  </svg>
                  <span class="text-dark-700 dark:text-dark-300">Sarah Johnson (Purchasing Manager)</span>
                </div>
              </div>
              <div class="flex flex-wrap gap-2 mt-2">
                <span class="px-2 py-1 bg-primary-100 dark:bg-primary-900/30 text-primary-800 dark:text-primary-200 rounded text-xs">Retail</span>
                <span class="px-2 py-1 bg-primary-100 dark:bg-primary-900/30 text-primary-800 dark:text-primary-200 rounded text-xs">Guitars</span>
                <span class="px-2 py-1 bg-primary-100 dark:bg-primary-900/30 text-primary-800 dark:text-primary-200 rounded text-xs">Accessories</span>
              </div>
              <div class="mt-4 flex justify-between items-center">
                <button type="button" class="text-sm px-3 py-1.5 bg-dark-100 dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-lg hover:bg-dark-200 dark:hover:bg-dark-600 transition-colors">
                  Add Contact
                </button>
                <button type="button" class="text-sm px-3 py-1.5 gradient-btn text-white rounded-lg hover:shadow-md transition-all">
                  View on Map
                </button>
              </div>
            </div>

            <!-- More records will be populated here via JavaScript -->
          </div>

          <script>
            // Function to initialize records list with store data
            function initializeStoreRecords(filterState = null, filterCity = null) {
              const recordsList = document.getElementById('records-list');
              if (!recordsList) return;

              // Clear any existing content
              recordsList.innerHTML = '';

              // Get the stores to display - use combined stores if available
              let storeData = window.allStores || window.musicStores || [];

              if (storeData.length === 0) {
                recordsList.innerHTML = `
                  <div class="col-span-full">
                    <div class="bg-yellow-50 dark:bg-dark-800 border-l-4 border-yellow-400 p-4 rounded-lg">
                      <p class="text-yellow-700 dark:text-yellow-400">No store records found. Please check your data source.</p>
                    </div>
                  </div>
                `;
                return;
              }

              // Group stores by state and city
              const storesByLocation = {};
              storeData.forEach(store => {
                if (!storesByLocation[store.state]) {
                  storesByLocation[store.state] = {};
                }

                if (!storesByLocation[store.state][store.city]) {
                  storesByLocation[store.state][store.city] = [];
                }

                storesByLocation[store.state][store.city].push(store);
              });

              // Apply filters if specified
              let storesToDisplay = [];

              if (filterState && filterState !== 'ALL') {
                if (filterCity && filterCity !== 'ALL') {
                  // Specific city in a specific state
                  storesToDisplay = storesByLocation[filterState]?.[filterCity] || [];
                } else {
                  // All cities in a specific state
                  const cities = storesByLocation[filterState] || {};
                  Object.values(cities).forEach(cityStores => {
                    storesToDisplay = storesToDisplay.concat(cityStores);
                  });
                }
              } else {
                // All states or no filter
                for (const state in storesByLocation) {
                  for (const city in storesByLocation[state]) {
                    storesToDisplay = storesToDisplay.concat(storesByLocation[state][city]);
                  }
                }
              }

              // If no specific filter, prioritize Milwaukee, WI
              if (!filterState || filterState === 'ALL') {
                // Extract Milwaukee stores
                const milwaukeeStores = storesByLocation?.['WI']?.['Milwaukee'] || [];

                // Remove Milwaukee stores from the main array to avoid duplicates
                storesToDisplay = storesToDisplay.filter(store =>
                  !(store.state === 'WI' && store.city === 'Milwaukee')
                );

                // Add Milwaukee stores at the beginning
                storesToDisplay = [...milwaukeeStores, ...storesToDisplay];
              }

              // Handle Milwaukee Area special case
              if (filterState === 'WI' && filterCity === 'Milwaukee Area') {
                applyMilwaukeeAreaFilter();
                return;
              }

              // If no records after filtering
              if (storesToDisplay.length === 0) {
                recordsList.innerHTML = `
                  <div class="col-span-full">
                    <div class="bg-yellow-50 dark:bg-dark-800 border-l-4 border-yellow-400 p-4 rounded-lg">
                      <p class="text-yellow-700 dark:text-yellow-400">No stores found with the current filters.</p>
                    </div>
                  </div>
                `;
                return;
              }

              // Add location headers
              let currentState = null;
              let currentCity = null;
              let stateHeader = null;

              // Render each store as a record card
              storesToDisplay.forEach((store) => {
                const recordCard = document.createElement('div');
                recordCard.className = 'bg-white dark:bg-dark-800 rounded-2xl shadow-md p-6 border border-dark-100/50 dark:border-dark-700/50 card-3d';

                // Use verified/estimated badge for location status
                const locationBadge = store.estimatedCoordinates ?
                  '<span class="px-2 py-1 text-xs bg-amber-100 dark:bg-amber-900/30 text-amber-800 dark:text-amber-200 rounded-full">Estimated location</span>' :
                  '<span class="px-2 py-1 text-xs bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-200 rounded-full">Verified location</span>';

                recordCard.innerHTML = `
                  <div class="flex justify-between items-start mb-2">
                    <h3 class="text-lg font-display font-bold text-dark-900 dark:text-white">${store.name}</h3>
                    ${locationBadge}
                  </div>
                  <p class="text-dark-600 dark:text-dark-400 text-sm mb-3">
                    ${store.address}, ${store.city}, ${store.state} ${store.zip}
                  </p>
                  <div class="flex flex-col gap-2 mb-3 text-sm">
                    <div class="flex items-center">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-dark-400 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                      </svg>
                      <span class="text-dark-700 dark:text-dark-300">${store.phone}</span>
                    </div>
                    ${store.website ? `
                      <div class="flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-dark-400 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9" />
                        </svg>
                        <a href="https://${store.website}" target="_blank" class="text-primary hover:underline">${store.website}</a>
                      </div>
                    ` : ''}
                    ${store.email ? `
                      <div class="flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-dark-400 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                        </svg>
                        <a href="mailto:${store.email}" class="text-primary hover:underline">${store.email}</a>
                      </div>
                    ` : ''}
                  </div>
                  <div class="flex flex-wrap gap-2 mt-2">
                    ${store.tags.map(tag => `<span class="px-2 py-1 bg-primary-100 dark:bg-primary-900/30 text-primary-800 dark:text-primary-200 rounded text-xs">${tag}</span>`).join('')}
                  </div>
                  <div class="mt-4 flex justify-between items-center">
                    <button type="button" class="text-sm px-3 py-1.5 bg-dark-100 dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-lg hover:bg-dark-200 dark:hover:bg-dark-600 transition-colors" onclick="addContact('${store.name}', '${store.email}', '${store.phone}')">
                      Add Contact
                    </button>
                    <button type="button" class="text-sm px-3 py-1.5 gradient-btn text-white rounded-lg hover:shadow-md transition-all" onclick="viewOnMap('${store.lat}', '${store.lng}', '${store.name}')">
                      View on Map
                    </button>
                  </div>
                `;

                // Create or update state/city headers
                if (store.state !== currentState || store.city !== currentCity) {
                  // Create state header if needed
                  if (store.state !== currentState) {
                    currentState = store.state;
                    stateHeader = document.createElement('div');
                    stateHeader.className = 'col-span-full bg-gradient-to-r from-primary-50/70 to-transparent dark:from-primary-900/30 dark:to-transparent p-3 my-3 rounded-xl';
                    stateHeader.innerHTML = `
                      <h2 class="text-xl font-display font-bold text-primary-700 dark:text-primary-300">${currentState}</h2>
                    `;
                    recordsList.appendChild(stateHeader);
                  }

                  // Create city header
                  currentCity = store.city;
                  const cityHeader = document.createElement('div');
                  cityHeader.className = 'col-span-full flex items-center gap-2 py-2 px-3 my-2';

                  // Special styling for Milwaukee
                  const isMilwaukee = store.state === 'WI' && store.city === 'Milwaukee';
                  const cityIconColor = isMilwaukee ? 'text-secondary' : 'text-primary-400 dark:text-primary-500';
                  const cityTextColor = isMilwaukee ? 'text-secondary-700 dark:text-secondary-300 font-semibold' : 'text-dark-700 dark:text-dark-300';

                  cityHeader.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ${cityIconColor}" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                    <h3 class="text-lg ${cityTextColor}">${currentCity}</h3>
                  `;
                  recordsList.appendChild(cityHeader);
                }

                recordsList.appendChild(recordCard);
              });

              // Update city filter visibility based on selected state
              updateCityFilters(filterState);
            }

            // Update visible city filters based on selected state
            function updateCityFilters(state) {
              // Hide all city filters first
              document.querySelectorAll('.city-filters').forEach(el => {
                el.classList.add('hidden');
              });

              // Show specific city filters if a state is selected
              if (state && state !== 'ALL') {
                const cityFilters = document.getElementById(`${state.toLowerCase()}-cities-filter`);
                if (cityFilters) {
                  cityFilters.classList.remove('hidden');
                }
              }
            }

            // Setup event handlers for state and city filters
            document.addEventListener('DOMContentLoaded', function() {
              // State filter buttons
              document.querySelectorAll('.records-state-filter').forEach(btn => {
                btn.addEventListener('click', function() {
                  // Update button styles
                  document.querySelectorAll('.records-state-filter').forEach(b => {
                    b.classList.remove('bg-primary', 'text-white');
                    b.classList.add('bg-white', 'dark:bg-dark-700', 'text-dark-700', 'dark:text-dark-300');
                  });
                  this.classList.remove('bg-white', 'dark:bg-dark-700', 'text-dark-700', 'dark:text-dark-300');
                  this.classList.add('bg-primary', 'text-white');

                  // Get selected state
                  const state = this.dataset.state;

                  // Initialize records with state filter
                  initializeStoreRecords(state);
                });
              });

              // City filter buttons
              document.querySelectorAll('.city-filter').forEach(btn => {
                btn.addEventListener('click', function() {
                  // Update button styles within the current city filter group
                  const parent = this.closest('.city-filters');
                  if (parent) {
                    parent.querySelectorAll('.city-filter').forEach(b => {
                      b.classList.remove('bg-secondary', 'bg-primary', 'text-white');
                      b.classList.add('bg-white', 'dark:bg-dark-700', 'text-dark-700', 'dark:text-dark-300');
                    });
                  }

                  this.classList.remove('bg-white', 'dark:bg-dark-700', 'text-dark-700', 'dark:text-dark-300');

                  // Special styling for Milwaukee
                  if (this.dataset.city === 'Milwaukee' && this.dataset.state === 'WI') {
                    this.classList.add('bg-secondary', 'text-white');
                  } else {
                    this.classList.add('bg-primary', 'text-white');
                  }

                  // Get selected state and city
                  const state = this.dataset.state;
                  const city = this.dataset.city;

                  // Initialize records with state and city filters
                  initializeStoreRecords(state, city);
                });
              });

              // Add missing Milwaukee area suburbs to our city filters
              document.addEventListener('DOMContentLoaded', function() {
                // Create Milwaukee Metro Area filter with suburbs
                const wiCitiesFilter = document.getElementById('wi-cities-filter');
                if (wiCitiesFilter) {
                  // Add Milwaukee Area button after Milwaukee
                  const milwaukeeButton = wiCitiesFilter.querySelector('[data-city="Milwaukee"]');
                  if (milwaukeeButton && milwaukeeButton.parentNode) {
                    const metroButton = document.createElement('button');
                    metroButton.type = 'button';
                    metroButton.className = 'city-filter px-3 py-1.5 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-md text-xs shadow-sm border border-dark-200/50 dark:border-dark-600/50 hover:bg-dark-100 dark:hover:bg-dark-600 transition-colors';
                    metroButton.dataset.city = 'Milwaukee Area';
                    metroButton.dataset.state = 'WI';
                    metroButton.textContent = 'Milwaukee Area';
                    milwaukeeButton.parentNode.insertBefore(metroButton, milwaukeeButton.nextSibling);

                    // Add event listener to the metro button
                    metroButton.addEventListener('click', function() {
                      applyMilwaukeeAreaFilter();
                    });
                  }
                }

                // Auto-select Milwaukee, WI on first load
                // Click the WI state filter
                const wiButton = document.querySelector('.records-state-filter[data-state="WI"]');
                if (wiButton) {
                  wiButton.click();

                  // After a brief delay, click the Milwaukee city filter
                  setTimeout(() => {
                    const milwaukeeButton = document.querySelector('.city-filter[data-city="Milwaukee"][data-state="WI"]');
                    if (milwaukeeButton) {
                      milwaukeeButton.click();
                    }
                  }, 300);
                }
              });
            });

            // Function to apply Milwaukee Area filter - includes Milwaukee and nearby suburbs
            function applyMilwaukeeAreaFilter() {
              const recordsList = document.getElementById('records-list');
              if (!recordsList) return;

              // Clear existing content
              recordsList.innerHTML = '';

              // Get all stores
              let storeData = window.allStores || window.musicStores || [];

              // Create a header for Milwaukee Area
              const areaHeader = document.createElement('div');
              areaHeader.className = 'col-span-full bg-gradient-to-r from-secondary-50/70 to-transparent dark:from-secondary-900/30 dark:to-transparent p-3 my-3 rounded-xl';
              areaHeader.innerHTML = `
                <h2 class="text-xl font-display font-bold text-secondary-700 dark:text-secondary-300">Milwaukee Metro Area</h2>
                <p class="text-sm text-dark-500 dark:text-dark-400">Stores in Milwaukee and surrounding communities</p>
              `;
              recordsList.appendChild(areaHeader);

              // Milwaukee proper
              const milwaukeeStores = storeData.filter(store =>
                store.state === 'WI' && store.city === 'Milwaukee'
              );

              // Greenfield (Milwaukee suburb)
              const greenfieldStores = storeData.filter(store =>
                store.state === 'WI' && store.city === 'Greenfield'
              );

              // Other nearby communities that could be considered Milwaukee area
              const milwaukeeAreaStores = storeData.filter(store => {
                if (store.state !== 'WI') return false;

                // Common Milwaukee suburbs and nearby communities
                const milwaukeeAreaCities = [
                  'Wauwatosa', 'West Allis', 'Shorewood', 'Whitefish Bay',
                  'Glendale', 'Brown Deer', 'River Hills', 'Bayside',
                  'Fox Point', 'Cudahy', 'St. Francis', 'South Milwaukee',
                  'Oak Creek', 'Franklin', 'Hales Corners', 'Greendale',
                  'West Milwaukee', 'Butler', 'Elm Grove', 'Brookfield'
                ];

                return milwaukeeAreaCities.includes(store.city) ||
                  // Also include any store with a Milwaukee area zip code (starts with 53)
                  (store.zip && store.zip.startsWith('53'));
              });

              // Create city headers and add stores
              if (milwaukeeStores.length > 0) {
                addCityStores('Milwaukee', milwaukeeStores, recordsList, true);
              }

              if (greenfieldStores.length > 0) {
                addCityStores('Greenfield', greenfieldStores, recordsList);
              }

              // Group other area stores by city
              const otherAreaStoresByCity = {};
              milwaukeeAreaStores.forEach(store => {
                if (!otherAreaStoresByCity[store.city]) {
                  otherAreaStoresByCity[store.city] = [];
                }
                otherAreaStoresByCity[store.city].push(store);
              });

              // Add each city's stores
              Object.entries(otherAreaStoresByCity).forEach(([city, stores]) => {
                addCityStores(city, stores, recordsList);
              });

              // Update active button styling
              document.querySelectorAll('.city-filter').forEach(btn => {
                btn.classList.remove('bg-secondary', 'bg-primary', 'text-white');
                btn.classList.add('bg-white', 'dark:bg-dark-700', 'text-dark-700', 'dark:text-dark-300');
              });

              const metroButton = document.querySelector('.city-filter[data-city="Milwaukee Area"]');
              if (metroButton) {
                metroButton.classList.remove('bg-white', 'dark:bg-dark-700', 'text-dark-700', 'dark:text-dark-300');
                metroButton.classList.add('bg-secondary', 'text-white');
              }
            }

            // Helper function to add city stores with appropriate headers
            function addCityStores(city, stores, container, isPrimary = false) {
              if (!stores || !stores.length) return;

              // Create city header
              const cityHeader = document.createElement('div');
              cityHeader.className = 'col-span-full flex items-center gap-2 py-2 px-3 my-2';

              // Special styling for primary city (Milwaukee)
              const cityIconColor = isPrimary ? 'text-secondary' : 'text-primary-400 dark:text-primary-500';
              const cityTextColor = isPrimary ? 'text-secondary-700 dark:text-secondary-300 font-semibold' : 'text-dark-700 dark:text-dark-300';

              cityHeader.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ${cityIconColor}" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
                <h3 class="text-lg ${cityTextColor}">${city}</h3>
              `;
              container.appendChild(cityHeader);

              // Add individual store cards
              stores.forEach(store => {
                const recordCard = document.createElement('div');
                recordCard.className = 'bg-white dark:bg-dark-800 rounded-2xl shadow-md p-6 border border-dark-100/50 dark:border-dark-700/50 card-3d';

                // Use verified/estimated badge for location status
                const locationBadge = store.estimatedCoordinates ?
                  '<span class="px-2 py-1 text-xs bg-amber-100 dark:bg-amber-900/30 text-amber-800 dark:text-amber-200 rounded-full">Estimated location</span>' :
                  '<span class="px-2 py-1 text-xs bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-200 rounded-full">Verified location</span>';

                recordCard.innerHTML = `
                  <div class="flex justify-between items-start mb-2">
                    <h3 class="text-lg font-display font-bold text-dark-900 dark:text-white">${store.name}</h3>
                    ${locationBadge}
                  </div>
                  <p class="text-dark-600 dark:text-dark-400 text-sm mb-3">
                    ${store.address}, ${store.city}, ${store.state} ${store.zip}
                  </p>
                  <div class="flex flex-col gap-2 mb-3 text-sm">
                    <div class="flex items-center">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-dark-400 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                      </svg>
                      <span class="text-dark-700 dark:text-dark-300">${store.phone}</span>
                    </div>
                    ${store.website ? `
                      <div class="flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-dark-400 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9" />
                        </svg>
                        <a href="https://${store.website}" target="_blank" class="text-primary hover:underline">${store.website}</a>
                      </div>
                    ` : ''}
                    ${store.email ? `
                      <div class="flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-dark-400 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                        </svg>
                        <a href="mailto:${store.email}" class="text-primary hover:underline">${store.email}</a>
                      </div>
                    ` : ''}
                  </div>
                  <div class="flex flex-wrap gap-2 mt-2">
                    ${store.tags.map(tag => `<span class="px-2 py-1 bg-primary-100 dark:bg-primary-900/30 text-primary-800 dark:text-primary-200 rounded text-xs">${tag}</span>`).join('')}
                  </div>
                  <div class="mt-4 flex justify-between items-center">
                    <button type="button" class="text-sm px-3 py-1.5 bg-dark-100 dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-lg hover:bg-dark-200 dark:hover:bg-dark-600 transition-colors" onclick="addContact('${store.name}', '${store.email}', '${store.phone}')">
                      Add Contact
                    </button>
                    <button type="button" class="text-sm px-3 py-1.5 gradient-btn text-white rounded-lg hover:shadow-md transition-all" onclick="viewOnMap('${store.lat}', '${store.lng}', '${store.name}')">
                      View on Map
                    </button>
                  </div>
                `;

                container.appendChild(recordCard);
              });
            }

            // Function to view store on map
            function viewOnMap(lat, lng, name) {
              if (!window.map) {
                console.error("Map not initialized");
                return;
              }

              // Activate map tab
              document.querySelectorAll('[data-tab="map"]').forEach(tab => {
                tab.click();
              });

              // Pan to location
              window.map.panTo({lat: parseFloat(lat), lng: parseFloat(lng)});
              window.map.setZoom(14);

              // Find and click the marker
              if (window.storeMarkers) {
                const marker = window.storeMarkers.find(m =>
                  m.getPosition().lat() === parseFloat(lat) &&
                  m.getPosition().lng() === parseFloat(lng));

                if (marker) {
                  google.maps.event.trigger(marker, 'click');
                }
              }
            }

            // Function to add contact (placeholder functionality)
            function addContact(name, email, phone) {
              alert(`Contact added: ${name}\nEmail: ${email}\nPhone: ${phone}`);
              // In a real implementation, this would add to a contacts database
            }

            // Initialize records when the records tab is shown
            document.querySelectorAll('[data-tab="records"]').forEach(tab => {
              tab.addEventListener('click', function() {
                initializeStoreRecords();
              });
            });
          </script>
        </section>

        <!-- File Browser Tab -->
        <section id="file-browser-tab" class="hidden space-y-6">
          <div class="bg-white/90 dark:bg-dark-800/90 backdrop-blur-lg rounded-2xl shadow-lg p-6 border border-dark-100/50 dark:border-dark-700/50">
            <h2 class="text-xl font-display font-bold mb-4 text-dark-900 dark:text-white">File Browser</h2>

            <!-- Search and Filter Bar -->
            <div class="flex flex-wrap gap-3 mb-6">
              <div class="relative flex-grow">
                <input type="text" id="file-search" placeholder="Search files..." class="w-full p-3 pl-10 bg-dark-100/50 dark:bg-dark-700/50 border-0 rounded-xl focus:ring-2 focus:ring-primary" aria-label="Search files">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 absolute left-3 top-3.5 text-dark-400 dark:text-dark-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                </svg>
              </div>

              <select id="file-filter" class="p-3 bg-dark-100/50 dark:bg-dark-700/50 border-0 rounded-xl focus:ring-2 focus:ring-primary text-dark-700 dark:text-dark-300" aria-label="Filter files">
                <option value="all">All Files</option>
                <option value="html">HTML</option>
                <option value="js">JavaScript</option>
                <option value="css">CSS</option>
                <option value="images">Images</option>
                <option value="other">Other</option>
              </select>
            </div>

            <!-- File Categories Toggle -->
            <div class="flex flex-wrap gap-2 mb-6">
              <button type="button" class="file-category-btn px-3 py-1.5 bg-primary text-white rounded-full text-sm shadow-sm hover:shadow-md transition-all duration-200" data-category="all">All Files</button>
              <button type="button" class="file-category-btn px-3 py-1.5 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-full text-sm shadow-sm hover:shadow-md transition-all duration-200" data-category="html">HTML</button>
              <button type="button" class="file-category-btn px-3 py-1.5 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-full text-sm shadow-sm hover:shadow-md transition-all duration-200" data-category="js">JavaScript</button>
              <button type="button" class="file-category-btn px-3 py-1.5 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-full text-sm shadow-sm hover:shadow-md transition-all duration-200" data-category="css">CSS</button>
              <button type="button" class="file-category-btn px-3 py-1.5 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-full text-sm shadow-sm hover:shadow-md transition-all duration-200" data-category="images">Images</button>
              <button type="button" class="file-category-btn px-3 py-1.5 bg-white dark:bg-dark-700 text-dark-700 dark:text-dark-300 rounded-full text-sm shadow-sm hover:shadow-md transition-all duration-200" data-category="other">Other</button>
            </div>

            <!-- Current Path and Navigation -->
            <div class="flex items-center mb-4 py-2 px-3 bg-dark-50/50 dark:bg-dark-800/50 rounded-lg text-sm">
              <span class="text-primary-600 dark:text-primary-400 font-medium">Current Location:</span>
              <div class="ml-2 flex items-center gap-1 text-dark-600 dark:text-dark-400">
                <span class="cursor-pointer hover:text-primary transition-colors" onclick="navigateFileBrowser('/')">/</span>
                <span class="text-dark-400">/</span>
                <span class="cursor-pointer hover:text-primary transition-colors">user_site</span>
                <span class="text-dark-400">/</span>
                <span class="cursor-pointer hover:text-primary transition-colors">src</span>
              </div>
            </div>
          </div>

          <!-- File Listing Section -->
          <div class="bg-white/90 dark:bg-dark-800/90 backdrop-blur-lg rounded-2xl shadow-lg border border-dark-100/50 dark:border-dark-700/50 overflow-hidden">
            <!-- File List Header -->
            <div class="grid grid-cols-12 bg-dark-50 dark:bg-dark-700/70 p-3 text-sm font-medium text-dark-700 dark:text-dark-300 border-b border-dark-100/50 dark:border-dark-700/50">
              <div class="col-span-6">Name</div>
              <div class="col-span-2">Type</div>
              <div class="col-span-2">Size</div>
              <div class="col-span-2">Actions</div>
            </div>

            <!-- File List (will be populated by JavaScript) -->
            <div id="file-list" class="max-h-[60vh] overflow-y-auto">
              <!-- Loading placeholder -->
              <div class="animate-pulse p-4 space-y-3">
                <div class="h-10 bg-dark-200/50 dark:bg-dark-600/50 rounded"></div>
                <div class="h-10 bg-dark-200/50 dark:bg-dark-600/50 rounded"></div>
                <div class="h-10 bg-dark-200/50 dark:bg-dark-600/50 rounded"></div>
                <div class="h-10 bg-dark-200/50 dark:bg-dark-600/50 rounded"></div>
                <div class="h-10 bg-dark-200/50 dark:bg-dark-600/50 rounded"></div>
              </div>
            </div>
          </div>

          <!-- File Preview Modal (hidden by default) -->
          <div id="file-preview-modal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center">
            <div class="bg-white dark:bg-dark-800 rounded-2xl shadow-xl max-w-4xl w-full max-h-[90vh] flex flex-col">
              <div class="flex justify-between items-center p-4 border-b border-dark-100/50 dark:border-dark-700/50">
                <h3 class="text-lg font-display font-bold text-dark-900 dark:text-white" id="preview-file-name">File Preview</h3>
                <button type="button" id="close-preview" class="p-2 text-dark-500 hover:bg-dark-100 dark:hover:bg-dark-700/50 rounded-lg">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                  </svg>
                </button>
              </div>
              <div class="p-4 flex-1 overflow-auto" id="preview-content">
                <!-- Preview content will be inserted here -->
              </div>
              <div class="p-4 flex justify-end gap-3 border-t border-dark-100/50 dark:border-dark-700/50">
                <button type="button" id="close-preview-btn" class="px-4 py-2 text-dark-700 dark:text-dark-300 bg-dark-100 dark:bg-dark-700 hover:bg-dark-200 dark:hover:bg-dark-600 rounded-lg transition-colors">
                  Close
                </button>
              </div>
            </div>
          </div>
        </section>

        <!-- Phone Tab Content -->
        <section id="phone-tab" class="hidden space-y-6">
          <div class="bg-white/90 dark:bg-dark-800/90 backdrop-blur-lg rounded-2xl shadow-lg p-6 border border-dark-100/50 dark:border-dark-700/50">
            <h2 class="text-xl font-display font-bold mb-4 text-dark-900 dark:text-white flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
              </svg>
              Phone System
            </h2>

            <!-- Phone Interface -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
              <!-- Dialer and Active Call -->
              <div class="bg-white dark:bg-dark-700 rounded-xl shadow-md p-4 border border-dark-100/50 dark:border-dark-700/50">
                <div class="text-center mb-4">
                  <div id="phone-status" class="text-sm font-medium text-green-500">Ready</div>
                  <div id="phone-number-display" class="text-2xl font-bold text-dark-900 dark:text-white mt-1 h-8">
                    <!-- Phone number will appear here -->
                  </div>
                </div>

                <!-- Dialer Pad -->
                <div class="grid grid-cols-3 gap-2 mb-4">
                  <button type="button" class="dialer-btn p-4 rounded-lg bg-dark-50 dark:bg-dark-600 text-dark-900 dark:text-white text-xl font-medium hover:bg-dark-100 dark:hover:bg-dark-500 transition-colors">1</button>
                  <button type="button" class="dialer-btn p-4 rounded-lg bg-dark-50 dark:bg-dark-600 text-dark-900 dark:text-white text-xl font-medium hover:bg-dark-100 dark:hover:bg-dark-500 transition-colors">2</button>
                  <button type="button" class="dialer-btn p-4 rounded-lg bg-dark-50 dark:bg-dark-600 text-dark-900 dark:text-white text-xl font-medium hover:bg-dark-100 dark:hover:bg-dark-500 transition-colors">3</button>
                  <button type="button" class="dialer-btn p-4 rounded-lg bg-dark-50 dark:bg-dark-600 text-dark-900 dark:text-white text-xl font-medium hover:bg-dark-100 dark:hover:bg-dark-500 transition-colors">4</button>
                  <button type="button" class="dialer-btn p-4 rounded-lg bg-dark-50 dark:bg-dark-600 text-dark-900 dark:text-white text-xl font-medium hover:bg-dark-100 dark:hover:bg-dark-500 transition-colors">5</button>
                  <button type="button" class="dialer-btn p-4 rounded-lg bg-dark-50 dark:bg-dark-600 text-dark-900 dark:text-white text-xl font-medium hover:bg-dark-100 dark:hover:bg-dark-500 transition-colors">6</button>
                  <button type="button" class="dialer-btn p-4 rounded-lg bg-dark-50 dark:bg-dark-600 text-dark-900 dark:text-white text-xl font-medium hover:bg-dark-100 dark:hover:bg-dark-500 transition-colors">7</button>
                  <button type="button" class="dialer-btn p-4 rounded-lg bg-dark-50 dark:bg-dark-600 text-dark-900 dark:text-white text-xl font-medium hover:bg-dark-100 dark:hover:bg-dark-500 transition-colors">8</button>
                  <button type="button" class="dialer-btn p-4 rounded-lg bg-dark-50 dark:bg-dark-600 text-dark-900 dark:text-white text-xl font-medium hover:bg-dark-100 dark:hover:bg-dark-500 transition-colors">9</button>
                  <button type="button" class="dialer-btn p-4 rounded-lg bg-dark-50 dark:bg-dark-600 text-dark-900 dark:text-white text-xl font-medium hover:bg-dark-100 dark:hover:bg-dark-500 transition-colors">*</button>
                  <button type="button" class="dialer-btn p-4 rounded-lg bg-dark-50 dark:bg-dark-600 text-dark-900 dark:text-white text-xl font-medium hover:bg-dark-100 dark:hover:bg-dark-500 transition-colors">0</button>
                  <button type="button" class="dialer-btn p-4 rounded-lg bg-dark-50 dark:bg-dark-600 text-dark-900 dark:text-white text-xl font-medium hover:bg-dark-100 dark:hover:bg-dark-500 transition-colors">#</button>
                </div>

                <!-- Call Controls -->
                <div class="flex justify-between items-center">
                  <button type="button" id="clear-number" class="p-3 rounded-lg bg-dark-100 dark:bg-dark-600 text-dark-700 dark:text-dark-300 hover:bg-dark-200 dark:hover:bg-dark-500 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2" />
                    </svg>
                  </button>

                  <button type="button" id="call-button" class="p-4 rounded-full bg-green-500 text-white hover:bg-green-600 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                    </svg>
                  </button>

                  <button type="button" id="hangup-button" class="p-3 rounded-lg bg-red-500 text-white hover:bg-red-600 transition-colors hidden">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 8l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2M5 3a2 2 0 00-2 2v1c0 8.284 6.716 15 15 15h1a2 2 0 002-2v-3.28a1 1 0 00-.684-.948l-4.493-1.498a1 1 0 00-1.21.502l-1.13 2.257a11.042 11.042 0 01-5.516-5.517l2.257-1.128a1 1 0 00.502-1.21L9.228 3.683A1 1 0 008.279 3H5z" />
                    </svg>
                  </button>
                </div>

                <!-- Call Timer (hidden by default) -->
                <div id="call-timer" class="mt-4 text-center hidden">
                  <div class="text-sm text-dark-500 dark:text-dark-400">Call in progress</div>
                  <div class="text-xl font-bold text-dark-900 dark:text-white">00:00</div>
                </div>

                <!-- Call Actions (hidden by default) -->
                <div id="call-actions" class="mt-4 grid grid-cols-3 gap-2 hidden">
                  <button type="button" id="mute-button" class="p-3 rounded-lg bg-dark-100 dark:bg-dark-600 text-dark-700 dark:text-dark-300 hover:bg-dark-200 dark:hover:bg-dark-500 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />
                    </svg>
                    <span class="text-xs block mt-1">Mute</span>
                  </button>

                  <button type="button" id="speaker-button" class="p-3 rounded-lg bg-dark-100 dark:bg-dark-600 text-dark-700 dark:text-dark-300 hover:bg-dark-200 dark:hover:bg-dark-500 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
                    </svg>
                    <span class="text-xs block mt-1">Speaker</span>
                  </button>

                  <button type="button" id="record-button" class="p-3 rounded-lg bg-dark-100 dark:bg-dark-600 text-dark-700 dark:text-dark-300 hover:bg-dark-200 dark:hover:bg-dark-500 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />
                    </svg>
                    <span class="text-xs block mt-1">Record</span>
                  </button>
                </div>
              </div>

              <!-- Contacts List -->
              <div class="bg-white dark:bg-dark-700 rounded-xl shadow-md p-4 border border-dark-100/50 dark:border-dark-700/50">
                <div class="flex justify-between items-center mb-4">
                  <h3 class="text-lg font-medium text-dark-900 dark:text-white">Contacts</h3>
                  <button type="button" id="add-contact" class="p-2 rounded-lg bg-primary-100 dark:bg-primary-900/30 text-primary-700 dark:text-primary-300 hover:bg-primary-200 dark:hover:bg-primary-800/30 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                    </svg>
                  </button>
                </div>

                <!-- Search Contacts -->
                <div class="relative mb-4">
                  <input type="text" id="contact-search" placeholder="Search contacts..." class="w-full p-2 pl-8 bg-dark-100/50 dark:bg-dark-600/50 border-0 rounded-lg focus:ring-2 focus:ring-primary" aria-label="Search contacts">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 absolute left-2 top-3 text-dark-400 dark:text-dark-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                  </svg>
                </div>

                <!-- Contacts List -->
                <div id="contacts-list" class="space-y-2 max-h-[400px] overflow-y-auto">
                  <!-- Contacts will be populated here -->
                  <div class="animate-pulse space-y-3">
                    <div class="h-12 bg-dark-200/50 dark:bg-dark-600/50 rounded-lg"></div>
                    <div class="h-12 bg-dark-200/50 dark:bg-dark-600/50 rounded-lg"></div>
                    <div class="h-12 bg-dark-200/50 dark:bg-dark-600/50 rounded-lg"></div>
                    <div class="h-12 bg-dark-200/50 dark:bg-dark-600/50 rounded-lg"></div>
                  </div>
                </div>
              </div>

              <!-- Call History -->
              <div class="bg-white dark:bg-dark-700 rounded-xl shadow-md p-4 border border-dark-100/50 dark:border-dark-700/50">
                <div class="flex justify-between items-center mb-4">
                  <h3 class="text-lg font-medium text-dark-900 dark:text-white">Call History</h3>
                  <div>
                    <select id="call-history-filter" class="text-xs p-1 bg-dark-100/50 dark:bg-dark-600/50 border-0 rounded-lg focus:ring-2 focus:ring-primary text-dark-700 dark:text-dark-300">
                      <option value="all">All Calls</option>
                      <option value="incoming">Incoming</option>
                      <option value="outgoing">Outgoing</option>
                      <option value="missed">Missed</option>
                    </select>
                  </div>
                </div>

                <!-- Call History List -->
                <div id="call-history-list" class="space-y-2 max-h-[400px] overflow-y-auto">
                  <!-- Call history will be populated here -->
                  <div class="animate-pulse space-y-3">
                    <div class="h-12 bg-dark-200/50 dark:bg-dark-600/50 rounded-lg"></div>
                    <div class="h-12 bg-dark-200/50 dark:bg-dark-600/50 rounded-lg"></div>
                    <div class="h-12 bg-dark-200/50 dark:bg-dark-600/50 rounded-lg"></div>
                    <div class="h-12 bg-dark-200/50 dark:bg-dark-600/50 rounded-lg"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Voice Transcription Section -->
          <div class="bg-white/90 dark:bg-dark-800/90 backdrop-blur-lg rounded-2xl shadow-lg p-6 border border-dark-100/50 dark:border-dark-700/50">
            <h3 class="text-lg font-display font-bold mb-4 text-dark-900 dark:text-white flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />
              </svg>
              Voice Transcription
            </h3>

            <div class="flex flex-col md:flex-row gap-4">
              <!-- Transcription Controls -->
              <div class="w-full md:w-1/3 bg-dark-50/50 dark:bg-dark-700/50 rounded-xl p-4">
                <div class="flex flex-col items-center justify-center h-full">
                  <button type="button" id="start-transcription" class="mb-4 p-4 rounded-full bg-primary text-white hover:bg-primary-600 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />
                    </svg>
                  </button>
                  <button type="button" id="stop-transcription" class="mb-4 p-4 rounded-full bg-red-500 text-white hover:bg-red-600 transition-colors hidden">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 10a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1v-4z" />
                    </svg>
                  </button>
                  <div id="transcription-status" class="text-center text-dark-500 dark:text-dark-400 text-sm">
                    Click to start recording
                  </div>
                </div>
              </div>

              <!-- Transcription Results -->
              <div class="w-full md:w-2/3">
                <div class="bg-dark-50/50 dark:bg-dark-700/50 rounded-xl p-4 h-40 overflow-y-auto">
                  <div id="transcription-result" class="text-dark-700 dark:text-dark-300 whitespace-pre-wrap">
                    Transcription will appear here...
                  </div>
                </div>

                <div class="flex justify-between mt-4">
                  <button type="button" id="clear-transcription" class="px-4 py-2 bg-dark-200 dark:bg-dark-600 text-dark-700 dark:text-dark-300 rounded-lg hover:bg-dark-300 dark:hover:bg-dark-500 transition-colors">
                    Clear
                  </button>

                  <div class="space-x-2">
                    <button type="button" id="save-transcription" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-600 transition-colors">
                      Save Note
                    </button>
                    <button type="button" id="create-task-from-transcription" class="px-4 py-2 bg-secondary text-white rounded-lg hover:bg-secondary-600 transition-colors">
                      Create Task
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Add Contact Modal (hidden by default) -->
          <div id="add-contact-modal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center">
            <div class="bg-white dark:bg-dark-800 rounded-2xl shadow-xl max-w-md w-full">
              <div class="flex justify-between items-center p-4 border-b border-dark-100/50 dark:border-dark-700/50">
                <h3 class="text-lg font-display font-bold text-dark-900 dark:text-white">Add New Contact</h3>
                <button type="button" id="close-contact-modal" class="p-2 text-dark-500 hover:bg-dark-100 dark:hover:bg-dark-700/50 rounded-lg">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                  </svg>
                </button>
              </div>

              <div class="p-4">
                <form id="add-contact-form" class="space-y-4">
                  <div>
                    <label for="contact-name" class="block text-sm font-medium text-dark-700 dark:text-dark-300 mb-1">Name</label>
                    <input type="text" id="contact-name" class="w-full p-2 bg-dark-100/50 dark:bg-dark-700/50 border-0 rounded-lg focus:ring-2 focus:ring-primary" required>
                  </div>

                  <div>
                    <label for="contact-phone" class="block text-sm font-medium text-dark-700 dark:text-dark-300 mb-1">Phone Number</label>
                    <input type="tel" id="contact-phone" class="w-full p-2 bg-dark-100/50 dark:bg-dark-700/50 border-0 rounded-lg focus:ring-2 focus:ring-primary" required>
                  </div>

                  <div>
                    <label for="contact-email" class="block text-sm font-medium text-dark-700 dark:text-dark-300 mb-1">Email (optional)</label>
                    <input type="email" id="contact-email" class="w-full p-2 bg-dark-100/50 dark:bg-dark-700/50 border-0 rounded-lg focus:ring-2 focus:ring-primary">
                  </div>

                  <div>
                    <label for="contact-company" class="block text-sm font-medium text-dark-700 dark:text-dark-300 mb-1">Company (optional)</label>
                    <input type="text" id="contact-company" class="w-full p-2 bg-dark-100/50 dark:bg-dark-700/50 border-0 rounded-lg focus:ring-2 focus:ring-primary">
                  </div>

                  <div>
                    <label for="contact-notes" class="block text-sm font-medium text-dark-700 dark:text-dark-300 mb-1">Notes (optional)</label>
                    <textarea id="contact-notes" rows="3" class="w-full p-2 bg-dark-100/50 dark:bg-dark-700/50 border-0 rounded-lg focus:ring-2 focus:ring-primary"></textarea>
                  </div>
                </form>
              </div>

              <div class="p-4 flex justify-end gap-3 border-t border-dark-100/50 dark:border-dark-700/50">
                <button type="button" id="cancel-add-contact" class="px-4 py-2 text-dark-700 dark:text-dark-300 bg-dark-100 dark:bg-dark-700 hover:bg-dark-200 dark:hover:bg-dark-600 rounded-lg transition-colors">
                  Cancel
                </button>
                <button type="button" id="save-contact" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-600 transition-colors">
                  Save Contact
                </button>
              </div>
            </div>
          </div>
        </section>

        <!-- Campaigns Tab Content -->
        <section id="campaigns-tab" class="hidden space-y-6">
          <div class="bg-white/90 dark:bg-dark-800/90 backdrop-blur-lg rounded-2xl shadow-lg p-6 border border-dark-100/50 dark:border-dark-700/50">
            <h2 class="text-xl font-display font-bold mb-4 text-dark-900 dark:text-white flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2 text-purple-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
              </svg>
              Email Campaigns
            </h2>

            <!-- Campaign Actions -->
            <div class="flex flex-wrap gap-3 mb-6">
              <button type="button" id="create-campaign-btn" class="gradient-btn px-5 py-3 text-white rounded-xl hover:shadow-lg focus:outline-none flex items-center space-x-2 transition-all duration-200">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                </svg>
                <span>Create Campaign</span>
              </button>

              <div class="relative flex-grow">
                <input type="text" id="campaign-search" placeholder="Search campaigns..." class="w-full p-3 pl-10 bg-dark-100/50 dark:bg-dark-700/50 border-0 rounded-xl focus:ring-2 focus:ring-primary" aria-label="Search campaigns">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 absolute left-3 top-3.5 text-dark-400 dark:text-dark-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                </svg>
              </div>

              <select id="campaign-filter" class="p-3 bg-dark-100/50 dark:bg-dark-700/50 border-0 rounded-xl focus:ring-2 focus:ring-primary text-dark-700 dark:text-dark-300" aria-label="Filter campaigns">
                <option value="all">All Campaigns</option>
                <option value="draft">Drafts</option>
                <option value="scheduled">Scheduled</option>
                <option value="sent">Sent</option>
                <option value="completed">Completed</option>
              </select>
            </div>

            <!-- Campaign Stats -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
              <div class="bg-white dark:bg-dark-700 rounded-xl p-4 shadow-sm border border-dark-100/50 dark:border-dark-700/50">
                <div class="flex items-center justify-between">
                  <div>
                    <p class="text-dark-500 dark:text-dark-400 text-sm">Total Campaigns</p>
                    <h3 class="text-2xl font-display font-bold mt-1 text-dark-900 dark:text-white">12</h3>
                  </div>
                  <div class="w-10 h-10 rounded-lg bg-purple-100 dark:bg-purple-900/30 flex items-center justify-center text-purple-500">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                    </svg>
                  </div>
                </div>
              </div>

              <div class="bg-white dark:bg-dark-700 rounded-xl p-4 shadow-sm border border-dark-100/50 dark:border-dark-700/50">
                <div class="flex items-center justify-between">
                  <div>
                    <p class="text-dark-500 dark:text-dark-400 text-sm">Open Rate</p>
                    <h3 class="text-2xl font-display font-bold mt-1 text-dark-900 dark:text-white">68.5%</h3>
                  </div>
                  <div class="w-10 h-10 rounded-lg bg-green-100 dark:bg-green-900/30 flex items-center justify-center text-green-500">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                    </svg>
                  </div>
                </div>
              </div>

              <div class="bg-white dark:bg-dark-700 rounded-xl p-4 shadow-sm border border-dark-100/50 dark:border-dark-700/50">
                <div class="flex items-center justify-between">
                  <div>
                    <p class="text-dark-500 dark:text-dark-400 text-sm">Click Rate</p>
                    <h3 class="text-2xl font-display font-bold mt-1 text-dark-900 dark:text-white">24.3%</h3>
                  </div>
                  <div class="w-10 h-10 rounded-lg bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center text-blue-500">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5M7.188 2.239l.777 2.897M5.136 7.965l-2.898-.777M13.95 4.05l-2.122 2.122m-5.657 5.656l-2.12 2.122" />
                    </svg>
                  </div>
                </div>
              </div>

              <div class="bg-white dark:bg-dark-700 rounded-xl p-4 shadow-sm border border-dark-100/50 dark:border-dark-700/50">
                <div class="flex items-center justify-between">
                  <div>
                    <p class="text-dark-500 dark:text-dark-400 text-sm">Response Rate</p>
                    <h3 class="text-2xl font-display font-bold mt-1 text-dark-900 dark:text-white">12.1%</h3>
                  </div>
                  <div class="w-10 h-10 rounded-lg bg-amber-100 dark:bg-amber-900/30 flex items-center justify-center text-amber-500">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
                    </svg>
                  </div>
                </div>
              </div>
            </div>

            <!-- Campaign List -->
            <div id="campaigns-list" class="space-y-4">
              <!-- Loading placeholder -->
              <div class="animate-pulse space-y-4">
                <div class="h-24 bg-dark-200/50 dark:bg-dark-600/50 rounded-xl"></div>
                <div class="h-24 bg-dark-200/50 dark:bg-dark-600/50 rounded-xl"></div>
                <div class="h-24 bg-dark-200/50 dark:bg-dark-600/50 rounded-xl"></div>
              </div>
            </div>
          </div>

          <!-- Campaign Creation/Edit Modal -->
          <div id="campaign-modal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center overflow-y-auto">
            <div class="bg-white dark:bg-dark-800 rounded-2xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto m-4">
              <div class="flex justify-between items-center p-4 border-b border-dark-100/50 dark:border-dark-700/50">
                <h3 class="text-lg font-display font-bold text-dark-900 dark:text-white" id="campaign-modal-title">Create New Campaign</h3>
                <button type="button" id="close-campaign-modal" class="p-2 text-dark-500 hover:bg-dark-100 dark:hover:bg-dark-700/50 rounded-lg" aria-label="Close modal">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                  </svg>
                </button>
              </div>

              <div class="p-4">
                <form id="campaign-form" class="space-y-4">
                  <div>
                    <label for="campaign-title" class="block text-sm font-medium text-dark-700 dark:text-dark-300 mb-1">Campaign Title</label>
                    <input type="text" id="campaign-title" class="w-full p-2 bg-dark-100/50 dark:bg-dark-700/50 border-0 rounded-lg focus:ring-2 focus:ring-primary" required>
                  </div>

                  <div>
                    <label for="campaign-subject" class="block text-sm font-medium text-dark-700 dark:text-dark-300 mb-1">Email Subject</label>
                    <input type="text" id="campaign-subject" class="w-full p-2 bg-dark-100/50 dark:bg-dark-700/50 border-0 rounded-lg focus:ring-2 focus:ring-primary" required>
                  </div>

                  <div>
                    <label for="campaign-template" class="block text-sm font-medium text-dark-700 dark:text-dark-300 mb-1">Email Template</label>
                    <select id="campaign-template" class="w-full p-2 bg-dark-100/50 dark:bg-dark-700/50 border-0 rounded-lg focus:ring-2 focus:ring-primary">
                      <option value="default">Default Template</option>
                      <option value="promotional">Promotional</option>
                      <option value="newsletter">Newsletter</option>
                      <option value="announcement">Announcement</option>
                      <option value="follow-up">Follow-up</option>
                    </select>
                  </div>

                  <div>
                    <label for="campaign-message" class="block text-sm font-medium text-dark-700 dark:text-dark-300 mb-1">Email Content</label>
                    <div class="border border-dark-200 dark:border-dark-600 rounded-lg overflow-hidden">
                      <div class="bg-dark-100 dark:bg-dark-700 p-2 flex space-x-2 border-b border-dark-200 dark:border-dark-600">
                        <button type="button" class="p-1 rounded hover:bg-dark-200 dark:hover:bg-dark-600" title="Bold">
                          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 12h8m-8 6h8m-8-12h8" />
                          </svg>
                        </button>
                        <button type="button" class="p-1 rounded hover:bg-dark-200 dark:hover:bg-dark-600" title="Italic">
                          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16" />
                          </svg>
                        </button>
                        <button type="button" class="p-1 rounded hover:bg-dark-200 dark:hover:bg-dark-600" title="Link">
                          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.172 13.828a4 4 0 005.656 0l4-4a4 4 0 10-5.656-5.656l-1.102 1.101" />
                          </svg>
                        </button>
                        <button type="button" class="p-1 rounded hover:bg-dark-200 dark:hover:bg-dark-600" title="Image">
                          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                          </svg>
                        </button>
                      </div>
                      <textarea id="campaign-message" rows="10" class="w-full p-3 bg-white dark:bg-dark-800 border-0 focus:ring-0" required></textarea>
                    </div>
                  </div>

                  <div>
                    <label for="campaign-recipients" class="block text-sm font-medium text-dark-700 dark:text-dark-300 mb-1">Recipients</label>
                    <select id="campaign-recipients" class="w-full p-2 bg-dark-100/50 dark:bg-dark-700/50 border-0 rounded-lg focus:ring-2 focus:ring-primary" multiple>
                      <option value="all">All Contacts</option>
                      <option value="stores">Music Stores</option>
                      <option value="artists">Artists</option>
                      <option value="suppliers">Suppliers</option>
                      <option value="custom">Custom List</option>
                    </select>
                    <p class="text-xs text-dark-500 dark:text-dark-400 mt-1">Hold Ctrl/Cmd to select multiple groups</p>
                  </div>

                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                      <label for="campaign-schedule" class="block text-sm font-medium text-dark-700 dark:text-dark-300 mb-1">Schedule</label>
                      <select id="campaign-schedule-type" class="w-full p-2 bg-dark-100/50 dark:bg-dark-700/50 border-0 rounded-lg focus:ring-2 focus:ring-primary">
                        <option value="now">Send Immediately</option>
                        <option value="scheduled">Schedule for Later</option>
                      </select>
                    </div>

                    <div id="schedule-date-container" class="hidden">
                      <label for="campaign-schedule-date" class="block text-sm font-medium text-dark-700 dark:text-dark-300 mb-1">Date &amp; Time</label>
                      <input type="datetime-local" id="campaign-schedule-date" class="w-full p-2 bg-dark-100/50 dark:bg-dark-700/50 border-0 rounded-lg focus:ring-2 focus:ring-primary">
                    </div>
                  </div>
                </form>
              </div>

              <div class="p-4 flex justify-end gap-3 border-t border-dark-100/50 dark:border-dark-700/50">
                <button type="button" id="save-campaign-draft" class="px-4 py-2 text-dark-700 dark:text-dark-300 bg-dark-100 dark:bg-dark-700 hover:bg-dark-200 dark:hover:bg-dark-600 rounded-lg transition-colors">
                  Save as Draft
                </button>
                <button type="button" id="save-campaign" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-600 transition-colors">
                  Save Campaign
                </button>
              </div>
            </div>
          </div>

          <!-- Campaign Preview Modal -->
          <div id="campaign-preview-modal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center overflow-y-auto">
            <div class="bg-white dark:bg-dark-800 rounded-2xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto m-4">
              <div class="flex justify-between items-center p-4 border-b border-dark-100/50 dark:border-dark-700/50">
                <h3 class="text-lg font-display font-bold text-dark-900 dark:text-white" id="preview-campaign-title">Campaign Preview</h3>
                <button type="button" id="close-preview-modal" class="p-2 text-dark-500 hover:bg-dark-100 dark:hover:bg-dark-700/50 rounded-lg" aria-label="Close preview">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                  </svg>
                </button>
              </div>

              <div class="p-4">
                <div class="bg-white rounded-lg shadow-md p-6 max-w-2xl mx-auto">
                  <div class="border-b pb-4 mb-4">
                    <div class="text-sm text-dark-500 mb-1">From: Leonard Lee &lt;leonard@leemusicdistribution.com&gt;</div>
                    <div class="text-sm text-dark-500 mb-1">To: <span id="preview-recipients">Music Store Contacts</span></div>
                    <div class="text-lg font-medium text-dark-900" id="preview-subject">Campaign Subject Line</div>
                  </div>

                  <div id="campaign-preview-content" class="prose max-w-none">
                    <!-- Email content will be rendered here -->
                    <p>Email content will appear here...</p>
                  </div>
                </div>
              </div>

              <div class="p-4 flex justify-end gap-3 border-t border-dark-100/50 dark:border-dark-700/50">
                <button type="button" id="edit-preview-campaign" class="px-4 py-2 text-dark-700 dark:text-dark-300 bg-dark-100 dark:bg-dark-700 hover:bg-dark-200 dark:hover:bg-dark-600 rounded-lg transition-colors">
                  Edit Campaign
                </button>
                <button type="button" id="send-preview-campaign" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-600 transition-colors">
                  Send Campaign
                </button>
              </div>
            </div>
          </div>
        </section>

        <!-- Analytics Tab Content -->
        <section id="analytics-tab" class="hidden space-y-6">
          <div class="bg-white/90 dark:bg-dark-800/90 backdrop-blur-lg rounded-2xl shadow-lg p-6 border border-dark-100/50 dark:border-dark-700/50">
            <h2 class="text-xl font-display font-bold mb-4 text-dark-900 dark:text-white flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
              </svg>
              Performance Analytics
            </h2>

            <!-- Date Range Filter -->
            <div class="flex flex-wrap gap-3 mb-6">
              <div class="relative flex-grow max-w-md">
                <select id="analytics-period" class="w-full p-3 bg-dark-100/50 dark:bg-dark-700/50 border-0 rounded-xl focus:ring-2 focus:ring-primary text-dark-700 dark:text-dark-300" aria-label="Select time period">
                  <option value="7">Last 7 Days</option>
                  <option value="30" selected>Last 30 Days</option>
                  <option value="90">Last 90 Days</option>
                  <option value="180">Last 6 Months</option>
                  <option value="365">Last Year</option>
                  <option value="custom">Custom Range</option>
                </select>
              </div>

              <div id="custom-date-range" class="hidden flex-grow max-w-md flex gap-2">
                <input type="date" id="date-from" class="w-1/2 p-3 bg-dark-100/50 dark:bg-dark-700/50 border-0 rounded-xl focus:ring-2 focus:ring-primary" aria-label="From date">
                <input type="date" id="date-to" class="w-1/2 p-3 bg-dark-100/50 dark:bg-dark-700/50 border-0 rounded-xl focus:ring-2 focus:ring-primary" aria-label="To date">
              </div>

              <button type="button" id="update-analytics" class="px-5 py-3 bg-primary text-white rounded-xl hover:bg-primary-600 transition-colors">
                Update
              </button>
            </div>

            <!-- KPI Summary Cards -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
              <div class="bg-white dark:bg-dark-700 rounded-xl p-4 shadow-sm border border-dark-100/50 dark:border-dark-700/50">
                <div class="flex items-center justify-between">
                  <div>
                    <p class="text-dark-500 dark:text-dark-400 text-sm">Total Leads</p>
                    <h3 class="text-2xl font-display font-bold mt-1 text-dark-900 dark:text-white">247</h3>
                    <p class="text-green-500 text-xs flex items-center mt-1">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
                      </svg>
                      12% from last period
                    </p>
                  </div>
                  <div class="w-10 h-10 rounded-lg bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center text-blue-500">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                    </svg>
                  </div>
                </div>
              </div>

              <div class="bg-white dark:bg-dark-700 rounded-xl p-4 shadow-sm border border-dark-100/50 dark:border-dark-700/50">
                <div class="flex items-center justify-between">
                  <div>
                    <p class="text-dark-500 dark:text-dark-400 text-sm">Avg. Open Rate</p>
                    <h3 class="text-2xl font-display font-bold mt-1 text-dark-900 dark:text-white">68.5%</h3>
                    <p class="text-green-500 text-xs flex items-center mt-1">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
                      </svg>
                      5.2% from last period
                    </p>
                  </div>
                  <div class="w-10 h-10 rounded-lg bg-green-100 dark:bg-green-900/30 flex items-center justify-center text-green-500">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 19v-8.93a2 2 0 01.89-1.664l7-4.666a2 2 0 012.22 0l7 4.666A2 2 0 0121 10.07V19M3 19a2 2 0 002 2h14a2 2 0 002-2M3 19l6.75-4.5M21 19l-6.75-4.5M3 10l6.75 4.5M21 10l-6.75 4.5m0 0l-1.14.76a2 2 0 01-2.22 0l-1.14-.76" />
                    </svg>
                  </div>
                </div>
              </div>

              <div class="bg-white dark:bg-dark-700 rounded-xl p-4 shadow-sm border border-dark-100/50 dark:border-dark-700/50">
                <div class="flex items-center justify-between">
                  <div>
                    <p class="text-dark-500 dark:text-dark-400 text-sm">Avg. Click Rate</p>
                    <h3 class="text-2xl font-display font-bold mt-1 text-dark-900 dark:text-white">24.3%</h3>
                    <p class="text-red-500 text-xs flex items-center mt-1">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3" />
                      </svg>
                      2.1% from last period
                    </p>
                  </div>
                  <div class="w-10 h-10 rounded-lg bg-amber-100 dark:bg-amber-900/30 flex items-center justify-center text-amber-500">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5M7.188 2.239l.777 2.897M5.136 7.965l-2.898-.777M13.95 4.05l-2.122 2.122m-5.657 5.656l-2.12 2.122" />
                    </svg>
                  </div>
                </div>
              </div>

              <div class="bg-white dark:bg-dark-700 rounded-xl p-4 shadow-sm border border-dark-100/50 dark:border-dark-700/50">
                <div class="flex items-center justify-between">
                  <div>
                    <p class="text-dark-500 dark:text-dark-400 text-sm">Avg. Response Rate</p>
                    <h3 class="text-2xl font-display font-bold mt-1 text-dark-900 dark:text-white">12.1%</h3>
                    <p class="text-green-500 text-xs flex items-center mt-1">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
                      </svg>
                      3.7% from last period
                    </p>
                  </div>
                  <div class="w-10 h-10 rounded-lg bg-purple-100 dark:bg-purple-900/30 flex items-center justify-center text-purple-500">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
                    </svg>
                  </div>
                </div>
              </div>
            </div>

            <!-- Charts Section -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
              <!-- Campaign Performance Chart -->
              <div class="bg-white dark:bg-dark-700 rounded-xl p-4 shadow-sm border border-dark-100/50 dark:border-dark-700/50">
                <h3 class="text-lg font-display font-bold mb-4 text-dark-900 dark:text-white">Campaign Performance</h3>
                <div class="h-80">
                  <canvas id="campaign-performance-chart"></canvas>
                </div>
              </div>

              <!-- Engagement Metrics Chart -->
              <div class="bg-white dark:bg-dark-700 rounded-xl p-4 shadow-sm border border-dark-100/50 dark:border-dark-700/50">
                <h3 class="text-lg font-display font-bold mb-4 text-dark-900 dark:text-white">Engagement Metrics</h3>
                <div class="h-80">
                  <canvas id="engagement-metrics-chart"></canvas>
                </div>
              </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
              <!-- Geographic Distribution Chart -->
              <div class="bg-white dark:bg-dark-700 rounded-xl p-4 shadow-sm border border-dark-100/50 dark:border-dark-700/50">
                <h3 class="text-lg font-display font-bold mb-4 text-dark-900 dark:text-white">Geographic Distribution</h3>
                <div class="h-80">
                  <canvas id="geographic-distribution-chart"></canvas>
                </div>
              </div>

              <!-- Device Usage Chart -->
              <div class="bg-white dark:bg-dark-700 rounded-xl p-4 shadow-sm border border-dark-100/50 dark:border-dark-700/50">
                <h3 class="text-lg font-display font-bold mb-4 text-dark-900 dark:text-white">Device Usage</h3>
                <div class="h-80">
                  <canvas id="device-usage-chart"></canvas>
                </div>
              </div>
            </div>
          </div>

          <!-- Campaign Performance Table -->
          <div class="bg-white/90 dark:bg-dark-800/90 backdrop-blur-lg rounded-2xl shadow-lg p-6 border border-dark-100/50 dark:border-dark-700/50">
            <h2 class="text-xl font-display font-bold mb-4 text-dark-900 dark:text-white flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
              </svg>
              Campaign Performance Details
            </h2>

            <div class="overflow-x-auto">
              <table class="min-w-full divide-y divide-dark-200 dark:divide-dark-700">
                <thead>
                  <tr>
                    <th class="px-4 py-3 text-left text-xs font-medium text-dark-500 dark:text-dark-400 uppercase tracking-wider">Campaign</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-dark-500 dark:text-dark-400 uppercase tracking-wider">Sent Date</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-dark-500 dark:text-dark-400 uppercase tracking-wider">Recipients</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-dark-500 dark:text-dark-400 uppercase tracking-wider">Open Rate</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-dark-500 dark:text-dark-400 uppercase tracking-wider">Click Rate</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-dark-500 dark:text-dark-400 uppercase tracking-wider">Response Rate</th>
                  </tr>
                </thead>
                <tbody class="divide-y divide-dark-200 dark:divide-dark-700" id="campaign-performance-table">
                  <!-- Table rows will be populated via JavaScript -->
                  <tr>
                    <td colspan="6" class="px-4 py-4 text-center text-dark-500 dark:text-dark-400">
                      Loading campaign data...
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- Visits Tab Content -->
        <section id="visits-tab" class="hidden space-y-6">
          <div class="bg-white/90 dark:bg-dark-800/90 backdrop-blur-lg rounded-2xl shadow-lg p-6 border border-dark-100/50 dark:border-dark-700/50">
            <h2 class="text-xl font-display font-bold mb-4 text-dark-900 dark:text-white flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
              </svg>
              Store Visits
            </h2>

            <!-- Visit Actions -->
            <div class="flex flex-wrap gap-3 mb-6">
              <button type="button" id="schedule-visit-btn" class="gradient-btn px-5 py-3 text-white rounded-xl hover:shadow-lg focus:outline-none flex items-center space-x-2 transition-all duration-200">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                </svg>
                <span>Schedule Visit</span>
              </button>

              <div class="relative flex-grow">
                <input type="text" id="visit-search" placeholder="Search stores or visits..." class="w-full p-3 pl-10 bg-dark-100/50 dark:bg-dark-700/50 border-0 rounded-xl focus:ring-2 focus:ring-primary" aria-label="Search visits">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 absolute left-3 top-3.5 text-dark-400 dark:text-dark-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                </svg>
              </div>

              <select id="visit-filter" class="p-3 bg-dark-100/50 dark:bg-dark-700/50 border-0 rounded-xl focus:ring-2 focus:ring-primary text-dark-700 dark:text-dark-300" aria-label="Filter visits">
                <option value="all">All Visits</option>
                <option value="upcoming">Upcoming</option>
                <option value="completed">Completed</option>
                <option value="cancelled">Cancelled</option>
              </select>
            </div>

            <!-- Visit Stats -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
              <div class="bg-white dark:bg-dark-700 rounded-xl p-4 shadow-sm border border-dark-100/50 dark:border-dark-700/50">
                <div class="flex items-center justify-between">
                  <div>
                    <p class="text-dark-500 dark:text-dark-400 text-sm">Total Visits</p>
                    <h3 class="text-2xl font-display font-bold mt-1 text-dark-900 dark:text-white">78</h3>
                  </div>
                  <div class="w-10 h-10 rounded-lg bg-green-100 dark:bg-green-900/30 flex items-center justify-center text-green-500">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                  </div>
                </div>
              </div>

              <div class="bg-white dark:bg-dark-700 rounded-xl p-4 shadow-sm border border-dark-100/50 dark:border-dark-700/50">
                <div class="flex items-center justify-between">
                  <div>
                    <p class="text-dark-500 dark:text-dark-400 text-sm">Upcoming</p>
                    <h3 class="text-2xl font-display font-bold mt-1 text-dark-900 dark:text-white">12</h3>
                  </div>
                  <div class="w-10 h-10 rounded-lg bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center text-blue-500">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                  </div>
                </div>
              </div>

              <div class="bg-white dark:bg-dark-700 rounded-xl p-4 shadow-sm border border-dark-100/50 dark:border-dark-700/50">
                <div class="flex items-center justify-between">
                  <div>
                    <p class="text-dark-500 dark:text-dark-400 text-sm">Completed</p>
                    <h3 class="text-2xl font-display font-bold mt-1 text-dark-900 dark:text-white">62</h3>
                  </div>
                  <div class="w-10 h-10 rounded-lg bg-purple-100 dark:bg-purple-900/30 flex items-center justify-center text-purple-500">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                  </div>
                </div>
              </div>

              <div class="bg-white dark:bg-dark-700 rounded-xl p-4 shadow-sm border border-dark-100/50 dark:border-dark-700/50">
                <div class="flex items-center justify-between">
                  <div>
                    <p class="text-dark-500 dark:text-dark-400 text-sm">Cancelled</p>
                    <h3 class="text-2xl font-display font-bold mt-1 text-dark-900 dark:text-white">4</h3>
                  </div>
                  <div class="w-10 h-10 rounded-lg bg-red-100 dark:bg-red-900/30 flex items-center justify-center text-red-500">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                  </div>
                </div>
              </div>
            </div>

            <!-- Map View -->
            <div class="bg-white dark:bg-dark-700 rounded-xl p-4 shadow-sm border border-dark-100/50 dark:border-dark-700/50 mb-6">
              <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-display font-bold text-dark-900 dark:text-white">Store Locations</h3>
                <div class="flex gap-2">
                  <button type="button" id="view-list-btn" class="px-3 py-1.5 text-dark-700 dark:text-dark-300 bg-dark-100 dark:bg-dark-700 hover:bg-dark-200 dark:hover:bg-dark-600 rounded-lg transition-colors text-sm">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16" />
                    </svg>
                    List View
                  </button>
                  <button type="button" id="view-map-btn" class="px-3 py-1.5 gradient-btn text-white rounded-lg hover:shadow-md transition-all text-sm">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7" />
                    </svg>
                    Map View
                  </button>
                </div>
              </div>
              <div id="map-container" class="h-96 rounded-lg overflow-hidden">
                <!-- Map will be rendered here -->
              </div>
            </div>

            <!-- Visit List -->
            <div id="visit-list-container">
              <h3 class="text-lg font-display font-bold mb-4 text-dark-900 dark:text-white">Upcoming Visits</h3>
              <div id="visits-list" class="space-y-4">
                <!-- Loading placeholder -->
                <div class="animate-pulse space-y-4">
                  <div class="h-24 bg-dark-200/50 dark:bg-dark-600/50 rounded-xl"></div>
                  <div class="h-24 bg-dark-200/50 dark:bg-dark-600/50 rounded-xl"></div>
                  <div class="h-24 bg-dark-200/50 dark:bg-dark-600/50 rounded-xl"></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Visit Scheduling Modal -->
          <div id="visit-modal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center overflow-y-auto">
            <div class="bg-white dark:bg-dark-800 rounded-2xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto m-4">
              <div class="flex justify-between items-center p-4 border-b border-dark-100/50 dark:border-dark-700/50">
                <h3 class="text-lg font-display font-bold text-dark-900 dark:text-white" id="visit-modal-title">Schedule New Visit</h3>
                <button type="button" id="close-visit-modal" class="p-2 text-dark-500 hover:bg-dark-100 dark:hover:bg-dark-700/50 rounded-lg" aria-label="Close modal">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                  </svg>
                </button>
              </div>

              <div class="p-4">
                <form id="visit-form" class="space-y-4">
                  <div>
                    <label for="visit-store" class="block text-sm font-medium text-dark-700 dark:text-dark-300 mb-1">Store</label>
                    <select id="visit-store" class="w-full p-2 bg-dark-100/50 dark:bg-dark-700/50 border-0 rounded-lg focus:ring-2 focus:ring-primary" required>
                      <option value="">Select a store</option>
                      <option value="store_1">Milwaukee Music Store</option>
                      <option value="store_2">Guitar World</option>
                      <option value="store_3">Madison Music Center</option>
                      <option value="store_4">Chicago Instruments</option>
                      <option value="store_5">Harmony House</option>
                    </select>
                  </div>

                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                      <label for="visit-date" class="block text-sm font-medium text-dark-700 dark:text-dark-300 mb-1">Date</label>
                      <input type="date" id="visit-date" class="w-full p-2 bg-dark-100/50 dark:bg-dark-700/50 border-0 rounded-lg focus:ring-2 focus:ring-primary" required>
                    </div>

                    <div>
                      <label for="visit-time" class="block text-sm font-medium text-dark-700 dark:text-dark-300 mb-1">Time</label>
                      <input type="time" id="visit-time" class="w-full p-2 bg-dark-100/50 dark:bg-dark-700/50 border-0 rounded-lg focus:ring-2 focus:ring-primary" required>
                    </div>
                  </div>

                  <div>
                    <label for="visit-duration" class="block text-sm font-medium text-dark-700 dark:text-dark-300 mb-1">Duration (minutes)</label>
                    <input type="number" id="visit-duration" min="15" step="15" value="60" class="w-full p-2 bg-dark-100/50 dark:bg-dark-700/50 border-0 rounded-lg focus:ring-2 focus:ring-primary" required>
                  </div>

                  <div>
                    <label for="visit-contact" class="block text-sm font-medium text-dark-700 dark:text-dark-300 mb-1">Contact Person</label>
                    <input type="text" id="visit-contact" class="w-full p-2 bg-dark-100/50 dark:bg-dark-700/50 border-0 rounded-lg focus:ring-2 focus:ring-primary">
                  </div>

                  <div>
                    <label for="visit-purpose" class="block text-sm font-medium text-dark-700 dark:text-dark-300 mb-1">Purpose of Visit</label>
                    <select id="visit-purpose" class="w-full p-2 bg-dark-100/50 dark:bg-dark-700/50 border-0 rounded-lg focus:ring-2 focus:ring-primary" required>
                      <option value="sales">Sales Presentation</option>
                      <option value="follow-up">Follow-up Meeting</option>
                      <option value="product-demo">Product Demonstration</option>
                      <option value="maintenance">Maintenance</option>
                      <option value="training">Training</option>
                      <option value="other">Other</option>
                    </select>
                  </div>

                  <div>
                    <label for="visit-notes" class="block text-sm font-medium text-dark-700 dark:text-dark-300 mb-1">Notes</label>
                    <textarea id="visit-notes" rows="3" class="w-full p-2 bg-dark-100/50 dark:bg-dark-700/50 border-0 rounded-lg focus:ring-2 focus:ring-primary"></textarea>
                  </div>
                </form>
              </div>

              <div class="p-4 flex justify-end gap-3 border-t border-dark-100/50 dark:border-dark-700/50">
                <button type="button" id="cancel-visit" class="px-4 py-2 text-dark-700 dark:text-dark-300 bg-dark-100 dark:bg-dark-700 hover:bg-dark-200 dark:hover:bg-dark-600 rounded-lg transition-colors">
                  Cancel
                </button>
                <button type="button" id="save-visit" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-600 transition-colors">
                  Schedule Visit
                </button>
              </div>
            </div>
          </div>

          <!-- Visit Details Modal -->
          <div id="visit-details-modal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center overflow-y-auto">
            <div class="bg-white dark:bg-dark-800 rounded-2xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto m-4">
              <div class="flex justify-between items-center p-4 border-b border-dark-100/50 dark:border-dark-700/50">
                <h3 class="text-lg font-display font-bold text-dark-900 dark:text-white" id="visit-details-title">Visit Details</h3>
                <button type="button" id="close-visit-details" class="p-2 text-dark-500 hover:bg-dark-100 dark:hover:bg-dark-700/50 rounded-lg" aria-label="Close details">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                  </svg>
                </button>
              </div>

              <div class="p-4">
                <div class="mb-6">
                  <div id="visit-details-status" class="inline-block px-2 py-1 text-xs rounded mb-2">Status</div>
                  <h4 id="visit-details-store" class="text-xl font-display font-bold text-dark-900 dark:text-white mb-1">Store Name</h4>
                  <p id="visit-details-address" class="text-dark-600 dark:text-dark-400 text-sm mb-4">Address</p>

                  <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                      <p class="text-dark-500 dark:text-dark-400 text-xs">Date & Time</p>
                      <p id="visit-details-datetime" class="text-dark-700 dark:text-dark-300">Date and time</p>
                    </div>
                    <div>
                      <p class="text-dark-500 dark:text-dark-400 text-xs">Duration</p>
                      <p id="visit-details-duration" class="text-dark-700 dark:text-dark-300">Duration</p>
                    </div>
                    <div>
                      <p class="text-dark-500 dark:text-dark-400 text-xs">Contact Person</p>
                      <p id="visit-details-contact" class="text-dark-700 dark:text-dark-300">Contact</p>
                    </div>
                    <div>
                      <p class="text-dark-500 dark:text-dark-400 text-xs">Purpose</p>
                      <p id="visit-details-purpose" class="text-dark-700 dark:text-dark-300">Purpose</p>
                    </div>
                  </div>

                  <div class="mb-4">
                    <p class="text-dark-500 dark:text-dark-400 text-xs mb-1">Notes</p>
                    <div id="visit-details-notes" class="text-dark-700 dark:text-dark-300 bg-dark-50/50 dark:bg-dark-700/50 p-3 rounded-lg">Notes</div>
                  </div>

                  <div>
                    <p class="text-dark-500 dark:text-dark-400 text-xs mb-1">Location</p>
                    <div id="visit-details-map" class="h-48 rounded-lg overflow-hidden bg-dark-100/50 dark:bg-dark-700/50">
                      <!-- Small map will be rendered here -->
                    </div>
                  </div>
                </div>

                <div class="border-t border-dark-100/50 dark:border-dark-700/50 pt-4">
                  <h4 class="text-lg font-display font-bold text-dark-900 dark:text-white mb-3">Visit Outcome</h4>

                  <div id="visit-outcome-form" class="space-y-4">
                    <div>
                      <label for="visit-outcome-status" class="block text-sm font-medium text-dark-700 dark:text-dark-300 mb-1">Status</label>
                      <select id="visit-outcome-status" class="w-full p-2 bg-dark-100/50 dark:bg-dark-700/50 border-0 rounded-lg focus:ring-2 focus:ring-primary">
                        <option value="scheduled">Scheduled</option>
                        <option value="completed">Completed</option>
                        <option value="cancelled">Cancelled</option>
                        <option value="rescheduled">Rescheduled</option>
                      </select>
                    </div>

                    <div>
                      <label for="visit-outcome-notes" class="block text-sm font-medium text-dark-700 dark:text-dark-300 mb-1">Outcome Notes</label>
                      <textarea id="visit-outcome-notes" rows="3" class="w-full p-2 bg-dark-100/50 dark:bg-dark-700/50 border-0 rounded-lg focus:ring-2 focus:ring-primary" placeholder="Enter notes about the visit outcome..."></textarea>
                    </div>

                    <div>
                      <label for="visit-follow-up" class="block text-sm font-medium text-dark-700 dark:text-dark-300 mb-1">Follow-up Required?</label>
                      <div class="flex items-center gap-4">
                        <label class="inline-flex items-center">
                          <input type="radio" name="follow-up" value="yes" class="text-primary focus:ring-primary">
                          <span class="ml-2 text-dark-700 dark:text-dark-300">Yes</span>
                        </label>
                        <label class="inline-flex items-center">
                          <input type="radio" name="follow-up" value="no" class="text-primary focus:ring-primary" checked>
                          <span class="ml-2 text-dark-700 dark:text-dark-300">No</span>
                        </label>
                      </div>
                    </div>

                    <div id="follow-up-date-container" class="hidden">
                      <label for="visit-follow-up-date" class="block text-sm font-medium text-dark-700 dark:text-dark-300 mb-1">Follow-up Date</label>
                      <input type="date" id="visit-follow-up-date" class="w-full p-2 bg-dark-100/50 dark:bg-dark-700/50 border-0 rounded-lg focus:ring-2 focus:ring-primary">
                    </div>
                  </div>
                </div>
              </div>

              <div class="p-4 flex justify-between gap-3 border-t border-dark-100/50 dark:border-dark-700/50">
                <div>
                  <button type="button" id="delete-visit" class="px-4 py-2 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors">
                    Delete Visit
                  </button>
                </div>
                <div class="flex gap-3">
                  <button type="button" id="get-directions" class="px-4 py-2 text-dark-700 dark:text-dark-300 bg-dark-100 dark:bg-dark-700 hover:bg-dark-200 dark:hover:bg-dark-600 rounded-lg transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7" />
                    </svg>
                    Get Directions
                  </button>
                  <button type="button" id="save-visit-outcome" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-600 transition-colors">
                    Save Changes
                  </button>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Other Tab Contents will follow the same visual pattern (hidden) -->
        <!-- We're only including one tab fully to keep the code compact -->

        <!-- AI Assistant Panel - Fixed in bottom right -->
        <div class="agent-panel bg-white/90 dark:bg-dark-800/90 backdrop-blur-lg rounded-2xl shadow-lg border border-dark-100/50 dark:border-dark-700/50 overflow-hidden">
          <div class="p-4 border-b border-dark-200/30 dark:border-dark-700/30 flex items-center justify-between">
            <div class="flex items-center">
              <div class="w-10 h-10 rounded-full bg-gradient-to-r from-primary to-secondary flex items-center justify-center text-white shadow-md mr-3">
                ðŸ§ 
              </div>
              <div>
                <h3 class="font-display font-bold text-dark-900 dark:text-white">Agent Lee</h3>
                <p class="text-xs text-dark-500 dark:text-dark-400">Virtual Assistant</p>
              </div>
            </div>
            <div class="flex items-center space-x-2">
              <button type="button" id="minimize-agent" class="p-2 text-dark-500 dark:text-dark-400 hover:bg-dark-100 dark:hover:bg-dark-700/50 rounded-lg">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
              </button>
              <button type="button" id="close-agent" class="p-2 text-dark-500 dark:text-dark-400 hover:bg-dark-100 dark:hover:bg-dark-700/50 rounded-lg">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
              </button>
            </div>
          </div>

          <div class="p-4 h-80 overflow-y-auto" id="agent-chat">
            <div class="flex items-start mb-4">
              <div class="w-8 h-8 rounded-full bg-gradient-to-r from-primary to-secondary flex-shrink-0 flex items-center justify-center text-white shadow-sm mr-2">
                ðŸ§ 
              </div>
              <div class="bg-dark-100/70 dark:bg-dark-700/70 rounded-2xl rounded-tl-none p-3 max-w-[85%]">
                <p class="text-dark-900 dark:text-white text-sm">Hello! I'm Agent Lee, your AI assistant. How can I help you today? You can ask me to find leads, create campaigns, or help with any other tasks.</p>
              </div>
            </div>
          </div>

          <div class="p-4 border-t border-dark-200/30 dark:border-dark-700/30">
            <div class="relative">
              <input type="text" id="agent-input" placeholder="Type a message..." class="w-full p-3 pr-12 bg-dark-100/50 dark:bg-dark-700/50 border-0 rounded-xl focus:ring-2 focus:ring-primary" aria-label="Message Agent Lee">
              <button type="button" id="send-message" class="absolute right-2 top-2 p-2 text-primary rounded-lg hover:bg-dark-100 dark:hover:bg-dark-700/50">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5l7 7-7 7M5 5l7 7-7 7" />
                </svg>
              </button>
            </div>
            <div class="flex justify-between mt-3">
              <div class="flex items-center space-x-2 text-xs text-dark-500 dark:text-dark-400">
                <button type="button" class="p-1.5 hover:bg-dark-100 dark:hover:bg-dark-700/50 rounded-lg flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />
                  </svg>
                  Voice
                </button>
                <button type="button" class="p-1.5 hover:bg-dark-100 dark:hover:bg-dark-700/50 rounded-lg flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                  </svg>
                  Commands
                </button>
              </div>
              <span class="text-xs text-dark-500 dark:text-dark-400">Powered by AI</span>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- File Browser Script -->
  <script>
    // File data for the file browser
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize file browser when that tab is clicked
      document.querySelectorAll('[data-tab="file-browser"]').forEach(tab => {
        tab.addEventListener('click', initializeFileBrowser);
      });

      // Close preview modal handlers
      document.getElementById('close-preview').addEventListener('click', closePreviewModal);
      document.getElementById('close-preview-btn').addEventListener('click', closePreviewModal);

      // Search functionality for file browser
      document.getElementById('file-search').addEventListener('input', function(e) {
        filterFiles(e.target.value);
      });

      // Filter by file type
      document.getElementById('file-filter').addEventListener('change', function(e) {
        filterFilesByType(e.target.value);
      });

      // Category buttons
      document.querySelectorAll('.file-category-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          document.querySelectorAll('.file-category-btn').forEach(b => {
            b.classList.remove('bg-primary', 'text-white');
            b.classList.add('bg-white', 'dark:bg-dark-700', 'text-dark-700', 'dark:text-dark-300');
          });
          this.classList.remove('bg-white', 'dark:bg-dark-700', 'text-dark-700', 'dark:text-dark-300');
          this.classList.add('bg-primary', 'text-white');
          filterFilesByCategory(this.dataset.category);
        });
      });
    });

    // Initialize the file browser
    function initializeFileBrowser() {
      const fileList = document.getElementById('file-list');
      if (!fileList) return;

      // Clear any existing content
      fileList.innerHTML = '';

      // Define file data from the project
      const files = [
        // HTML files
        { name: "index.html", type: "html", category: "html", size: "92 KB" },
        { name: "AgentLeeCard.html", type: "html", category: "html", size: "11 KB" },
        { name: "3vbc1ug9ib.html", type: "html", category: "html", size: "1 KB" },
        { name: "4njqof8sac.html", type: "html", category: "html", size: "7 KB" },
        { name: "du5a0x225p.html", type: "html", category: "html", size: "1 KB" },
        { name: "ka0635f7b8.html", type: "html", category: "html", size: "2 KB" },
        { name: "q7vpglh4fe.html", type: "html", category: "html", size: "1 KB" },
        { name: "v6khtqiym8.html", type: "html", category: "html", size: "1 KB" },
        { name: "lzjlad8ft6.html", type: "html", category: "html", size: "1 KB" },
        { name: "dot90ev7wr.html", type: "html", category: "html", size: "7 KB" },
        { name: "s0561yfcjv.html", type: "html", category: "html", size: "2 KB" },
        { name: "7g7z2fsdp3.html", type: "html", category: "html", size: "1 KB" },
        { name: "0cgjiz0xi1.html", type: "html", category: "html", size: "1 KB" },
        { name: "2ewv42c2t8.html", type: "html", category: "html", size: "1 KB" },

        // JavaScript files
        { name: "complete_music_store_list.js", type: "js", category: "js", size: "5 KB" },
        { name: "config.js", type: "js", category: "js", size: "7 KB" },
        { name: "configExample.js", type: "js", category: "js", size: "1 KB" },
        { name: "configLoader.js", type: "js", category: "js", size: "2 KB" },
        { name: "gh.js", type: "js", category: "js", size: "61 KB" },
        { name: "service-worker.js", type: "js", category: "js", size: "2 KB" },
        { name: "l1ttpambe2.js", type: "js", category: "js", size: "7 KB" },
        { name: "qlgm73cyjz.js", type: "js", category: "js", size: "1 KB" },
        { name: "kxtf77li8h.js", type: "js", category: "js", size: "2 KB" },
        { name: "pzgx9k17y2.js", type: "js", category: "js", size: "2 KB" },
        { name: "x8tbppozh8.js", type: "js", category: "js", size: "61 KB" },

        // CSS files
        { name: "styles.css", type: "css", category: "css", size: "6 KB" },
        { name: "nwwuny6v6u.css", type: "css", category: "css", size: "2 KB" },

        // Images
        { name: "4uu4f0ws4a.png", type: "png", category: "images", size: "379 KB" },
        { name: "cfm7v8uerr.png", type: "png", category: "images", size: "2.3 MB" },
        { name: "digitalcard.png", type: "png", category: "images", size: "249 B" },
        { name: "glvem36f3u.png", type: "png", category: "images", size: "249 B" },
        { name: "qr_rapidwebdevelopbusinesscard.png", type: "png", category: "images", size: "851 B" },
        { name: "rapidwebdevelop_qr.png", type: "png", category: "images", size: "2.2 MB" },
        { name: "screenshot_c6ad.png", type: "png", category: "images", size: "190 KB" },
        { name: "bp0pz53y07.png", type: "png", category: "images", size: "851 B" },

        // Other files
        { name: "add1.mp4", type: "mp4", category: "other", size: "3.3 MB" },
        { name: "add2.mp4", type: "mp4", category: "other", size: "1.7 MB" },
        { name: "complete_music_store_list.txt", type: "txt", category: "other", size: "55 KB" },
        { name: "favicon.ico", type: "ico", category: "other", size: "2 KB" },
        { name: "index.html.backup", type: "backup", category: "other", size: "330 KB" }
      ];

      // Sort files by name
      files.sort((a, b) => a.name.localeCompare(b.name));

      // Build file list
      files.forEach(file => {
        const fileRow = document.createElement('div');
        fileRow.className = 'grid grid-cols-12 p-3 border-b border-dark-100/30 dark:border-dark-700/30 hover:bg-dark-50/70 dark:hover:bg-dark-700/50 text-sm file-item';
        fileRow.dataset.filename = file.name;
        fileRow.dataset.filetype = file.type;
        fileRow.dataset.category = file.category;

        // Choose icon based on file type
        let fileIcon = '';
        switch(file.type) {
          case 'html':
            fileIcon = '<svg class="h-5 w-5 text-orange-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M12.316 3.051a1 1 0 01.633 1.265l-4 12a1 1 0 11-1.898-.632l4-12a1 1 0 011.265-.633zM5.707 6.293a1 1 0 010 1.414L3.414 10l2.293 2.293a1 1 0 11-1.414 1.414l-3-3a1 1 0 010-1.414l3-3a1 1 0 011.414 0zm8.586 0a1 1 0 011.414 0l3 3a1 1 0 010 1.414l-3 3a1 1 0 11-1.414-1.414L16.586 10l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>';
            break;
          case 'js':
            fileIcon = '<svg class="h-5 w-5 text-yellow-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 2a8 8 0 100 16 8 8 0 000-16zm0 2a6 6 0 00-4.393 10.072c.117-.171.3-.273.5-.273h1.393v-.639c0-.33.27-.6.6-.6h.904c.33 0 .6.27.6.6V15h5c.292 0 .521-.21.572-.498A6 6 0 0010 4z" clip-rule="evenodd"></path></svg>';
            break;
          case 'css':
            fileIcon = '<svg class="h-5 w-5 text-blue-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M12.316 3.051a1 1 0 01.633 1.265l-4 12a1 1 0 11-1.898-.632l4-12a1 1 0 011.265-.633zM6.707 6.293a1 1 0 010 1.414L3.414 10l3.293 3.293a1 1 0 11-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0zm6.586 0a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 11-1.414-1.414L16.586 10l-3.293-3.293a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>';
            break;
          case 'png':
          case 'jpg':
          case 'jpeg':
          case 'gif':
            fileIcon = '<svg class="h-5 w-5 text-green-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd"></path></svg>';
            break;
          default:
            fileIcon = '<svg class="h-5 w-5 text-gray-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z" clip-rule="evenodd"></path></svg>';
        }

        fileRow.innerHTML = `
          <div class="col-span-6 flex items-center gap-2">
            ${fileIcon}
            <span class="truncate">${file.name}</span>
          </div>
          <div class="col-span-2 text-dark-500 dark:text-dark-400">${file.type}</div>
          <div class="col-span-2 text-dark-500 dark:text-dark-400">${file.size}</div>
          <div class="col-span-2 flex gap-2 justify-end">
            <button class="p-1.5 hover:bg-dark-100 dark:hover:bg-dark-600 rounded-lg text-primary transition-colors" onclick="previewFile('${file.name}', '${file.type}')">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
              </svg>
            </button>
          </div>
        `;

        fileList.appendChild(fileRow);
      });
    }

    // Filter files by search term
    function filterFiles(searchTerm) {
      searchTerm = searchTerm.toLowerCase();
      document.querySelectorAll('.file-item').forEach(item => {
        const fileName = item.dataset.filename.toLowerCase();
        if (fileName.includes(searchTerm)) {
          item.classList.remove('hidden');
        } else {
          item.classList.add('hidden');
        }
      });
    }

    // Filter files by type
    function filterFilesByType(fileType) {
      document.querySelectorAll('.file-item').forEach(item => {
        if (fileType === 'all' || item.dataset.filetype === fileType) {
          item.classList.remove('hidden');
        } else {
          item.classList.add('hidden');
        }
      });
    }

    // Filter files by category
    function filterFilesByCategory(category) {
      document.querySelectorAll('.file-item').forEach(item => {
        if (category === 'all' || item.dataset.category === category) {
          item.classList.remove('hidden');
        } else {
          item.classList.add('hidden');
        }
      });
    }

    // Preview file
    function previewFile(fileName, fileType) {
      const previewModal = document.getElementById('file-preview-modal');
      const previewContent = document.getElementById('preview-content');
      const previewFileName = document.getElementById('preview-file-name');

      previewFileName.textContent = fileName;

      // Display different preview based on file type
      if (['jpg', 'jpeg', 'png', 'gif'].includes(fileType)) {
        // Image preview
        previewContent.innerHTML = `<img src="${fileName}" alt="${fileName}" class="max-w-full max-h-[60vh] mx-auto">`;
      } else if (fileType === 'mp4') {
        // Video preview
        previewContent.innerHTML = `
          <video controls class="max-w-full max-h-[60vh] mx-auto">
            <source src="${fileName}" type="video/mp4">
            Your browser does not support the video tag.
          </video>
        `;
      } else {
        // Text file preview - for simplicity, just show a message
        previewContent.innerHTML = `
          <div class="bg-dark-50/50 dark:bg-dark-700/50 p-4 rounded-lg">
            <p class="text-center text-dark-600 dark:text-dark-400">
              Preview for ${fileName} would be displayed here.
              <br><br>
              In a full implementation, the content would be fetched and displayed appropriately.
            </p>
          </div>
        `;
      }

      // Show the modal
      previewModal.classList.remove('hidden');
    }

    // Close preview modal
    function closePreviewModal() {
      document.getElementById('file-preview-modal').classList.add('hidden');
    }
  </script>

  <!-- Store markers and analytics handling -->
  <script>
    // Function to add markers for all stores
    function addAllStoreMarkers() {
      if (!window.map || !window.google) {
        console.error("Map not initialized, cannot add store markers");
        return;
      }

      // Clear any existing markers
      if (window.storeMarkers) {
        window.storeMarkers.forEach(marker => marker.setMap(null));
      }
      window.storeMarkers = [];

      // Get the stores to display - use combined stores if available, otherwise fallback
      const storesToDisplay = window.allStores || window.musicStores || [];

      if (storesToDisplay.length === 0) {
        console.warn("No store data available to display markers");
        return;
      }

      console.log(`Adding ${storesToDisplay.length} store markers to the map`);

      // Create info window for marker details
      const infoWindow = new google.maps.InfoWindow();

      // Add markers for each store
      storesToDisplay.forEach((store, index) => {
        // Skip if lat/lng is missing
        if (!store.lat || !store.lng) {
          console.warn(`Store ${store.name} missing coordinates, skipping marker`);
          return;
        }

        // Create marker for this store
        const marker = new google.maps.Marker({
          position: { lat: store.lat, lng: store.lng },
          map: window.map,
          title: store.name,
          icon: store.estimatedCoordinates ?
            { url: 'http://maps.google.com/mapfiles/ms/icons/blue-dot.png' } :
            { url: 'http://maps.google.com/mapfiles/ms/icons/red-dot.png' },
          animation: google.maps.Animation.DROP,
          storeId: index
        });

        // Store content for info window
        const contentString = `
          <div class="p-4 max-w-xs">
            <h2 class="text-lg font-semibold mb-1">${store.name}</h2>
            <p class="text-sm text-gray-600 mb-2">${store.address}, ${store.city}, ${store.state} ${store.zip}</p>
            <p class="text-sm mb-2"><strong>Phone:</strong> ${store.phone}</p>
            ${store.website ? `<p class="text-sm mb-2"><strong>Website:</strong> <a href="https://${store.website}" target="_blank" class="text-blue-600 hover:underline">${store.website}</a></p>` : ''}
            ${store.email ? `<p class="text-sm mb-2"><strong>Email:</strong> <a href="mailto:${store.email}" class="text-blue-600 hover:underline">${store.email}</a></p>` : ''}
            <p class="text-sm"><strong>Type:</strong> ${store.tags.join(', ')}</p>
            ${store.estimatedCoordinates ? '<p class="text-xs text-orange-500 mt-2">* Location is approximate</p>' : ''}
          </div>
        `;

        // Add click event to show info window
        marker.addListener("click", () => {
          infoWindow.setContent(contentString);
          infoWindow.open(map, marker);

          // Update nearby list with active store
          updateNearbyListWithActiveStore(index);
        });

        // Save reference to marker
        window.storeMarkers.push(marker);
      });

      // Update the nearby list with all stores
      updateNearbyList(storesToDisplay);
    }

    // Function to update nearby list display
    function updateNearbyList(stores) {
      const nearbyList = document.getElementById('nearby-list');
      if (!nearbyList) {
        console.warn("Nearby list element not found");
        return;
      }

      // Clear loading animation
      nearbyList.innerHTML = '';

      // Sort stores by distance or name
      const sortedStores = [...stores];

      // Display up to 20 stores in the list
      const storesToShow = sortedStores.slice(0, 20);

      if (storesToShow.length === 0) {
        nearbyList.innerHTML = `
          <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded-lg shadow">
            <div class="flex">
              <div class="flex-shrink-0">
                <svg class="h-5 w-5 text-yellow-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                </svg>
              </div>
              <div class="ml-3">
                <p class="text-sm text-yellow-700">
                  No stores found in the current view.
                </p>
              </div>
            </div>
          </div>
        `;
        return;
      }

      // Add each store to the list
      storesToShow.forEach((store, index) => {
        const storeElement = document.createElement('div');
        storeElement.className = 'bg-white dark:bg-dark-800/70 rounded-xl p-4 shadow-sm hover:shadow-md transition-all duration-200 cursor-pointer';
        storeElement.dataset.storeId = index;

        storeElement.innerHTML = `
          <div class="flex justify-between items-start">
            <div>
              <h3 class="font-medium text-dark-900 dark:text-white">${store.name}</h3>
              <p class="text-sm text-dark-500 dark:text-dark-400">${store.city}, ${store.state}</p>
            </div>
            <span class="px-2 py-1 rounded text-xs ${store.estimatedCoordinates ? 'bg-amber-100 dark:bg-amber-900/30 text-amber-800 dark:text-amber-200' : 'bg-primary-100 dark:bg-primary-900/30 text-primary-800 dark:text-primary-200'}">
              ${store.tags[0]}
            </span>
          </div>
          <div class="mt-2 flex justify-between text-xs text-dark-500 dark:text-dark-400">
            <span>${store.phone}</span>
            <span class="flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
              </svg>
              ${store.estimatedCoordinates ? 'Location approximate' : 'Verified location'}
            </span>
          </div>
        `;

        // Add click event to pan to marker on map
        storeElement.addEventListener('click', () => {
          const marker = window.storeMarkers[index];
          if (marker) {
            window.map.panTo(marker.getPosition());
            window.map.setZoom(14);
            google.maps.event.trigger(marker, 'click');
          }
        });

        nearbyList.appendChild(storeElement);
      });
    }

    // Function to highlight active store in nearby list
    function updateNearbyListWithActiveStore(storeId) {
      const listItems = document.querySelectorAll('#nearby-list > div');

      // Remove active class from all items
      listItems.forEach(item => {
        item.classList.remove('ring-2', 'ring-primary', 'dark:ring-primary-400');
      });

      // Add active class to selected item
      const activeItem = document.querySelector(`#nearby-list > div[data-store-id="${storeId}"]`);
      if (activeItem) {
        activeItem.classList.add('ring-2', 'ring-primary', 'dark:ring-primary-400');
        activeItem.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      }
    }

    // Initialize loading animation
    document.addEventListener('DOMContentLoaded', function() {
      setTimeout(function() {
        const loadingAnimation = document.querySelector('.loading-animation');
        loadingAnimation.classList.add('loading-hide');
      }, 1500);

      // Initialize voice dictation
      initializeVoiceDictation();

      // Initialize phone system
      initializePhoneSystem();

      // Initialize campaigns system
      initializeCampaignsSystem();

      // Initialize analytics system
      initializeAnalyticsSystem();

      // Initialize visits system
      initializeVisitsSystem();

      // Initialize dark mode toggle
      const themeToggleButtons = [document.getElementById('theme-toggle'), document.getElementById('mobile-theme-toggle')];

      themeToggleButtons.forEach(button => {
        if (button) {
          button.addEventListener('click', function() {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('darkMode', document.body.classList.contains('dark-mode') ? 'enabled' : 'disabled');
          });
        }
      });

    // Initialize Phone System
    function initializePhoneSystem() {
      // Get UI elements
      const phoneNumberDisplay = document.getElementById('phone-number-display');
      const dialerButtons = document.querySelectorAll('.dialer-btn');
      const clearButton = document.getElementById('clear-number');
      const callButton = document.getElementById('call-button');
      const hangupButton = document.getElementById('hangup-button');
      const callTimer = document.getElementById('call-timer');
      const callActions = document.getElementById('call-actions');
      const phoneStatus = document.getElementById('phone-status');

      // Contact modal elements
      const addContactButton = document.getElementById('add-contact');
      const addContactModal = document.getElementById('add-contact-modal');
      const closeContactModal = document.getElementById('close-contact-modal');
      const cancelAddContact = document.getElementById('cancel-add-contact');
      const saveContactButton = document.getElementById('save-contact');
      const contactSearchInput = document.getElementById('contact-search');

      // Transcription elements
      const startTranscriptionButton = document.getElementById('start-transcription');
      const stopTranscriptionButton = document.getElementById('stop-transcription');
      const transcriptionStatus = document.getElementById('transcription-status');
      const transcriptionResult = document.getElementById('transcription-result');
      const clearTranscriptionButton = document.getElementById('clear-transcription');
      const saveTranscriptionButton = document.getElementById('save-transcription');
      const createTaskButton = document.getElementById('create-task-from-transcription');

      // Current phone number being dialed
      let currentNumber = '';
      let callInProgress = false;
      let callTimerInterval = null;
      let callStartTime = null;
      let recognition = null;

      // Initialize contacts and call history
      loadContacts();
      loadCallHistory();

      // Add event listeners to dialer buttons
      dialerButtons.forEach(button => {
        button.addEventListener('click', function() {
          if (!callInProgress) {
            const digit = this.textContent;
            currentNumber += digit;
            updatePhoneDisplay();
          }
        });
      });

      // Clear button functionality
      if (clearButton) {
        clearButton.addEventListener('click', function() {
          if (!callInProgress) {
            if (currentNumber.length > 0) {
              currentNumber = currentNumber.slice(0, -1);
              updatePhoneDisplay();
            }
          }
        });

        // Add accessibility attributes
        clearButton.setAttribute('aria-label', 'Clear last digit');
        clearButton.setAttribute('title', 'Clear last digit');
      }

      // Call button functionality
      if (callButton) {
        callButton.addEventListener('click', function() {
          if (!callInProgress && currentNumber.length > 0) {
            startCall();
          }
        });

        // Add accessibility attributes
        callButton.setAttribute('aria-label', 'Make call');
        callButton.setAttribute('title', 'Make call');
      }

      // Hangup button functionality
      if (hangupButton) {
        hangupButton.addEventListener('click', function() {
          if (callInProgress) {
            endCall();
          }
        });

        // Add accessibility attributes
        hangupButton.setAttribute('aria-label', 'End call');
        hangupButton.setAttribute('title', 'End call');
      }

      // Contact modal functionality
      if (addContactButton && addContactModal) {
        addContactButton.addEventListener('click', function() {
          addContactModal.classList.remove('hidden');
        });

        // Add accessibility attributes
        addContactButton.setAttribute('aria-label', 'Add new contact');
        addContactButton.setAttribute('title', 'Add new contact');
      }

      if (closeContactModal) {
        closeContactModal.addEventListener('click', function() {
          addContactModal.classList.add('hidden');
        });

        // Add accessibility attributes
        closeContactModal.setAttribute('aria-label', 'Close modal');
        closeContactModal.setAttribute('title', 'Close modal');
      }

      if (cancelAddContact) {
        cancelAddContact.addEventListener('click', function() {
          addContactModal.classList.add('hidden');
        });
      }

      if (saveContactButton) {
        saveContactButton.addEventListener('click', function() {
          saveNewContact();
        });
      }

      // Contact search functionality
      if (contactSearchInput) {
        contactSearchInput.addEventListener('input', function() {
          filterContacts(this.value);
        });
      }

      // Call history filter functionality
      const callHistoryFilter = document.getElementById('call-history-filter');
      if (callHistoryFilter) {
        callHistoryFilter.addEventListener('change', function() {
          filterCallHistory(this.value);
        });

        // Add accessibility attributes
        callHistoryFilter.setAttribute('aria-label', 'Filter call history');
        callHistoryFilter.setAttribute('title', 'Filter call history');
      }

      // Transcription functionality
      if (startTranscriptionButton) {
        startTranscriptionButton.addEventListener('click', function() {
          startTranscription();
        });

        // Add accessibility attributes
        startTranscriptionButton.setAttribute('aria-label', 'Start voice recording');
        startTranscriptionButton.setAttribute('title', 'Start voice recording');
      }

      if (stopTranscriptionButton) {
        stopTranscriptionButton.addEventListener('click', function() {
          stopTranscription();
        });

        // Add accessibility attributes
        stopTranscriptionButton.setAttribute('aria-label', 'Stop voice recording');
        stopTranscriptionButton.setAttribute('title', 'Stop voice recording');
      }

      if (clearTranscriptionButton) {
        clearTranscriptionButton.addEventListener('click', function() {
          transcriptionResult.textContent = 'Transcription will appear here...';
        });
      }

      if (saveTranscriptionButton) {
        saveTranscriptionButton.addEventListener('click', function() {
          saveTranscriptionAsNote();
        });
      }

      if (createTaskButton) {
        createTaskButton.addEventListener('click', function() {
          createTaskFromTranscription();
        });
      }

      // Function to update the phone display
      function updatePhoneDisplay() {
        if (phoneNumberDisplay) {
          phoneNumberDisplay.textContent = formatPhoneNumber(currentNumber);
        }
      }

      // Format phone number for display
      function formatPhoneNumber(number) {
        if (number.length <= 3) {
          return number;
        } else if (number.length <= 7) {
          return number.slice(0, 3) + '-' + number.slice(3);
        } else {
          return number.slice(0, 3) + '-' + number.slice(3, 6) + '-' + number.slice(6, 10);
        }
      }

      // Start a call
      function startCall() {
        callInProgress = true;
        callStartTime = new Date();

        // Update UI
        callButton.classList.add('hidden');
        hangupButton.classList.remove('hidden');
        callTimer.classList.remove('hidden');
        callActions.classList.remove('hidden');
        phoneStatus.textContent = 'Call in progress';
        phoneStatus.classList.remove('text-green-500');
        phoneStatus.classList.add('text-amber-500');

        // Start call timer
        callTimerInterval = setInterval(updateCallTimer, 1000);

        // Log call to history
        logCall({
          number: currentNumber,
          type: 'outgoing',
          duration: 0,
          timestamp: new Date().toISOString(),
          contact: findContactByNumber(currentNumber)
        });
      }

      // End a call
      function endCall() {
        callInProgress = false;

        // Calculate call duration
        const callEndTime = new Date();
        const callDuration = Math.floor((callEndTime - callStartTime) / 1000);

        // Update UI
        hangupButton.classList.add('hidden');
        callButton.classList.remove('hidden');
        callTimer.classList.add('hidden');
        callActions.classList.add('hidden');
        phoneStatus.textContent = 'Ready';
        phoneStatus.classList.remove('text-amber-500');
        phoneStatus.classList.add('text-green-500');

        // Stop call timer
        clearInterval(callTimerInterval);

        // Update call history with duration
        updateCallDuration(currentNumber, callDuration);

        // Reset current number
        currentNumber = '';
        updatePhoneDisplay();
      }

      // Update call timer display
      function updateCallTimer() {
        if (!callStartTime) return;

        const now = new Date();
        const elapsedSeconds = Math.floor((now - callStartTime) / 1000);
        const minutes = Math.floor(elapsedSeconds / 60);
        const seconds = elapsedSeconds % 60;

        const timerDisplay = document.querySelector('#call-timer .text-xl');
        if (timerDisplay) {
          timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
      }

      // Load contacts from IndexedDB
      async function loadContacts() {
        try {
          const dbPromise = idbKeyval.createStore('agent-lee-crm', 'stores');
          let contacts = await idbKeyval.get('contacts', dbPromise) || [];

          // If no contacts exist, create some sample contacts
          if (contacts.length === 0) {
            contacts = [
              {
                id: 'contact_' + Date.now(),
                name: 'Leonard Lee',
                phone: '414-555-1234',
                email: 'leonard@example.com',
                company: 'Lee Music Distribution',
                notes: 'Owner of Lee Music Distribution'
              },
              {
                id: 'contact_' + (Date.now() + 1),
                name: 'Milwaukee Music Store',
                phone: '414-555-5678',
                email: 'info@milwaukeemusic.com',
                company: 'Milwaukee Music',
                notes: 'Main store in downtown Milwaukee'
              },
              {
                id: 'contact_' + (Date.now() + 2),
                name: 'Sarah Johnson',
                phone: '414-555-9012',
                email: 'sarah@guitarworld.com',
                company: 'Guitar World',
                notes: 'Purchasing manager'
              }
            ];

            // Save sample contacts to IndexedDB
            await idbKeyval.set('contacts', contacts, dbPromise);
          }

          // Display contacts
          displayContacts(contacts);
        } catch (error) {
          console.error('Error loading contacts:', error);
        }
      }

      // Display contacts in the UI
      function displayContacts(contacts) {
        const contactsList = document.getElementById('contacts-list');
        if (!contactsList) return;

        // Clear loading animation
        contactsList.innerHTML = '';

        if (contacts.length === 0) {
          contactsList.innerHTML = `
            <div class="text-center p-4 text-dark-500 dark:text-dark-400">
              No contacts found. Add a new contact to get started.
            </div>
          `;
          return;
        }

        // Sort contacts alphabetically by name
        contacts.sort((a, b) => a.name.localeCompare(b.name));

        // Add each contact to the list
        contacts.forEach(contact => {
          const contactElement = document.createElement('div');
          contactElement.className = 'bg-dark-50/50 dark:bg-dark-600/50 rounded-lg p-3 hover:bg-dark-100/50 dark:hover:bg-dark-500/50 transition-colors cursor-pointer';
          contactElement.dataset.contactId = contact.id;
          contactElement.dataset.contactPhone = contact.phone;

          contactElement.innerHTML = `
            <div class="flex justify-between items-center">
              <div>
                <div class="font-medium text-dark-900 dark:text-white">${contact.name}</div>
                <div class="text-sm text-dark-500 dark:text-dark-400">${contact.phone}</div>
              </div>
              <button type="button" class="call-contact-btn p-2 rounded-full bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 hover:bg-green-200 dark:hover:bg-green-800/30 transition-colors" aria-label="Call ${contact.name}" title="Call ${contact.name}">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                </svg>
              </button>
            </div>
          `;

          // Add click event to call the contact
          const callButton = contactElement.querySelector('.call-contact-btn');
          if (callButton) {
            callButton.addEventListener('click', function(e) {
              e.stopPropagation();
              dialContact(contact.phone);
            });
          }

          // Add click event to view contact details
          contactElement.addEventListener('click', function() {
            viewContactDetails(contact);
          });

          contactsList.appendChild(contactElement);
        });
      }

      // Filter contacts based on search input
      function filterContacts(searchTerm) {
        searchTerm = searchTerm.toLowerCase();

        const dbPromise = idbKeyval.createStore('agent-lee-crm', 'stores');
        idbKeyval.get('contacts', dbPromise).then(contacts => {
          if (!contacts) return;

          const filteredContacts = contacts.filter(contact =>
            contact.name.toLowerCase().includes(searchTerm) ||
            contact.phone.includes(searchTerm) ||
            (contact.email && contact.email.toLowerCase().includes(searchTerm)) ||
            (contact.company && contact.company.toLowerCase().includes(searchTerm))
          );

          displayContacts(filteredContacts);
        });
      }

      // Save a new contact
      async function saveNewContact() {
        const nameInput = document.getElementById('contact-name');
        const phoneInput = document.getElementById('contact-phone');
        const emailInput = document.getElementById('contact-email');
        const companyInput = document.getElementById('contact-company');
        const notesInput = document.getElementById('contact-notes');

        if (!nameInput || !phoneInput) return;

        const name = nameInput.value.trim();
        const phone = phoneInput.value.trim();

        if (!name || !phone) {
          alert('Name and phone number are required');
          return;
        }

        try {
          const dbPromise = idbKeyval.createStore('agent-lee-crm', 'stores');
          const contacts = await idbKeyval.get('contacts', dbPromise) || [];

          // Create new contact object
          const newContact = {
            id: 'contact_' + Date.now(),
            name: name,
            phone: phone,
            email: emailInput ? emailInput.value.trim() : '',
            company: companyInput ? companyInput.value.trim() : '',
            notes: notesInput ? notesInput.value.trim() : ''
          };

          // Add to contacts array
          contacts.push(newContact);

          // Save to IndexedDB
          await idbKeyval.set('contacts', contacts, dbPromise);

          // Update UI
          displayContacts(contacts);

          // Close modal and reset form
          const addContactModal = document.getElementById('add-contact-modal');
          if (addContactModal) {
            addContactModal.classList.add('hidden');
          }

          const addContactForm = document.getElementById('add-contact-form');
          if (addContactForm) {
            addContactForm.reset();
          }

          // Add to timeline
          addToTimeline({
            type: 'contact',
            title: 'New Contact Added',
            description: `Added ${name} to contacts`,
            date: 'today',
            time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}),
            subtype: 'Contact Management'
          });
        } catch (error) {
          console.error('Error saving contact:', error);
        }
      }

      // View contact details (placeholder for now)
      function viewContactDetails(contact) {
        // In a full implementation, this would open a modal with contact details
        console.log('Viewing contact details:', contact);
      }

      // Dial a contact's number
      function dialContact(phoneNumber) {
        if (callInProgress) return;

        currentNumber = phoneNumber.replace(/\D/g, ''); // Remove non-digits
        updatePhoneDisplay();
      }

      // Find a contact by phone number
      function findContactByNumber(phoneNumber) {
        // This would normally query IndexedDB, but for simplicity we'll return null
        return null;
      }

      // Load call history from IndexedDB
      async function loadCallHistory() {
        try {
          const dbPromise = idbKeyval.createStore('agent-lee-crm', 'stores');
          let callHistory = await idbKeyval.get('call-history', dbPromise) || [];

          // If no call history exists, create some sample calls
          if (callHistory.length === 0) {
            const now = new Date();

            callHistory = [
              {
                id: 'call_' + (Date.now() - 3600000),
                number: '414-555-1234',
                type: 'outgoing',
                duration: 125,
                timestamp: new Date(now.getTime() - 3600000).toISOString(),
                contact: 'Leonard Lee'
              },
              {
                id: 'call_' + (Date.now() - 7200000),
                number: '414-555-5678',
                type: 'incoming',
                duration: 67,
                timestamp: new Date(now.getTime() - 7200000).toISOString(),
                contact: 'Milwaukee Music Store'
              },
              {
                id: 'call_' + (Date.now() - 86400000),
                number: '414-555-9012',
                type: 'missed',
                duration: 0,
                timestamp: new Date(now.getTime() - 86400000).toISOString(),
                contact: 'Sarah Johnson'
              }
            ];

            // Save sample call history to IndexedDB
            await idbKeyval.set('call-history', callHistory, dbPromise);
          }

          // Display call history
          displayCallHistory(callHistory);
        } catch (error) {
          console.error('Error loading call history:', error);
        }
      }

      // Display call history in the UI
      function displayCallHistory(calls) {
        const callHistoryList = document.getElementById('call-history-list');
        if (!callHistoryList) return;

        // Clear loading animation
        callHistoryList.innerHTML = '';

        if (calls.length === 0) {
          callHistoryList.innerHTML = `
            <div class="text-center p-4 text-dark-500 dark:text-dark-400">
              No call history found.
            </div>
          `;
          return;
        }

        // Sort calls by timestamp (newest first)
        calls.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

        // Add each call to the list
        calls.forEach(call => {
          const callElement = document.createElement('div');

          // Set class based on call type
          let typeClass = '';
          let typeIcon = '';

          switch (call.type) {
            case 'incoming':
              typeClass = 'text-green-600 dark:text-green-400';
              typeIcon = `<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 17l-4 4m0 0l-4-4m4 4V3" />
              </svg>`;
              break;
            case 'outgoing':
              typeClass = 'text-blue-600 dark:text-blue-400';
              typeIcon = `<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7l4-4m0 0l4 4m-4-4v18" />
              </svg>`;
              break;
            case 'missed':
              typeClass = 'text-red-600 dark:text-red-400';
              typeIcon = `<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>`;
              break;
          }

          callElement.className = `bg-dark-50/50 dark:bg-dark-600/50 rounded-lg p-3 hover:bg-dark-100/50 dark:hover:bg-dark-500/50 transition-colors cursor-pointer`;
          callElement.dataset.callId = call.id;
          callElement.dataset.callType = call.type;

          // Format timestamp
          const callDate = new Date(call.timestamp);
          const today = new Date();
          let dateDisplay = '';

          if (callDate.toDateString() === today.toDateString()) {
            dateDisplay = 'Today';
          } else if (callDate.toDateString() === new Date(today.setDate(today.getDate() - 1)).toDateString()) {
            dateDisplay = 'Yesterday';
          } else {
            dateDisplay = callDate.toLocaleDateString();
          }

          // Format duration
          let durationDisplay = '';
          if (call.type === 'missed') {
            durationDisplay = 'Missed call';
          } else {
            const minutes = Math.floor(call.duration / 60);
            const seconds = call.duration % 60;
            durationDisplay = `${minutes}:${seconds.toString().padStart(2, '0')}`;
          }

          callElement.innerHTML = `
            <div class="flex justify-between items-center">
              <div>
                <div class="font-medium text-dark-900 dark:text-white">${call.contact || call.number}</div>
                <div class="flex items-center text-xs ${typeClass}">
                  ${typeIcon}
                  <span class="ml-1">${call.type.charAt(0).toUpperCase() + call.type.slice(1)}</span>
                </div>
              </div>
              <div class="text-right">
                <div class="text-xs text-dark-500 dark:text-dark-400">${dateDisplay}</div>
                <div class="text-xs text-dark-500 dark:text-dark-400">${durationDisplay}</div>
              </div>
            </div>
          `;

          // Add click event to call the number
          callElement.addEventListener('click', function() {
            dialContact(call.number);
          });

          callHistoryList.appendChild(callElement);
        });
      }

      // Filter call history based on type
      function filterCallHistory(filterType) {
        const dbPromise = idbKeyval.createStore('agent-lee-crm', 'stores');
        idbKeyval.get('call-history', dbPromise).then(calls => {
          if (!calls) return;

          if (filterType === 'all') {
            displayCallHistory(calls);
          } else {
            const filteredCalls = calls.filter(call => call.type === filterType);
            displayCallHistory(filteredCalls);
          }
        });
      }

      // Log a call to history
      async function logCall(call) {
        try {
          const dbPromise = idbKeyval.createStore('agent-lee-crm', 'stores');
          const callHistory = await idbKeyval.get('call-history', dbPromise) || [];

          // Add ID to call
          call.id = 'call_' + Date.now();

          // Add to call history array
          callHistory.push(call);

          // Save to IndexedDB
          await idbKeyval.set('call-history', callHistory, dbPromise);

          // Update UI
          displayCallHistory(callHistory);
        } catch (error) {
          console.error('Error logging call:', error);
        }
      }

      // Update call duration in history
      async function updateCallDuration(phoneNumber, duration) {
        try {
          const dbPromise = idbKeyval.createStore('agent-lee-crm', 'stores');
          const callHistory = await idbKeyval.get('call-history', dbPromise) || [];

          // Find the most recent call with this number
          const callIndex = callHistory.findIndex(call =>
            call.number === phoneNumber &&
            call.type === 'outgoing' &&
            call.duration === 0
          );

          if (callIndex !== -1) {
            callHistory[callIndex].duration = duration;

            // Save to IndexedDB
            await idbKeyval.set('call-history', callHistory, dbPromise);

            // Update UI
            displayCallHistory(callHistory);
          }
        } catch (error) {
          console.error('Error updating call duration:', error);
        }
      }

      // Start voice transcription
      function startTranscription() {
        if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
          transcriptionStatus.textContent = 'Speech recognition not supported in this browser';
          return;
        }

        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        recognition = new SpeechRecognition();

        recognition.continuous = true;
        recognition.interimResults = true;
        recognition.lang = 'en-US';

        recognition.onstart = function() {
          transcriptionStatus.textContent = 'Listening...';
          startTranscriptionButton.classList.add('hidden');
          stopTranscriptionButton.classList.remove('hidden');
          transcriptionResult.textContent = '';
        };

        recognition.onresult = function(event) {
          let interimTranscript = '';
          let finalTranscript = '';

          for (let i = event.resultIndex; i < event.results.length; i++) {
            const transcript = event.results[i][0].transcript;

            if (event.results[i].isFinal) {
              finalTranscript += transcript;
            } else {
              interimTranscript += transcript;
            }
          }

          transcriptionResult.textContent = finalTranscript || interimTranscript;
        };

        recognition.onerror = function(event) {
          console.error('Speech recognition error:', event.error);
          transcriptionStatus.textContent = 'Error: ' + event.error;
          stopTranscription();
        };

        recognition.onend = function() {
          stopTranscription();
        };

        recognition.start();
      }

      // Stop voice transcription
      function stopTranscription() {
        if (recognition) {
          recognition.stop();
          recognition = null;
        }

        transcriptionStatus.textContent = 'Click to start recording';
        stopTranscriptionButton.classList.add('hidden');
        startTranscriptionButton.classList.remove('hidden');
      }

      // Save transcription as a note
      function saveTranscriptionAsNote() {
        const transcriptionText = transcriptionResult.textContent;
        if (!transcriptionText || transcriptionText === 'Transcription will appear here...') {
          return;
        }

        // Add to timeline
        addToTimeline({
          type: 'note',
          title: 'Voice Note',
          description: transcriptionText,
          date: 'today',
          time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}),
          subtype: 'Transcription'
        });

        // Show confirmation
        transcriptionStatus.textContent = 'Note saved!';
        setTimeout(() => {
          transcriptionStatus.textContent = 'Click to start recording';
        }, 2000);
      }

      // Create task from transcription
      function createTaskFromTranscription() {
        const transcriptionText = transcriptionResult.textContent;
        if (!transcriptionText || transcriptionText === 'Transcription will appear here...') {
          return;
        }

        // Create task
        createTask(
          transcriptionText.split('.')[0] || 'Voice Task', // Use first sentence as title
          transcriptionText,
          'Medium',
          ''
        );

        // Show confirmation
        transcriptionStatus.textContent = 'Task created!';
        setTimeout(() => {
          transcriptionStatus.textContent = 'Click to start recording';
        }, 2000);
      }
    }

    // Initialize analytics system
    function initializeAnalyticsSystem() {
      console.log("Initializing analytics system...");

      // DOM elements
      const analyticsPeriod = document.getElementById('analytics-period');
      const customDateRange = document.getElementById('custom-date-range');
      const dateFrom = document.getElementById('date-from');
      const dateTo = document.getElementById('date-to');
      const updateAnalyticsBtn = document.getElementById('update-analytics');
      const campaignPerformanceTable = document.getElementById('campaign-performance-table');

      // Set default date range for custom dates
      const today = new Date();
      const thirtyDaysAgo = new Date(today);
      thirtyDaysAgo.setDate(today.getDate() - 30);

      dateFrom.value = formatDateForInput(thirtyDaysAgo);
      dateTo.value = formatDateForInput(today);

      // Event listeners
      if (analyticsPeriod) {
        analyticsPeriod.addEventListener('change', () => {
          if (analyticsPeriod.value === 'custom') {
            customDateRange.classList.remove('hidden');
          } else {
            customDateRange.classList.add('hidden');
            updateAnalytics();
          }
        });
      }

      if (updateAnalyticsBtn) {
        updateAnalyticsBtn.addEventListener('click', () => {
          updateAnalytics();
        });
      }

      // Initialize charts on load
      updateAnalytics();

      // Functions
      function formatDateForInput(date) {
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
      }

      function getDateRange() {
        if (analyticsPeriod.value === 'custom') {
          return {
            from: new Date(dateFrom.value),
            to: new Date(dateTo.value)
          };
        } else {
          const days = parseInt(analyticsPeriod.value);
          const to = new Date();
          const from = new Date();
          from.setDate(to.getDate() - days);
          return { from, to };
        }
      }

      async function updateAnalytics() {
        try {
          // Get date range
          const dateRange = getDateRange();

          // Load analytics data
          const analyticsData = await loadAnalyticsData(dateRange);

          // Update KPI cards
          updateKPICards(analyticsData);

          // Update charts
          createCampaignPerformanceChart(analyticsData);
          createEngagementMetricsChart(analyticsData);
          createGeographicDistributionChart(analyticsData);
          createDeviceUsageChart(analyticsData);

          // Update campaign performance table
          updateCampaignTable(analyticsData.campaigns);
        } catch (error) {
          console.error('Error updating analytics:', error);
        }
      }

      async function loadAnalyticsData(dateRange) {
        try {
          const dbPromise = idbKeyval.createStore('agent-lee-crm', 'stores');
          let campaigns = await idbKeyval.get('campaigns', dbPromise) || [];

          // Filter campaigns by date range
          const filteredCampaigns = campaigns.filter(campaign => {
            const campaignDate = new Date(campaign.sentDate || campaign.scheduledDate || campaign.createdAt);
            return campaignDate >= dateRange.from && campaignDate <= dateRange.to;
          });

          // Calculate analytics metrics
          const totalLeads = 247; // This would normally be calculated from actual data
          const totalLeadsLastPeriod = 220; // This would normally be calculated from actual data

          let totalOpenRate = 0;
          let totalClickRate = 0;
          let totalResponseRate = 0;
          let sentCampaigns = 0;

          filteredCampaigns.forEach(campaign => {
            if (campaign.status === 'sent') {
              totalOpenRate += campaign.openRate;
              totalClickRate += campaign.clickRate;
              totalResponseRate += campaign.responseRate;
              sentCampaigns++;
            }
          });

          const avgOpenRate = sentCampaigns > 0 ? (totalOpenRate / sentCampaigns) : 0;
          const avgClickRate = sentCampaigns > 0 ? (totalClickRate / sentCampaigns) : 0;
          const avgResponseRate = sentCampaigns > 0 ? (totalResponseRate / sentCampaigns) : 0;

          // Previous period metrics (this would normally be calculated from actual data)
          const avgOpenRateLastPeriod = 65.1;
          const avgClickRateLastPeriod = 24.8;
          const avgResponseRateLastPeriod = 11.7;

          // Geographic distribution (this would normally be calculated from actual data)
          const geographicDistribution = {
            'Wisconsin': 45,
            'Illinois': 30,
            'Minnesota': 25,
            'Michigan': 20,
            'Indiana': 15,
            'Ohio': 10
          };

          // Device usage (this would normally be calculated from actual data)
          const deviceUsage = {
            'Desktop': 65,
            'Mobile': 30,
            'Tablet': 5
          };

          // Campaign performance over time (this would normally be calculated from actual data)
          const campaignPerformanceOverTime = {
            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
            openRates: [62, 64, 67, 65, 68, 70],
            clickRates: [22, 23, 25, 24, 26, 28],
            responseRates: [10, 11, 12, 11, 13, 14]
          };

          // Engagement metrics (this would normally be calculated from actual data)
          const engagementMetrics = {
            labels: ['Email Opens', 'Link Clicks', 'Responses', 'Unsubscribes'],
            data: [68.5, 24.3, 12.1, 0.8]
          };

          return {
            totalLeads,
            totalLeadsLastPeriod,
            avgOpenRate,
            avgOpenRateLastPeriod,
            avgClickRate,
            avgClickRateLastPeriod,
            avgResponseRate,
            avgResponseRateLastPeriod,
            geographicDistribution,
            deviceUsage,
            campaignPerformanceOverTime,
            engagementMetrics,
            campaigns: filteredCampaigns
          };
        } catch (error) {
          console.error('Error loading analytics data:', error);
          return {
            totalLeads: 0,
            totalLeadsLastPeriod: 0,
            avgOpenRate: 0,
            avgOpenRateLastPeriod: 0,
            avgClickRate: 0,
            avgClickRateLastPeriod: 0,
            avgResponseRate: 0,
            avgResponseRateLastPeriod: 0,
            geographicDistribution: {},
            deviceUsage: {},
            campaignPerformanceOverTime: { labels: [], openRates: [], clickRates: [], responseRates: [] },
            engagementMetrics: { labels: [], data: [] },
            campaigns: []
          };
        }
      }

      function updateKPICards(data) {
        // Calculate percentage changes
        const leadsChange = ((data.totalLeads - data.totalLeadsLastPeriod) / data.totalLeadsLastPeriod * 100).toFixed(1);
        const openRateChange = ((data.avgOpenRate - data.avgOpenRateLastPeriod) / data.avgOpenRateLastPeriod * 100).toFixed(1);
        const clickRateChange = ((data.avgClickRate - data.avgClickRateLastPeriod) / data.avgClickRateLastPeriod * 100).toFixed(1);
        const responseRateChange = ((data.avgResponseRate - data.avgResponseRateLastPeriod) / data.avgResponseRateLastPeriod * 100).toFixed(1);

        // Update KPI values
        const kpiCards = document.querySelectorAll('.grid-cols-4 .text-2xl');
        if (kpiCards.length >= 4) {
          kpiCards[0].textContent = data.totalLeads;
          kpiCards[1].textContent = data.avgOpenRate.toFixed(1) + '%';
          kpiCards[2].textContent = data.avgClickRate.toFixed(1) + '%';
          kpiCards[3].textContent = data.avgResponseRate.toFixed(1) + '%';
        }

        // Update change indicators
        const changeIndicators = document.querySelectorAll('.grid-cols-4 .text-xs');
        if (changeIndicators.length >= 4) {
          updateChangeIndicator(changeIndicators[0], leadsChange);
          updateChangeIndicator(changeIndicators[1], openRateChange);
          updateChangeIndicator(changeIndicators[2], clickRateChange);
          updateChangeIndicator(changeIndicators[3], responseRateChange);
        }
      }

      function updateChangeIndicator(element, change) {
        const changeValue = parseFloat(change);
        const svgUp = '<svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" /></svg>';
        const svgDown = '<svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3" /></svg>';

        if (changeValue > 0) {
          element.className = 'text-green-500 text-xs flex items-center mt-1';
          element.innerHTML = svgUp + changeValue + '% from last period';
        } else if (changeValue < 0) {
          element.className = 'text-red-500 text-xs flex items-center mt-1';
          element.innerHTML = svgDown + Math.abs(changeValue) + '% from last period';
        } else {
          element.className = 'text-dark-500 dark:text-dark-400 text-xs flex items-center mt-1';
          element.innerHTML = 'No change from last period';
        }
      }

      function createCampaignPerformanceChart(data) {
        const ctx = document.getElementById('campaign-performance-chart');
        if (!ctx) return;

        // Destroy existing chart if it exists
        if (window.campaignPerformanceChart) {
          window.campaignPerformanceChart.destroy();
        }

        // Create new chart
        window.campaignPerformanceChart = new Chart(ctx, {
          type: 'line',
          data: {
            labels: data.campaignPerformanceOverTime.labels,
            datasets: [
              {
                label: 'Open Rate',
                data: data.campaignPerformanceOverTime.openRates,
                borderColor: '#10b981',
                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                tension: 0.4,
                fill: true
              },
              {
                label: 'Click Rate',
                data: data.campaignPerformanceOverTime.clickRates,
                borderColor: '#f59e0b',
                backgroundColor: 'rgba(245, 158, 11, 0.1)',
                tension: 0.4,
                fill: true
              },
              {
                label: 'Response Rate',
                data: data.campaignPerformanceOverTime.responseRates,
                borderColor: '#8b5cf6',
                backgroundColor: 'rgba(139, 92, 246, 0.1)',
                tension: 0.4,
                fill: true
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: 'top',
                labels: {
                  usePointStyle: true,
                  boxWidth: 6
                }
              },
              tooltip: {
                mode: 'index',
                intersect: false
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  callback: function(value) {
                    return value + '%';
                  }
                }
              }
            }
          }
        });
      }

      function createEngagementMetricsChart(data) {
        const ctx = document.getElementById('engagement-metrics-chart');
        if (!ctx) return;

        // Destroy existing chart if it exists
        if (window.engagementMetricsChart) {
          window.engagementMetricsChart.destroy();
        }

        // Create new chart
        window.engagementMetricsChart = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: data.engagementMetrics.labels,
            datasets: [
              {
                label: 'Engagement Rate (%)',
                data: data.engagementMetrics.data,
                backgroundColor: [
                  'rgba(16, 185, 129, 0.7)',
                  'rgba(245, 158, 11, 0.7)',
                  'rgba(139, 92, 246, 0.7)',
                  'rgba(239, 68, 68, 0.7)'
                ],
                borderColor: [
                  'rgb(16, 185, 129)',
                  'rgb(245, 158, 11)',
                  'rgb(139, 92, 246)',
                  'rgb(239, 68, 68)'
                ],
                borderWidth: 1
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: false
              },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    return context.dataset.label + ': ' + context.raw + '%';
                  }
                }
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  callback: function(value) {
                    return value + '%';
                  }
                }
              }
            }
          }
        });
      }

      function createGeographicDistributionChart(data) {
        const ctx = document.getElementById('geographic-distribution-chart');
        if (!ctx) return;

        // Destroy existing chart if it exists
        if (window.geographicDistributionChart) {
          window.geographicDistributionChart.destroy();
        }

        // Create new chart
        window.geographicDistributionChart = new Chart(ctx, {
          type: 'pie',
          data: {
            labels: Object.keys(data.geographicDistribution),
            datasets: [
              {
                data: Object.values(data.geographicDistribution),
                backgroundColor: [
                  'rgba(79, 70, 229, 0.7)',
                  'rgba(16, 185, 129, 0.7)',
                  'rgba(245, 158, 11, 0.7)',
                  'rgba(239, 68, 68, 0.7)',
                  'rgba(139, 92, 246, 0.7)',
                  'rgba(14, 165, 233, 0.7)'
                ],
                borderColor: [
                  'rgb(79, 70, 229)',
                  'rgb(16, 185, 129)',
                  'rgb(245, 158, 11)',
                  'rgb(239, 68, 68)',
                  'rgb(139, 92, 246)',
                  'rgb(14, 165, 233)'
                ],
                borderWidth: 1
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: 'right',
                labels: {
                  usePointStyle: true,
                  boxWidth: 6
                }
              },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    const label = context.label || '';
                    const value = context.raw || 0;
                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                    const percentage = Math.round((value / total) * 100);
                    return label + ': ' + value + ' (' + percentage + '%)';
                  }
                }
              }
            }
          }
        });
      }

      function createDeviceUsageChart(data) {
        const ctx = document.getElementById('device-usage-chart');
        if (!ctx) return;

        // Destroy existing chart if it exists
        if (window.deviceUsageChart) {
          window.deviceUsageChart.destroy();
        }

        // Create new chart
        window.deviceUsageChart = new Chart(ctx, {
          type: 'doughnut',
          data: {
            labels: Object.keys(data.deviceUsage),
            datasets: [
              {
                data: Object.values(data.deviceUsage),
                backgroundColor: [
                  'rgba(79, 70, 229, 0.7)',
                  'rgba(16, 185, 129, 0.7)',
                  'rgba(245, 158, 11, 0.7)'
                ],
                borderColor: [
                  'rgb(79, 70, 229)',
                  'rgb(16, 185, 129)',
                  'rgb(245, 158, 11)'
                ],
                borderWidth: 1
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: 'right',
                labels: {
                  usePointStyle: true,
                  boxWidth: 6
                }
              },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    const label = context.label || '';
                    const value = context.raw || 0;
                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                    const percentage = Math.round((value / total) * 100);
                    return label + ': ' + percentage + '%';
                  }
                }
              }
            }
          }
        });
      }

      function updateCampaignTable(campaigns) {
        if (!campaignPerformanceTable) return;

        // Clear table
        campaignPerformanceTable.innerHTML = '';

        if (campaigns.length === 0) {
          campaignPerformanceTable.innerHTML = `
            <tr>
              <td colspan="6" class="px-4 py-4 text-center text-dark-500 dark:text-dark-400">
                No campaign data available for the selected period.
              </td>
            </tr>
          `;
          return;
        }

        // Sort campaigns by sent date (newest first)
        campaigns.sort((a, b) => {
          const dateA = new Date(a.sentDate || a.scheduledDate || a.createdAt);
          const dateB = new Date(b.sentDate || b.scheduledDate || b.createdAt);
          return dateB - dateA;
        });

        // Add rows for each campaign
        campaigns.forEach(campaign => {
          if (campaign.status === 'sent') {
            const row = document.createElement('tr');
            row.className = 'hover:bg-dark-50 dark:hover:bg-dark-700/50';

            row.innerHTML = `
              <td class="px-4 py-3 whitespace-nowrap">
                <div class="text-sm font-medium text-dark-900 dark:text-white">${campaign.title}</div>
                <div class="text-xs text-dark-500 dark:text-dark-400">${campaign.subject}</div>
              </td>
              <td class="px-4 py-3 whitespace-nowrap text-sm text-dark-700 dark:text-dark-300">
                ${formatDate(campaign.sentDate)}
              </td>
              <td class="px-4 py-3 whitespace-nowrap text-sm text-dark-700 dark:text-dark-300">
                ${Array.isArray(campaign.recipients) ? campaign.recipients.length : 1}
              </td>
              <td class="px-4 py-3 whitespace-nowrap">
                <div class="flex items-center">
                  <div class="w-full bg-dark-200 dark:bg-dark-600 rounded-full h-2.5">
                    <div class="bg-green-500 h-2.5 rounded-full" style="width: ${campaign.openRate}%"></div>
                  </div>
                  <span class="ml-2 text-sm text-dark-700 dark:text-dark-300">${campaign.openRate}%</span>
                </div>
              </td>
              <td class="px-4 py-3 whitespace-nowrap">
                <div class="flex items-center">
                  <div class="w-full bg-dark-200 dark:bg-dark-600 rounded-full h-2.5">
                    <div class="bg-amber-500 h-2.5 rounded-full" style="width: ${campaign.clickRate}%"></div>
                  </div>
                  <span class="ml-2 text-sm text-dark-700 dark:text-dark-300">${campaign.clickRate}%</span>
                </div>
              </td>
              <td class="px-4 py-3 whitespace-nowrap">
                <div class="flex items-center">
                  <div class="w-full bg-dark-200 dark:bg-dark-600 rounded-full h-2.5">
                    <div class="bg-purple-500 h-2.5 rounded-full" style="width: ${campaign.responseRate}%"></div>
                  </div>
                  <span class="ml-2 text-sm text-dark-700 dark:text-dark-300">${campaign.responseRate}%</span>
                </div>
              </td>
            `;

            campaignPerformanceTable.appendChild(row);
          }
        });
      }

      function formatDate(dateString) {
        if (!dateString) return 'N/A';

        const date = new Date(dateString);
        return date.toLocaleDateString('en-US', {
          year: 'numeric',
          month: 'short',
          day: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        });
      }
    }

    // Initialize campaigns system
    function initializeCampaignsSystem() {
      console.log("Initializing campaigns system...");

      // DOM elements
      const createCampaignBtn = document.getElementById('create-campaign-btn');
      const campaignModal = document.getElementById('campaign-modal');
      const closeCampaignModal = document.getElementById('close-campaign-modal');
      const saveCampaignDraft = document.getElementById('save-campaign-draft');
      const saveCampaign = document.getElementById('save-campaign');
      const campaignForm = document.getElementById('campaign-form');
      const campaignsList = document.getElementById('campaigns-list');
      const campaignSearch = document.getElementById('campaign-search');
      const campaignFilter = document.getElementById('campaign-filter');
      const campaignScheduleType = document.getElementById('campaign-schedule-type');
      const scheduleDateContainer = document.getElementById('schedule-date-container');
      const campaignPreviewModal = document.getElementById('campaign-preview-modal');
      const closePreviewModal = document.getElementById('close-preview-modal');
      const editPreviewCampaign = document.getElementById('edit-preview-campaign');
      const sendPreviewCampaign = document.getElementById('send-preview-campaign');

      // Event listeners
      if (createCampaignBtn) {
        createCampaignBtn.addEventListener('click', () => {
          resetCampaignForm();
          campaignModal.classList.remove('hidden');
        });
      }

      if (closeCampaignModal) {
        closeCampaignModal.addEventListener('click', () => {
          campaignModal.classList.add('hidden');
        });
      }

      if (closePreviewModal) {
        closePreviewModal.addEventListener('click', () => {
          campaignPreviewModal.classList.add('hidden');
        });
      }

      if (editPreviewCampaign) {
        editPreviewCampaign.addEventListener('click', () => {
          campaignPreviewModal.classList.add('hidden');
          campaignModal.classList.remove('hidden');
        });
      }

      if (sendPreviewCampaign) {
        sendPreviewCampaign.addEventListener('click', () => {
          sendCampaign();
        });
      }

      if (saveCampaignDraft) {
        saveCampaignDraft.addEventListener('click', () => {
          saveCampaignToDb('draft');
        });
      }

      if (saveCampaign) {
        saveCampaign.addEventListener('click', () => {
          if (campaignScheduleType.value === 'scheduled') {
            saveCampaignToDb('scheduled');
          } else {
            // Show preview before sending
            previewCampaign();
          }
        });
      }

      if (campaignScheduleType) {
        campaignScheduleType.addEventListener('change', () => {
          if (campaignScheduleType.value === 'scheduled') {
            scheduleDateContainer.classList.remove('hidden');
          } else {
            scheduleDateContainer.classList.add('hidden');
          }
        });
      }

      if (campaignSearch) {
        campaignSearch.addEventListener('input', () => {
          loadCampaigns();
        });
      }

      if (campaignFilter) {
        campaignFilter.addEventListener('change', () => {
          loadCampaigns();
        });
      }

      // Load campaigns on initialization
      loadCampaigns();

      // Functions
      function resetCampaignForm() {
        document.getElementById('campaign-title').value = '';
        document.getElementById('campaign-subject').value = '';
        document.getElementById('campaign-template').value = 'default';
        document.getElementById('campaign-message').value = '';
        document.getElementById('campaign-recipients').value = 'all';
        document.getElementById('campaign-schedule-type').value = 'now';
        document.getElementById('campaign-schedule-date').value = '';
        scheduleDateContainer.classList.add('hidden');
        document.getElementById('campaign-modal-title').textContent = 'Create New Campaign';
      }

      function previewCampaign() {
        const title = document.getElementById('campaign-title').value;
        const subject = document.getElementById('campaign-subject').value;
        const message = document.getElementById('campaign-message').value;
        const recipients = document.getElementById('campaign-recipients');

        // Set preview content
        document.getElementById('preview-campaign-title').textContent = title;
        document.getElementById('preview-subject').textContent = subject;
        document.getElementById('campaign-preview-content').innerHTML = message;

        // Set recipients text
        let recipientsText = '';
        for (let i = 0; i < recipients.selectedOptions.length; i++) {
          recipientsText += recipients.selectedOptions[i].text;
          if (i < recipients.selectedOptions.length - 1) {
            recipientsText += ', ';
          }
        }
        document.getElementById('preview-recipients').textContent = recipientsText || 'All Contacts';

        // Show preview modal
        campaignModal.classList.add('hidden');
        campaignPreviewModal.classList.remove('hidden');
      }

      async function saveCampaignToDb(status) {
        const title = document.getElementById('campaign-title').value;
        const subject = document.getElementById('campaign-subject').value;
        const template = document.getElementById('campaign-template').value;
        const message = document.getElementById('campaign-message').value;
        const recipients = Array.from(document.getElementById('campaign-recipients').selectedOptions).map(option => option.value);
        const scheduleType = document.getElementById('campaign-schedule-type').value;
        const scheduleDate = document.getElementById('campaign-schedule-date').value;

        // Validate required fields
        if (!title || !subject || !message || recipients.length === 0) {
          alert('Please fill in all required fields');
          return;
        }

        // Create campaign object
        const campaign = {
          id: 'campaign_' + Date.now(),
          title,
          subject,
          template,
          body: message,
          recipients,
          status: status,
          scheduledDate: scheduleType === 'scheduled' ? scheduleDate : null,
          sentDate: null,
          openRate: 0,
          clickRate: 0,
          responseRate: 0,
          createdAt: new Date().toISOString(),
          lastModified: new Date().toISOString()
        };

        try {
          // Save to IndexedDB
          const dbPromise = idbKeyval.createStore('agent-lee-crm', 'stores');
          const campaigns = await idbKeyval.get('campaigns', dbPromise) || [];

          // Add to campaigns array
          campaigns.push(campaign);

          // Save to IndexedDB
          await idbKeyval.set('campaigns', campaigns, dbPromise);

          // Close modal and refresh list
          campaignModal.classList.add('hidden');
          loadCampaigns();

          // Show success message
          alert(`Campaign ${status === 'draft' ? 'draft' : ''} saved successfully`);
        } catch (error) {
          console.error('Error saving campaign:', error);
          alert('Error saving campaign. Please try again.');
        }
      }

      async function sendCampaign() {
        try {
          // In a real app, this would send the email via EmailJS or a backend API
          // For now, we'll just update the status
          const dbPromise = idbKeyval.createStore('agent-lee-crm', 'stores');
          const campaigns = await idbKeyval.get('campaigns', dbPromise) || [];

          // Find the campaign being previewed
          const campaignTitle = document.getElementById('preview-campaign-title').textContent;
          const campaignIndex = campaigns.findIndex(c => c.title === campaignTitle);

          if (campaignIndex !== -1) {
            // Update campaign status
            campaigns[campaignIndex].status = 'sent';
            campaigns[campaignIndex].sentDate = new Date().toISOString();
            campaigns[campaignIndex].lastModified = new Date().toISOString();

            // Save to IndexedDB
            await idbKeyval.set('campaigns', campaigns, dbPromise);

            // Close modal and refresh list
            campaignPreviewModal.classList.add('hidden');
            loadCampaigns();

            // Show success message
            alert('Campaign sent successfully!');
          }
        } catch (error) {
          console.error('Error sending campaign:', error);
          alert('Error sending campaign. Please try again.');
        }
      }

      async function loadCampaigns() {
        try {
          const dbPromise = idbKeyval.createStore('agent-lee-crm', 'stores');
          let campaigns = await idbKeyval.get('campaigns', dbPromise) || [];

          // If no campaigns exist, create some sample campaigns
          if (campaigns.length === 0) {
            campaigns = [
              {
                id: 'campaign_1',
                title: 'Summer Promotion',
                subject: 'Special Summer Discounts for Music Stores',
                template: 'promotional',
                body: '<h2>Summer Savings on All Instruments</h2><p>Dear valued partner,</p><p>We\'re excited to offer special summer discounts on our entire catalog. Take advantage of these limited-time offers to stock up for the busy season ahead.</p><p>Contact us today to place your order!</p><p>Best regards,<br>Leonard Lee<br>Lee Music Distribution</p>',
                recipients: ['stores'],
                status: 'sent',
                scheduledDate: null,
                sentDate: '2023-05-15T10:00:00',
                openRate: 72.5,
                clickRate: 28.3,
                responseRate: 15.2,
                createdAt: '2023-05-10T14:30:00',
                lastModified: '2023-05-15T10:00:00'
              },
              {
                id: 'campaign_2',
                title: 'New Product Announcement',
                subject: 'Introducing Our New Line of Premium Guitars',
                template: 'announcement',
                body: '<h2>Introducing the Elite Series Guitars</h2><p>Dear valued partner,</p><p>We\'re thrilled to announce our new line of premium guitars, the Elite Series. These instruments feature top-quality materials, expert craftsmanship, and stunning finishes.</p><p>Schedule a demo today!</p><p>Best regards,<br>Leonard Lee<br>Lee Music Distribution</p>',
                recipients: ['stores', 'artists'],
                status: 'scheduled',
                scheduledDate: '2023-06-01T09:00:00',
                sentDate: null,
                openRate: 0,
                clickRate: 0,
                responseRate: 0,
                createdAt: '2023-05-20T11:15:00',
                lastModified: '2023-05-20T11:15:00'
              },
              {
                id: 'campaign_3',
                title: 'Follow-up: Chicago Music Expo',
                subject: 'Thank You for Visiting Our Booth',
                template: 'follow-up',
                body: '<h2>Thank You for Visiting Us</h2><p>Dear valued partner,</p><p>It was a pleasure meeting you at the Chicago Music Expo last week. We appreciate your interest in our products and services.</p><p>As discussed, I\'m attaching our latest catalog and price list. Please let me know if you have any questions or if you\'d like to place an order.</p><p>Best regards,<br>Leonard Lee<br>Lee Music Distribution</p>',
                recipients: ['custom'],
                status: 'draft',
                scheduledDate: null,
                sentDate: null,
                openRate: 0,
                clickRate: 0,
                responseRate: 0,
                createdAt: '2023-05-22T16:45:00',
                lastModified: '2023-05-22T16:45:00'
              }
            ];

            // Save sample campaigns to IndexedDB
            await idbKeyval.set('campaigns', campaigns, dbPromise);
          }

          // Apply search filter
          const searchTerm = campaignSearch.value.toLowerCase();
          if (searchTerm) {
            campaigns = campaigns.filter(campaign =>
              campaign.title.toLowerCase().includes(searchTerm) ||
              campaign.subject.toLowerCase().includes(searchTerm)
            );
          }

          // Apply status filter
          const statusFilter = campaignFilter.value;
          if (statusFilter !== 'all') {
            campaigns = campaigns.filter(campaign => campaign.status === statusFilter);
          }

          // Sort campaigns by creation date (newest first)
          campaigns.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

          // Update campaign stats
          updateCampaignStats(campaigns);

          // Render campaigns
          renderCampaigns(campaigns);
        } catch (error) {
          console.error('Error loading campaigns:', error);
        }
      }

      function updateCampaignStats(campaigns) {
        // Calculate stats
        const totalCampaigns = campaigns.length;

        let totalOpenRate = 0;
        let totalClickRate = 0;
        let totalResponseRate = 0;
        let sentCampaigns = 0;

        campaigns.forEach(campaign => {
          if (campaign.status === 'sent') {
            totalOpenRate += campaign.openRate;
            totalClickRate += campaign.clickRate;
            totalResponseRate += campaign.responseRate;
            sentCampaigns++;
          }
        });

        const avgOpenRate = sentCampaigns > 0 ? (totalOpenRate / sentCampaigns).toFixed(1) : '0.0';
        const avgClickRate = sentCampaigns > 0 ? (totalClickRate / sentCampaigns).toFixed(1) : '0.0';
        const avgResponseRate = sentCampaigns > 0 ? (totalResponseRate / sentCampaigns).toFixed(1) : '0.0';

        // Update UI
        const statsElements = document.querySelectorAll('.grid-cols-4 .text-2xl');
        if (statsElements.length >= 4) {
          statsElements[0].textContent = totalCampaigns;
          statsElements[1].textContent = avgOpenRate + '%';
          statsElements[2].textContent = avgClickRate + '%';
          statsElements[3].textContent = avgResponseRate + '%';
        }
      }

      function renderCampaigns(campaigns) {
        if (!campaignsList) return;

        // Clear loading animation
        campaignsList.innerHTML = '';

        if (campaigns.length === 0) {
          campaignsList.innerHTML = `
            <div class="text-center p-6 text-dark-500 dark:text-dark-400">
              No campaigns found. Create your first campaign to get started.
            </div>
          `;
          return;
        }

        // Render each campaign
        campaigns.forEach(campaign => {
          const statusBadge = getStatusBadge(campaign.status);
          const recipientCount = Array.isArray(campaign.recipients) ? campaign.recipients.length : 1;

          const campaignCard = document.createElement('div');
          campaignCard.className = 'bg-white dark:bg-dark-700 rounded-xl p-5 shadow-sm border border-dark-100/50 dark:border-dark-700/50 hover:shadow-md transition-shadow';

          campaignCard.innerHTML = `
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
              <div class="flex-grow">
                <div class="flex items-center gap-2 mb-1">
                  <h3 class="text-lg font-display font-bold text-dark-900 dark:text-white">${campaign.title}</h3>
                  ${statusBadge}
                </div>
                <p class="text-dark-600 dark:text-dark-400 text-sm mb-2">${campaign.subject}</p>
                <div class="flex flex-wrap gap-3 text-xs text-dark-500 dark:text-dark-400">
                  <span class="flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                    </svg>
                    ${recipientCount} recipient${recipientCount !== 1 ? 's' : ''}
                  </span>
                  <span class="flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                    ${formatDate(campaign.status === 'sent' ? campaign.sentDate : campaign.scheduledDate || campaign.createdAt)}
                  </span>
                  ${campaign.status === 'sent' ? `
                    <span class="flex items-center">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                      </svg>
                      ${campaign.openRate}% opened
                    </span>
                  ` : ''}
                </div>
              </div>
              <div class="flex gap-2">
                ${campaign.status === 'draft' ? `
                  <button type="button" class="edit-campaign px-3 py-1.5 text-dark-700 dark:text-dark-300 bg-dark-100 dark:bg-dark-700 hover:bg-dark-200 dark:hover:bg-dark-600 rounded-lg transition-colors text-sm" data-id="${campaign.id}">
                    Edit
                  </button>
                  <button type="button" class="preview-campaign px-3 py-1.5 gradient-btn text-white rounded-lg hover:shadow-md transition-all text-sm" data-id="${campaign.id}">
                    Preview
                  </button>
                ` : campaign.status === 'scheduled' ? `
                  <button type="button" class="edit-campaign px-3 py-1.5 text-dark-700 dark:text-dark-300 bg-dark-100 dark:bg-dark-700 hover:bg-dark-200 dark:hover:bg-dark-600 rounded-lg transition-colors text-sm" data-id="${campaign.id}">
                    Edit
                  </button>
                  <button type="button" class="send-now-campaign px-3 py-1.5 gradient-btn text-white rounded-lg hover:shadow-md transition-all text-sm" data-id="${campaign.id}">
                    Send Now
                  </button>
                ` : `
                  <button type="button" class="duplicate-campaign px-3 py-1.5 text-dark-700 dark:text-dark-300 bg-dark-100 dark:bg-dark-700 hover:bg-dark-200 dark:hover:bg-dark-600 rounded-lg transition-colors text-sm" data-id="${campaign.id}">
                    Duplicate
                  </button>
                  <button type="button" class="view-campaign px-3 py-1.5 gradient-btn text-white rounded-lg hover:shadow-md transition-all text-sm" data-id="${campaign.id}">
                    View Results
                  </button>
                `}
              </div>
            </div>
          `;

          // Add event listeners
          const editBtn = campaignCard.querySelector('.edit-campaign');
          if (editBtn) {
            editBtn.addEventListener('click', () => editCampaign(campaign.id));
          }

          const previewBtn = campaignCard.querySelector('.preview-campaign');
          if (previewBtn) {
            previewBtn.addEventListener('click', () => previewExistingCampaign(campaign.id));
          }

          const sendNowBtn = campaignCard.querySelector('.send-now-campaign');
          if (sendNowBtn) {
            sendNowBtn.addEventListener('click', () => sendScheduledCampaign(campaign.id));
          }

          const duplicateBtn = campaignCard.querySelector('.duplicate-campaign');
          if (duplicateBtn) {
            duplicateBtn.addEventListener('click', () => duplicateCampaign(campaign.id));
          }

          const viewBtn = campaignCard.querySelector('.view-campaign');
          if (viewBtn) {
            viewBtn.addEventListener('click', () => viewCampaignResults(campaign.id));
          }

          campaignsList.appendChild(campaignCard);
        });
      }

      function getStatusBadge(status) {
        switch (status) {
          case 'draft':
            return '<span class="px-2 py-0.5 bg-dark-100 dark:bg-dark-600 text-dark-700 dark:text-dark-300 rounded text-xs">Draft</span>';
          case 'scheduled':
            return '<span class="px-2 py-0.5 bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-200 rounded text-xs">Scheduled</span>';
          case 'sent':
            return '<span class="px-2 py-0.5 bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-200 rounded text-xs">Sent</span>';
          case 'completed':
            return '<span class="px-2 py-0.5 bg-purple-100 dark:bg-purple-900/30 text-purple-800 dark:text-purple-200 rounded text-xs">Completed</span>';
          default:
            return '';
        }
      }

      function formatDate(dateString) {
        if (!dateString) return 'N/A';

        const date = new Date(dateString);
        return date.toLocaleDateString('en-US', {
          year: 'numeric',
          month: 'short',
          day: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        });
      }

      async function editCampaign(campaignId) {
        try {
          const dbPromise = idbKeyval.createStore('agent-lee-crm', 'stores');
          const campaigns = await idbKeyval.get('campaigns', dbPromise) || [];

          const campaign = campaigns.find(c => c.id === campaignId);
          if (!campaign) return;

          // Fill form with campaign data
          document.getElementById('campaign-title').value = campaign.title;
          document.getElementById('campaign-subject').value = campaign.subject;
          document.getElementById('campaign-template').value = campaign.template;
          document.getElementById('campaign-message').value = campaign.body;

          // Set recipients
          const recipientsSelect = document.getElementById('campaign-recipients');
          for (let i = 0; i < recipientsSelect.options.length; i++) {
            recipientsSelect.options[i].selected = campaign.recipients.includes(recipientsSelect.options[i].value);
          }

          // Set schedule
          if (campaign.scheduledDate) {
            document.getElementById('campaign-schedule-type').value = 'scheduled';
            document.getElementById('campaign-schedule-date').value = campaign.scheduledDate.slice(0, 16); // Format for datetime-local input
            scheduleDateContainer.classList.remove('hidden');
          } else {
            document.getElementById('campaign-schedule-type').value = 'now';
            scheduleDateContainer.classList.add('hidden');
          }

          // Update modal title
          document.getElementById('campaign-modal-title').textContent = 'Edit Campaign';

          // Show modal
          campaignModal.classList.remove('hidden');
        } catch (error) {
          console.error('Error editing campaign:', error);
        }
      }

      async function previewExistingCampaign(campaignId) {
        try {
          const dbPromise = idbKeyval.createStore('agent-lee-crm', 'stores');
          const campaigns = await idbKeyval.get('campaigns', dbPromise) || [];

          const campaign = campaigns.find(c => c.id === campaignId);
          if (!campaign) return;

          // Set preview content
          document.getElementById('preview-campaign-title').textContent = campaign.title;
          document.getElementById('preview-subject').textContent = campaign.subject;
          document.getElementById('campaign-preview-content').innerHTML = campaign.body;

          // Set recipients text
          let recipientsText = campaign.recipients.join(', ');
          document.getElementById('preview-recipients').textContent = recipientsText || 'All Contacts';

          // Show preview modal
          campaignPreviewModal.classList.remove('hidden');
        } catch (error) {
          console.error('Error previewing campaign:', error);
        }
      }

      async function sendScheduledCampaign(campaignId) {
        try {
          const dbPromise = idbKeyval.createStore('agent-lee-crm', 'stores');
          const campaigns = await idbKeyval.get('campaigns', dbPromise) || [];

          const campaignIndex = campaigns.findIndex(c => c.id === campaignId);
          if (campaignIndex === -1) return;

          // Update campaign status
          campaigns[campaignIndex].status = 'sent';
          campaigns[campaignIndex].sentDate = new Date().toISOString();
          campaigns[campaignIndex].lastModified = new Date().toISOString();

          // Save to IndexedDB
          await idbKeyval.set('campaigns', campaigns, dbPromise);

          // Refresh list
          loadCampaigns();

          // Show success message
          alert('Campaign sent successfully!');
        } catch (error) {
          console.error('Error sending campaign:', error);
          alert('Error sending campaign. Please try again.');
        }
      }

      async function duplicateCampaign(campaignId) {
        try {
          const dbPromise = idbKeyval.createStore('agent-lee-crm', 'stores');
          const campaigns = await idbKeyval.get('campaigns', dbPromise) || [];

          const campaign = campaigns.find(c => c.id === campaignId);
          if (!campaign) return;

          // Create a duplicate with new ID and draft status
          const duplicate = {
            ...campaign,
            id: 'campaign_' + Date.now(),
            title: `Copy of ${campaign.title}`,
            status: 'draft',
            scheduledDate: null,
            sentDate: null,
            openRate: 0,
            clickRate: 0,
            responseRate: 0,
            createdAt: new Date().toISOString(),
            lastModified: new Date().toISOString()
          };

          // Add to campaigns array
          campaigns.push(duplicate);

          // Save to IndexedDB
          await idbKeyval.set('campaigns', campaigns, dbPromise);

          // Refresh list
          loadCampaigns();

          // Show success message
          alert('Campaign duplicated successfully!');
        } catch (error) {
          console.error('Error duplicating campaign:', error);
          alert('Error duplicating campaign. Please try again.');
        }
      }

      function viewCampaignResults(campaignId) {
        // In a real app, this would show detailed analytics
        alert('Campaign results feature coming soon!');
      }
    }

    // Initialize voice dictation functionality
    function initializeVoiceDictation() {
      // Check if Web Speech API is supported
      if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
        console.warn('Web Speech API is not supported in this browser');
        return;
      }

      // Create speech recognition object
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      const recognition = new SpeechRecognition();

      // Configure recognition
      recognition.continuous = true;
      recognition.interimResults = true;
      recognition.lang = 'en-US';

      // Get UI elements
      const recordBtn = document.getElementById('global-record-btn');
      const stopRecordBtn = document.getElementById('global-stop-record');
      const dictationStatus = document.getElementById('dictation-status');
      const dictationResult = document.getElementById('dictation-result');
      const dictationControls = document.getElementById('dictation-controls');
      const dictationHint = document.getElementById('dictation-hint');
      const recordingWave = document.getElementById('recording-wave');
      const dictationCancel = document.getElementById('dictation-cancel');
      const dictationProcess = document.getElementById('dictation-process');

      // Start recording
      recordBtn.addEventListener('click', function() {
        try {
          recognition.start();
          recordBtn.classList.add('hidden');
          stopRecordBtn.classList.remove('hidden');
          dictationStatus.classList.remove('hidden');
          dictationHint.classList.add('hidden');
          recordingWave.classList.remove('hidden');
          dictationResult.textContent = 'Listening...';
        } catch (error) {
          console.error('Error starting speech recognition:', error);
        }
      });

      // Stop recording
      stopRecordBtn.addEventListener('click', function() {
        recognition.stop();
        stopRecordBtn.classList.add('hidden');
        recordingWave.classList.add('hidden');
        dictationControls.classList.remove('hidden');
      });

      // Cancel dictation
      dictationCancel.addEventListener('click', function() {
        resetDictationUI();
      });

      // Process dictation
      dictationProcess.addEventListener('click', function() {
        const dictationText = dictationResult.textContent;
        if (dictationText && dictationText !== 'Listening...' && dictationText !== 'Speak now...') {
          processDictation(dictationText);
        }
        resetDictationUI();
      });

      // Reset UI to initial state
      function resetDictationUI() {
        recordBtn.classList.remove('hidden');
        stopRecordBtn.classList.add('hidden');
        dictationStatus.classList.add('hidden');
        dictationControls.classList.add('hidden');
        dictationHint.classList.remove('hidden');
        recordingWave.classList.add('hidden');
        dictationResult.textContent = 'Speak now...';
      }

      // Handle recognition results
      recognition.onresult = function(event) {
        let interimTranscript = '';
        let finalTranscript = '';

        for (let i = event.resultIndex; i < event.results.length; i++) {
          const transcript = event.results[i][0].transcript;

          if (event.results[i].isFinal) {
            finalTranscript += transcript;
          } else {
            interimTranscript += transcript;
          }
        }

        dictationResult.textContent = finalTranscript || interimTranscript;
      };

      // Handle recognition end
      recognition.onend = function() {
        if (stopRecordBtn.classList.contains('hidden') && !dictationControls.classList.contains('hidden')) {
          // Normal end after stop button pressed - do nothing
        } else {
          // Ended unexpectedly - reset UI
          resetDictationUI();
        }
      };

      // Handle errors
      recognition.onerror = function(event) {
        console.error('Speech recognition error:', event.error);
        resetDictationUI();
      };
    }

      // Check for saved dark mode preference
      if (localStorage.getItem('darkMode') === 'enabled') {
        document.body.classList.add('dark-mode');
      }

      // Mobile menu toggle
      const mobileMenuBtn = document.getElementById('mobile-menu-btn');
      const mobileSidebar = document.getElementById('mobile-sidebar');
      const closeSidebar = document.getElementById('close-sidebar');
      const sidebarBackdrop = document.getElementById('sidebar-backdrop');

      if (mobileMenuBtn && mobileSidebar) {
        mobileMenuBtn.addEventListener('click', function() {
          mobileSidebar.classList.remove('-translate-x-full');
        });
      }

      if (closeSidebar && mobileSidebar) {
        closeSidebar.addEventListener('click', function() {
          mobileSidebar.classList.add('-translate-x-full');
        });
      }

      if (sidebarBackdrop && mobileSidebar) {
        sidebarBackdrop.addEventListener('click', function() {
          mobileSidebar.classList.add('-translate-x-full');
        });
      }

      // Tab switching
      const tabButtons = document.querySelectorAll('[data-tab]');
      const tabContents = document.querySelectorAll('section[id$="-tab"]');

      function activateTab(tabName) {
        // Hide all tab contents
        tabContents.forEach(content => {
          content.classList.add('hidden');
        });

        // Show the selected tab content
        const selectedTab = document.getElementById(tabName + '-tab');
        if (selectedTab) {
          selectedTab.classList.remove('hidden');
        }

        // Load dashboard data if dashboard tab is selected
        if (tabName === 'dashboard') {
          loadDashboardData();
        }

        // Update active state of tab buttons
        tabButtons.forEach(btn => {
          if (btn.dataset.tab === tabName) {
            // Desktop sidebar
            if (btn.classList.contains('sidebar-nav-active') || btn.classList.contains('mobile-nav-item')) {
              document.querySelectorAll('.sidebar-nav-active, .mobile-nav-item').forEach(item => {
                item.classList.remove('bg-primary-50', 'dark:bg-primary-900/20', 'text-primary');
                item.classList.add('text-dark-700', 'dark:text-dark-300', 'hover:bg-dark-100', 'dark:hover:bg-dark-700/50');
              });

              btn.classList.remove('text-dark-700', 'dark:text-dark-300', 'hover:bg-dark-100', 'dark:hover:bg-dark-700/50');
              btn.classList.add('bg-primary-50', 'dark:bg-primary-900/20', 'text-primary');
            }
            // Mobile tabs
            else {
              document.querySelectorAll('button[data-tab].tab-active').forEach(item => {
                item.classList.remove('tab-active');
                item.classList.add('text-dark-500', 'dark:text-dark-400');
              });

              btn.classList.remove('text-dark-500', 'dark:text-dark-400');
              btn.classList.add('tab-active');
            }
          }
        });

        // Close mobile sidebar when selecting a tab
        if (mobileSidebar) {
          mobileSidebar.classList.add('-translate-x-full');
        }
      }

      tabButtons.forEach(button => {
        button.addEventListener('click', function() {
          activateTab(this.dataset.tab);
        });
      });

      // Set dashboard as the default tab
      activateTab('dashboard');

      // Agent Panel toggle
      const minimizeAgentBtn = document.getElementById('minimize-agent');
      const agentPanel = document.querySelector('.agent-panel');

      if (minimizeAgentBtn && agentPanel) {
        minimizeAgentBtn.addEventListener('click', function() {
          agentPanel.classList.toggle('minimized');
        });
      }

      // Mobile more menu toggle
      const moreMenuBtn = document.querySelector('[data-tab="more"]');
      const moreMenu = document.getElementById('mobile-more-menu');

      if (moreMenuBtn && moreMenu) {
        moreMenuBtn.addEventListener('click', function(e) {
          e.stopPropagation();
          moreMenu.classList.toggle('hidden');
        });

        document.addEventListener('click', function(e) {
          if (!moreMenu.contains(e.target) && !moreMenuBtn.contains(e.target)) {
            moreMenu.classList.add('hidden');
          }
        });
      }
    });

    // Dashboard data loading functions
    async function loadDashboardData() {
      console.log("Loading dashboard data");

      // Get data from IndexedDB
      const visits = await getRecentVisits();
      const todos = await getPendingTodos();
      const campaigns = await getUpcomingCampaigns();
      const analytics = await getCampaignAnalytics();

      // Populate Recent Visits
      const visitsList = document.getElementById('dashboard-recent-visits');
      if (visitsList) {
        visitsList.innerHTML = visits.length
          ? visits.map(v => `
              <div class="border-b border-dark-100/50 dark:border-dark-700/50 pb-3">
                <div class="flex justify-between">
                  <h4 class="font-medium text-dark-900 dark:text-white">${v.business}</h4>
                  <span class="text-xs text-dark-500 dark:text-dark-400">${v.date}</span>
                </div>
                <p class="text-sm text-dark-600 dark:text-dark-400 mt-1">Met with ${v.contactPerson || 'N/A'}</p>
                ${v.notes ? `<p class="text-xs text-dark-500 dark:text-dark-500 mt-1 line-clamp-2">${v.notes}</p>` : ''}
              </div>
            `).join('')
          : '<div class="text-dark-400 dark:text-dark-500 text-sm italic">No recent visits</div>';
      }

      // Populate Pending To-Dos
      const todosList = document.getElementById('dashboard-pending-todos');
      if (todosList) {
        todosList.innerHTML = todos.length
          ? todos.map(t => `
              <div class="border-b border-dark-100/50 dark:border-dark-700/50 pb-3">
                <div class="flex justify-between">
                  <h4 class="font-medium text-dark-900 dark:text-white">${t.task}</h4>
                  <span class="text-xs px-2 py-0.5 rounded-full ${getPriorityClass(t.priority)}">${t.priority}</span>
                </div>
                ${t.dueDate ? `<p class="text-xs text-dark-500 dark:text-dark-400 mt-1">Due: ${t.dueDate}</p>` : ''}
                ${t.related ? `<p class="text-xs text-dark-500 dark:text-dark-500 mt-1">Related to: ${t.related}</p>` : ''}
              </div>
            `).join('')
          : '<div class="text-dark-400 dark:text-dark-500 text-sm italic">No pending tasks</div>';
      }

      // Populate Upcoming Campaigns
      const campaignsList = document.getElementById('dashboard-upcoming-campaigns');
      if (campaignsList) {
        campaignsList.innerHTML = campaigns.length
          ? campaigns.map(c => `
              <div class="border-b border-dark-100/50 dark:border-dark-700/50 pb-3">
                <div class="flex justify-between">
                  <h4 class="font-medium text-dark-900 dark:text-white">${c.subject}</h4>
                  <span class="text-xs text-dark-500 dark:text-dark-400">${c.date}</span>
                </div>
                <p class="text-xs text-dark-500 dark:text-dark-500 mt-1">${c.recipients} recipients</p>
              </div>
            `).join('')
          : '<div class="text-dark-400 dark:text-dark-500 text-sm italic">No upcoming campaigns</div>';
      }

      // Update Analytics Summary
      document.getElementById('dashboard-total-leads').textContent = analytics.totalLeads || '0';
      document.getElementById('dashboard-open-rate').textContent = (analytics.avgOpenRate || 0) + '%';
      document.getElementById('dashboard-response-rate').textContent = (analytics.avgResponseRate || 0) + '%';
    }

    // Helper function to get priority class
    function getPriorityClass(priority) {
      switch(priority?.toLowerCase()) {
        case 'high':
          return 'bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-200';
        case 'medium':
          return 'bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-200';
        case 'low':
          return 'bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-200';
        default:
          return 'bg-dark-100 dark:bg-dark-700 text-dark-500 dark:text-dark-400';
      }
    }

    // Get recent visits from IndexedDB
    async function getRecentVisits() {
      try {
        const dbPromise = idbKeyval.createStore('agent-lee-crm', 'stores');
        const visits = await idbKeyval.get('visits', dbPromise) || [];

        // Return the 5 most recent visits
        return visits.slice(0, 5);
      } catch (error) {
        console.error("Error fetching recent visits:", error);
        return [
          { business: "Bay View Studio", date: "May 20, 2023", contactPerson: "John Smith", notes: "Discussed new release plans" },
          { business: "Downtown Record Store", date: "May 18, 2023", contactPerson: "Sarah Johnson", notes: "Left promotional flyers" }
        ];
      }
    }

    // Get pending to-dos from IndexedDB
    async function getPendingTodos() {
      try {
        const dbPromise = idbKeyval.createStore('agent-lee-crm', 'stores');
        const todos = await idbKeyval.get('todos', dbPromise) || [];

        // Filter for incomplete todos and return the 5 most recent
        const pendingTodos = todos.filter(todo => !todo.completed).slice(0, 5);
        return pendingTodos;
      } catch (error) {
        console.error("Error fetching pending todos:", error);
        return [
          { task: "Follow up with Rushmor Records", priority: "High", dueDate: "May 25, 2023", related: "Rushmor Records" },
          { task: "Create marketing campaign for new album", priority: "Medium", dueDate: "June 1, 2023" }
        ];
      }
    }

    // Get upcoming campaigns from IndexedDB
    async function getUpcomingCampaigns() {
      try {
        const dbPromise = idbKeyval.createStore('agent-lee-crm', 'stores');
        const campaigns = await idbKeyval.get('campaigns', dbPromise) || [];

        // Filter for upcoming campaigns and return the 5 most recent
        const upcomingCampaigns = campaigns.filter(campaign => new Date(campaign.date) > new Date()).slice(0, 5);
        return upcomingCampaigns;
      } catch (error) {
        console.error("Error fetching upcoming campaigns:", error);
        return [
          { subject: "Summer Event Promotion", date: "June 5, 2023", recipients: 45 },
          { subject: "New Album Release", date: "June 15, 2023", recipients: 120 }
        ];
      }
    }

    // Get campaign analytics
    async function getCampaignAnalytics() {
      try {
        const dbPromise = idbKeyval.createStore('agent-lee-crm', 'stores');
        const analytics = await idbKeyval.get('analytics', dbPromise) || {};

        return {
          totalLeads: analytics.totalLeads || 247,
          avgOpenRate: analytics.avgOpenRate || 68.5,
          avgResponseRate: analytics.avgResponseRate || 12.3
        };
      } catch (error) {
        console.error("Error fetching campaign analytics:", error);
        return {
          totalLeads: 247,
          avgOpenRate: 68.5,
          avgResponseRate: 12.3
        };
      }
    }

    // Load dashboard data when the dashboard tab is clicked
    document.addEventListener('DOMContentLoaded', function() {
      // Add event listener to dashboard tab buttons
      document.querySelectorAll('[data-tab="dashboard"]').forEach(btn => {
        btn.addEventListener('click', loadDashboardData);
      });

      // Load dashboard data initially if dashboard is the active tab
      if (!document.getElementById('dashboard-tab').classList.contains('hidden')) {
        loadDashboardData();
      }

      // Voice dictation processing
      document.getElementById('dictation-process')?.addEventListener('click', function() {
        const dictationText = document.getElementById('dictation-result').textContent;
        processDictation(dictationText);
      });
    });

    // Process dictation and route to appropriate modules
    function processDictation(text) {
      // Add to agent messages to simulate AI processing
      addAgentMessage('You', text);

      // More advanced keyword-based routing of dictation with AI-driven categorization
      setTimeout(() => {
        let response;
        let tabToActivate = null;
        let actionToTake = null;

        // Check for analytics-related content
        if (text.toLowerCase().includes('analytics') ||
            text.toLowerCase().includes('performance') ||
            text.toLowerCase().includes('stats') ||
            text.toLowerCase().includes('metrics') ||
            text.toLowerCase().includes('report')) {
          response = "I've analyzed your request about analytics and am adding this information to your analytics dashboard.";
          tabToActivate = "analytics";
          actionToTake = "analytics";
        }
        // Check for campaign-related content
        else if (text.toLowerCase().includes('campaign') ||
                 text.toLowerCase().includes('email') ||
                 text.toLowerCase().includes('message') ||
                 text.toLowerCase().includes('outreach') ||
                 text.toLowerCase().includes('send')) {
          response = "I'm processing your campaign request. Would you like me to draft a campaign based on this information?";
          tabToActivate = "campaigns";
          actionToTake = "campaign";

          // Extract campaign details
          let subject = "";
          let body = text;

          // Try to extract subject from text
          const subjectMatch = text.match(/subject[:\s]+([^\n.]+)/i);
          if (subjectMatch && subjectMatch[1]) {
            subject = subjectMatch[1].trim();
            // Remove the subject line from the body
            body = body.replace(subjectMatch[0], '').trim();
          } else {
            // Use first sentence or part as subject
            const firstSentence = text.split(/[.!?][\s\n]/)[0];
            if (firstSentence && firstSentence.length < 60) {
              subject = firstSentence;
              // Remove first sentence from body if it was used as subject
              if (text.length > firstSentence.length + 1) {
                body = text.substring(firstSentence.length + 1).trim();
              }
            }
          }

          // Pre-populate campaign fields
          setTimeout(() => {
            const subjectField = document.getElementById('campaign-subject');
            const messageField = document.getElementById('campaign-message');

            if (subjectField && subject) {
              subjectField.value = subject;
            }

            if (messageField && body) {
              messageField.innerHTML = body.replace(/\\n/g, '<br>');
            }

            // Create a follow-up task automatically
            createFollowUpTask("Follow up on campaign: " + subject, "Medium", 7);
          }, 500);
        }
        // Check for task-related content
        else if (text.toLowerCase().includes('task') ||
                 text.toLowerCase().includes('todo') ||
                 text.toLowerCase().includes('to do') ||
                 text.toLowerCase().includes('to-do') ||
                 text.toLowerCase().includes('remind') ||
                 text.toLowerCase().includes('follow up') ||
                 text.toLowerCase().includes('follow-up')) {
          response = "I've created a task based on your dictation.";
          tabToActivate = "todos";
          actionToTake = "todo";

          // Extract task details
          let taskTitle = "";
          let taskDescription = text;
          let priority = "Medium";
          let dueDate = "";

          // Extract title
          if (text.includes(':')) {
            const parts = text.split(':');
            taskTitle = parts[0].trim();
            taskDescription = parts.slice(1).join(':').trim();
          } else {
            // Use first sentence as title
            const firstSentence = text.split(/[.!?][\s\n]/)[0];
            if (firstSentence) {
              taskTitle = firstSentence;
              if (text.length > firstSentence.length + 1) {
                taskDescription = text.substring(firstSentence.length + 1).trim();
              }
            }
          }

          // Extract priority
          if (text.toLowerCase().includes('urgent') ||
              text.toLowerCase().includes('important') ||
              text.toLowerCase().includes('high priority')) {
            priority = "High";
          } else if (text.toLowerCase().includes('low priority') ||
                     text.toLowerCase().includes('when you can')) {
            priority = "Low";
          }

          // Extract due date
          const todayMatch = text.match(/today/i);
          const tomorrowMatch = text.match(/tomorrow/i);
          const nextWeekMatch = text.match(/next week/i);
          const dateMatch = text.match(/by ([a-z]+day)/i); // Monday, Tuesday, etc.

          const today = new Date();

          if (todayMatch) {
            dueDate = today.toISOString().split('T')[0];
          } else if (tomorrowMatch) {
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            dueDate = tomorrow.toISOString().split('T')[0];
          } else if (nextWeekMatch) {
            const nextWeek = new Date(today);
            nextWeek.setDate(nextWeek.getDate() + 7);
            dueDate = nextWeek.toISOString().split('T')[0];
          } else if (dateMatch && dateMatch[1]) {
            const dayOfWeek = dateMatch[1].toLowerCase();
            const daysOfWeek = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];
            const targetDayIndex = daysOfWeek.indexOf(dayOfWeek);

            if (targetDayIndex !== -1) {
              const currentDayIndex = today.getDay();
              let daysToAdd = targetDayIndex - currentDayIndex;
              if (daysToAdd <= 0) daysToAdd += 7; // Next week if day has passed

              const targetDate = new Date(today);
              targetDate.setDate(targetDate.getDate() + daysToAdd);
              dueDate = targetDate.toISOString().split('T')[0];
            }
          }

          // Create the task
          setTimeout(() => {
            createTask(taskTitle, taskDescription, priority, dueDate);
          }, 500);
        }
        // Check for visit-related content
        else if (text.toLowerCase().includes('visit') ||
                 text.toLowerCase().includes('store') ||
                 text.toLowerCase().includes('shop') ||
                 text.toLowerCase().includes('location') ||
                 text.toLowerCase().includes('went to')) {
          response = "I'm logging this visit information for you.";
          tabToActivate = "visits";
          actionToTake = "visit";

          // Try to extract store name
          let storeName = "";
          let contactPerson = "";
          let visitNotes = text;

          // Look for store name patterns
          const storePatterns = [
            /visited\s+([^,.]+)/i,
            /went to\s+([^,.]+)/i,
            /at\s+([^,.]+)\s+store/i,
            /at\s+([^,.]+)\s+shop/i,
            /store\s+called\s+([^,.]+)/i,
            /shop\s+called\s+([^,.]+)/i
          ];

          for (const pattern of storePatterns) {
            const match = text.match(pattern);
            if (match && match[1]) {
              storeName = match[1].trim();
              break;
            }
          }

          // Look for contact person
          const contactPatterns = [
            /met\s+(with\s+)?([^,.]+)/i,
            /talked\s+(to|with)\s+([^,.]+)/i,
            /spoke\s+(to|with)\s+([^,.]+)/i,
            /contact\s+(person|was)\s+([^,.]+)/i
          ];

          for (const pattern of contactPatterns) {
            const match = text.match(pattern);
            if (match && match[match.length - 1]) {
              contactPerson = match[match.length - 1].trim();
              // Filter out common words that might be matched incorrectly
              const filterWords = ['store', 'shop', 'the', 'a', 'an', 'their', 'them', 'him', 'her'];
              if (filterWords.includes(contactPerson.toLowerCase())) {
                contactPerson = "";
              }
              break;
            }
          }

          // Pre-populate visit form
          setTimeout(() => {
            const visitBusinessSelect = document.getElementById('visit-business');
            const visitContactField = document.getElementById('visit-contact');
            const visitNotesField = document.getElementById('visit-notes');

            if (visitBusinessSelect && storeName) {
              // Try to find the store in the dropdown
              for (let i = 0; i < visitBusinessSelect.options.length; i++) {
                if (visitBusinessSelect.options[i].text.toLowerCase().includes(storeName.toLowerCase())) {
                  visitBusinessSelect.selectedIndex = i;
                  break;
                }
              }
            }

            if (visitContactField && contactPerson) {
              visitContactField.value = contactPerson;
            }

            if (visitNotesField) {
              visitNotesField.value = visitNotes;
            }

            // Create a follow-up task automatically
            if (storeName) {
              createFollowUpTask("Follow up with " + storeName, "Medium", 3);
            }
          }, 500);
        }
        // Default response for other content
        else {
          response = "I've saved your dictation as a note. Would you like me to create a task, log a visit, or draft a campaign based on this?";
          tabToActivate = "timeline";
          actionToTake = "note";
        }

        // Add Agent Lee's response
        addAgentMessage('Agent Lee', response);

        // Take action based on the content
        if (tabToActivate) {
          // Switch to the appropriate tab
          document.querySelector(`[data-tab="${tabToActivate}"]`).click();
        }

        // Add to timeline as a note regardless of action taken
        addToTimeline({
          type: 'note',
          title: 'Voice Note',
          description: text,
          date: 'today',
          time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}),
          subtype: 'Dictation',
          autoLogged: true
        });
      }, 1000);
    }

    // Helper function to create a task
    async function createTask(title, description, priority = "Medium", dueDate = "") {
      try {
        // Create task object
        const task = {
          task: title,
          description: description,
          priority: priority,
          dueDate: dueDate || new Date().toISOString().split('T')[0], // Default to today
          completed: false,
          createdAt: new Date().toISOString(),
          id: 'task_' + Date.now()
        };

        // Save to IndexedDB
        const dbPromise = idbKeyval.createStore('agent-lee-crm', 'stores');
        const todos = await idbKeyval.get('todos', dbPromise) || [];
        todos.unshift(task); // Add to beginning of array

        await idbKeyval.set('todos', todos, dbPromise);
        console.log("Task created:", task);

        // Refresh dashboard if it's visible
        if (!document.getElementById('dashboard-tab').classList.contains('hidden')) {
          loadDashboardData();
        }

        return task;
      } catch (error) {
        console.error("Error creating task:", error);
        return null;
      }
    }

    // Helper function to create a follow-up task
    function createFollowUpTask(title, priority = "Medium", daysFromNow = 3) {
      const dueDate = new Date();
      dueDate.setDate(dueDate.getDate() + daysFromNow);
      return createTask(title, "Automatically created follow-up task", priority, dueDate.toISOString().split('T')[0]);
    }

    // Helper function to add a message to the timeline
    function addToTimeline(item) {
      try {
        const timelineList = document.getElementById('timeline-list');
        if (!timelineList) return;

        const timelineItem = document.createElement('div');
        timelineItem.className = 'ml-10 relative pt-3 pb-6';

        // Icon based on item type
        let iconClass = 'bg-primary-500';
        let iconContent = 'ðŸ“';

        switch(item.type) {
          case 'visit':
            iconClass = 'bg-green-500';
            iconContent = 'ðŸ¬';
            break;
          case 'task':
            iconClass = 'bg-amber-500';
            iconContent = 'âœ“';
            break;
          case 'campaign':
            iconClass = 'bg-blue-500';
            iconContent = 'ðŸ“§';
            break;
          case 'note':
          default:
            iconClass = 'bg-purple-500';
            iconContent = 'ðŸ“';
        }

        timelineItem.innerHTML = `
          <div class="absolute -left-10 mt-1.5 rounded-full w-5 h-5 ${iconClass} text-center">
            <span class="text-white text-xs">${iconContent}</span>
          </div>
          <time class="text-xs text-dark-500 dark:text-dark-400 mb-1 block">${item.date}, ${item.time}</time>
          <h3 class="text-base font-medium text-dark-900 dark:text-white">${item.title}</h3>
          <p class="mt-1 text-sm text-dark-600 dark:text-dark-400">${item.description}</p>
          ${item.subtype ? `<span class="mt-2 inline-block px-2 py-0.5 text-xs rounded-full bg-dark-100 dark:bg-dark-700 text-dark-500 dark:text-dark-400">${item.subtype}</span>` : ''}
          ${item.autoLogged ? `<span class="ml-2 mt-2 inline-block px-2 py-0.5 text-xs rounded-full bg-primary-100 dark:bg-primary-900/30 text-primary-800 dark:text-primary-200">Auto-logged</span>` : ''}
        `;

        timelineList.insertAdjacentElement('afterbegin', timelineItem);
      } catch (error) {
        console.error("Error adding to timeline:", error);
      }
    }

    // Helper function to add agent messages
    function addAgentMessage(sender, message) {
      try {
        const messagesContainer = document.getElementById('agent-messages');
        if (!messagesContainer) return;

        const messageElement = document.createElement('div');
        messageElement.className = 'mb-4';

        const isAgent = sender === 'Agent Lee';

        messageElement.innerHTML = `
          <div class="font-medium ${isAgent ? 'text-primary' : 'text-dark-700 dark:text-dark-300'} flex items-center">
            <span class="text-sm mr-1">${isAgent ? 'ðŸ§ ' : 'ðŸ‘¤'}</span> ${sender}
            <span class="text-dark-400 dark:text-dark-500 text-xs ml-auto">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>
          </div>
          <div class="mt-1 pl-5 text-dark-600 dark:text-dark-400">
            ${message}
          </div>
        `;

        messagesContainer.appendChild(messageElement);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
      } catch (error) {
        console.error("Error adding agent message:", error);
      }
    }
  </script>
</body>
</html>